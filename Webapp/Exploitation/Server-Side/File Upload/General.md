---
id: Upload
aliases: []
tags:
  - Webapp/Exploitation/Upload-Functionality
---

# File Upload Functionality

If user input and uploaded files
are not correctly filtered and validated,
attackers may be able to exploit the file upload feature
to perform malicious activities
(*e.g, executing arbitrary commands on the back-end server*)

[Unrestricted File Upload](https://owasp.org/www-community/vulnerabilities/Unrestricted_File_Upload)
allows any unauthenticated user to upload any file type

<!-- Info {{{-->
> [!info]- Resources
>
> - [OWASP WSTG - v4.2 - Test Upload of Unexpected File Types](https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/10-Business_Logic_Testing/08-Test_Upload_of_Unexpected_File_Types)
> - [OWASP WSTG - v4.2 - Test Upload of Malicious File Types](https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/10-Business_Logic_Testing/09-Test_Upload_of_Malicious_Files)
> - [PayloadsAllTheThings - htaccess](https://swisskyrepo.github.io/PayloadsAllTheThings/Upload%20Insecure%20Files/Configuration%20Apache%20.htaccess/)
>
<!-- }}} -->

<!-- Info {{{-->
> [!info]- File Upload Mindmap
>
> ![[file-upload-mindmap.png]]
>
<!-- }}} -->

___

<!-- Enumeration {{{-->
## Enumeration

Enumerate the file upload functionality

1. Create a test script

```sh
echo "<?php echo "Exploited";?>" > test.php
```

2. Query the uploaded file
   (*or click `Download`*)

```sh
/uploads/test.php
```

___
<!-- }}} -->

<!-- Exploit {{{-->
## Exploit

Bypass file upload restrictions

<!-- Htaccess Override {{{-->
### Htaccess Override

Override  [[Apache HTTP Server/General#.htaccess|.htaccess]]
to make [[Apache HTTP Server/General|Apache HTTP Server]]
interpret arbitrary file extensions as `.php`

1. Create `.htaccess` file

```sh
AddType mime-type extension [extension ...]
```

<!-- Example {{{-->
> [!example]-
>
> Execute `.png` extensions as `.php`
>
> ```sh
> echo "AddType application/x-httpd.php .png" > .htaccess
> ```
>
> Execute `.exploit` extensions as `.php`
>
> ```sh
> echo "AddType application/x-httpd.php .exploit" > .htaccess
> ```
>
<!-- }}} -->

2. Upload `.htaccess` to the target

<!-- }}} -->

<!-- Type Filters {{{-->
### Type Filters

<!-- Content-Type {{{-->
#### Content-Type

[[HTTP Header#Content-Type|Content-Type]]

[All Web Content types](https://raw.githubusercontent.com/danielmiessler/SecLists/refs/heads/master/Discovery/Web-Content/web-all-content-types.txt)

<!-- }}} -->

<!-- MIME-Type {{{-->
#### MIME-Type



<!-- }}} -->

<!-- }}} -->

<!-- Extension Filters {{{-->
### Extension Filters

Use double extensions

```sh
.jpg.php
```
```sh
.png.php5
```


<!-- }}} -->

___
<!-- }}} -->

<!-- Client-Side Validation {{{-->
## Client-Side Validation

Many web applications only rely on front-end JavaScript code
to validate the selected file format before it is uploaded
and would not upload it if the file is not in the required format

<!-- Info {{{-->
> [!info]-
>
> The File Upload dialog limits the allowed image formats
>
> ![[file-upload-select-file-types.jpg]]
>
<!-- }}} -->

**Back-end Request Modification**

1. Capture the upload request

2. Modify the `filename` parameter

```sh
filename="shell.php"
```

**Disable Client-Side Validation**

1. Open the brower's [Page Inspector](https://firefox-source-docs.mozilla.org/devtools-user/page_inspector/)

```sh
CTRL + SHIFT + C
```

2. Highlight the profile picture
   to inspect the corresponding code

<!-- Example {{{-->
> [!example]-
>
> The `accept` parameter specifies the allowed file types
> within the file selection dialog
> (*`.jpg,.jpeg,.png`*)
>
> ```sh
> <input type="file" name="uploadFile" id="uploadFile" onchange="checkFile(this)" accept=".jpg,.jpeg,.png">
> ```
>
> The enclosing `form` may also call a function (*`onsubmit`*)
> to check files
>
> ```sh
> <form action="upload.php" method="POST" enctype="multipart/form-data" id="uploadForm" onsubmit="if(validate()){upload()}">
>         <input type="file" name="uploadFile" id="uploadFile" onchange="showImage()" accept=".jpg,.jpeg,.png">
>         <img src="/profile_images/default.jpg" class="profile-image" id="profile-image">
>         <input type="submit" value="Upload" id="submit">
> </form>
> ```
>
<!-- }}} -->

3. Identify the JavaScript function used to validate the file
   (*[onchange](https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/change_event),
   [onsubmit](https://developer.mozilla.org/en-US/docs/Web/API/HTMLFormElement/submit_event)*)

<!-- Example {{{-->
> [!example]-
>
> ```sh
> onchange="checkFile(this)"
> ```
>
<!-- }}} -->

4. Open the [Web Console](https://firefox-source-docs.mozilla.org/devtools-user/web_console/)
   and search for the JavaScript funciton

```sh
CTRL + SHIFT + K
```

5. Delete the JavaScript function

6. Remove the function call from HTML

___
<!-- }}} -->


















## Extensions/Plugins

## HTTP Verb Tampering

HTTP verb tampering (e.g., `TRACK`, `PUT`, `MOVE`)
