---
id: Enumeration
aliases: []
tags:
  - Webapp/Exploitation/File-Upload/Enumeration
---

# Enumeration

Enumerate the file upload functionality

___

<!-- Client-Side Validation {{{-->
## Client-Side Validation

Many web applications only rely on front-end JavaScript code
to validate the selected file format before it is uploaded
and would not upload it if the file is not in the required format

<!-- Info {{{-->
> [!info]-
>
> The `File Upload` dialog limits the allowed image formats
>
> ![[file-upload-select-file-types.jpg]]
>
<!-- }}} -->

<!-- Extension Filters {{{-->
### Extension Filters

Enumerate allowed file types in the File Upload dialog

1. Open the File Upload dialog

<!-- Example {{{-->
> [!example]-
>
> ![[file-upload-arbitrary.png]]
>
<!-- }}} -->


<!-- }}} -->

### Reference File

1. Upload an intended file

2. Inspect request & response behavior



___
<!-- }}} -->

<!-- Server-Side Validation {{{-->
## Server-Side Validation

<!-- Extension Filters {{{-->
### Extension Filters

Enumerate [[Exploitation#Server-Side Validation#Extension Filters|Extension Filters]]
implemented on the server-side

<!-- Tip - Wordlists {{{-->
> [!tip]- Wordlists
>
> [[Seclists#Web Extensions|Seclists]]
>
<!-- }}} -->

<!-- Blacklist {{{-->
### Blacklist

Enumerate [[Exploitation#Blacklist|Blacklist Filters]]
that are testing the file extensions
against a list of disallowed extensions


2. Investigate HTTP responses

<!-- Example {{{-->
> [!example]-
>
> Unsuccessful and successful responses
> usually have different sizes
>
<!-- }}} -->

<!-- }}} -->

<!-- Whitelist {{{-->
### Whitelist

Whitelist filters are testing the file extensions
against a list of allowed file extensions

<!-- Info {{{-->
> [!info]-
>
> The PHP script uses a Regular Expression (*RegEx*)
> to test whether the filename contains
> any whitelisted image extensions
>
> ```sh
> $fileName = basename($_FILES["uploadFile"]["name"]);
>
> if (!preg_match('^.*\.(jpg|jpeg|png|gif)', $fileName)) {
>     echo "Only images are allowed";
>     die();
> }
> ```
>
> <!-- Warning {{{-->
> > [!warning]
> >
> > RegEx only checks whether the file name contains the extension
> > and not if it actually ends with it
> > ```sh
> > .jpg.php
> > ```
> > ```sh
> > .png.php5
> > ```
> <!-- }}} -->
>
<!-- }}} -->

<!-- }}} -->


<!-- }}} -->

<!-- }}} -->



___
<!-- }}} -->



## POC Upload

1. Create test script

<!-- Example {{{-->
> [!example]-
>
> ```sh
> echo "<?php echo "POC";?>" > poc.php
> ```
>
<!-- }}} -->

2. Upload test script

3. Query the uploaded file
   (*or click `Download`*)

<!-- Example {{{-->
> [!example]-
>
> ```sh
> curl $target/uploads/poc.php
> ```
>
<!-- }}} -->


3. Discover the directory the file is being uploaded to

> [!todo]

<!-- Upload Directory Disclosure {{{-->
## Upload Directory Disclosure

- Submission form feedback

- Fuzzing

- LFI/XEE

- Error messages
  - Upload a name that already exists
  - File with an overly long name (*e.g. 5000 characters*)

- [Web Attacks/IDOR module](https://academy.hackthebox.com/module/details/134)

___
<!-- }}} -->

