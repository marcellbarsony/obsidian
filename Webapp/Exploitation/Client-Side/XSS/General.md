---
id: XSS
aliases:
  - Cross-Site Scripting
tags:
  - Webapp/Exploitation/Client-Side/XSS
---

# Cross-Site Scripting

**Cross-Site Scripting**
(*[XSS](https://en.wikipedia.org/wiki/Cross-site_scripting)*)
vulnerabilities take advantage of a flaw in user input sanitization
to "write" [[JavaScript/General|JavaScript]] code
to a input field on the page and execute it on the client side

<!-- Info {{{-->
> [!info]- Resources
>
> OWASP
>
> - [Corss Site Scripting (XSS)](https://owasp.org/www-community/attacks/xss/)
>
<!-- }}} -->

<!-- Tip {{{-->
> [!tip]
>
> XSS can be injected into any input in the HTML page
> if their values are displayed on the page
> (*e.g., [[HTTP Header]] like Cookie or User-Agent*)
<!-- }}} -->

___

<!-- XSS Types {{{-->
## XSS Types

<!-- Stored XSS {{{-->
### Stored XSS

**Stored XSS**
(*or [Persistent XSS](https://en.wikipedia.org/wiki/Cross-site_scripting#Persistent_(or_stored))*)
occurs when the data provided by the attacker is saved by the server,
and retrieved by users upon visiting the page

The injected JavaScript code should persist upon refresh

> [!todo]

<!-- }}} -->

<!-- Reflected XSS {{{-->
### Reflected XSS

**Reflected XSS**
(*or [Non-persistent XSS](https://en.wikipedia.org/wiki/Cross-site_scripting#Non-persistent_(reflected))*)
occurs when data provided by the attacker processed by the back-end server,
and is immediately returned to the user without sanitization

<!-- Example {{{-->
> [!example]-
>
> ![[xss-reflected-test.png]]
>
<!-- }}} -->

<!-- }}} -->

<!-- DOM XSS {{{-->
### DOM XSS

[DOM Based XSS](https://owasp.org/www-community/attacks/DOM_Based_XSS)
is completely processed on the client-side to change the page soruce
through the [Document Object Model](https://en.wikipedia.org/wiki/Document_Object_Model)

<!-- Example {{{-->
> [!example]-
>
> ![[xss-dom-network.png]]
>
<!-- }}} -->

- **Source**: The JavaScript object that takes the user input
- **Sink**: The function that writes the user input to a DOM object

<!-- Example {{{-->
> [!example]-
>
> Common functions to write user input to a DOM object
>
> [[JavaScript/General|JavaScript]]
>
> ```js
> document.write()
> ```
> ```js
> document.writeln()
> ```
> ```js
> DOM.innerHTML
> ```
> ```js
> DOM.outerHTML
> ```
> ```js
> document.domain
> ```
>
> [jQuery](https://jquery.com/)
>
> ```js
> html()
> ```
> ```js
> parseHTML()
> ```
> ```js
> add()
> ```
> ```js
> append()
> ```
> ```js
> prepend()
> ```
> ```js
> after()
> ```
> ```js
> insertAfter()
> ```
> ```js
> before()
> ```
> ```js
> insertBefore()
> ```
> ```js
> replaceAll()
> ```
> ```js
> replaceWith()
> ```
>
<!-- }}} -->

If a **Sink** function writes the exact input without any sanitization,
the page is vulnerable to XSS

<!-- }}} -->

___
<!-- }}} -->

<!-- Prevention {{{-->
## Prevention

<!-- Backend {{{-->
### Backend

Prevent XSS vulnerabilities with measures on the back-end
to prevent [[#Stored XSS]] and [[#Reflected XSS]] vulnerabilities

**INPUT VALIDATION**

Use regex or library functions to validate the input fields

<!-- Example {{{-->
> [!example]-
>
> E-mail validation on a PHP backend
>
> ```php
> if (filter_var($_GET['email'], FILTER_VALIDATE_EMAIL)) {
>     // do task
> } else {
>     // reject input - do not display it
> }
> ```
<!-- }}} -->

**INPUT SANITIZATION**

Filter user input

<!-- Example {{{-->
> [!example]-
>
> Escape special characters with a backslash (`\`)
>
> PHP - [addslashes](https://www.php.net/manual/en/function.addslashes.php)
>
> ```php
> addslashes($_GET['email'])
> ```
>
> NodeJS - [DOMPurify](https://github.com/cure53/DOMPurify)
>
> ```javascript
> import DOMPurify from 'dompurify';
> var clean = DOMPurify.sanitize(dirty);
> ```
<!-- }}} -->

**OUTPUT HTML ENCODING**

<!-- Example {{{-->
> [!example]-
>
> PHP - [htmlentities](https://www.php.net/manual/en/function.htmlentities.php)
>
> ```php
> htmlentities($_GET['email']);
> ```
>
> NodeJS
>
> ```javascript
> import encode from 'html-entities';
> encode('<'); // -> '&lt;'
> ```
<!-- }}} -->

**SERVER CONFIGURATION**

Web server configuration best practices

<!-- Example {{{-->
> [!example]-
>
> - Use HTTPS across the entire domain
> - Use XSS prevention headers
> - Use the appropriate Content-Type for the page
>   (*e.g., `X-Content-Type-Options=nosniff`*)
> - Use Content-Security-Policy options
>   (*e.g., script-src 'self'*)
> - Use the [HttpOnly](https://owasp.org/www-community/HttpOnly) and
>   [Secure cookie](https://owasp.org/www-community/controls/SecureCookieAttribute)
>   flags to prevent JavaScript from reading cookies
>   and only transport them over HTTPS
<!-- }}} -->

<!-- }}} -->

<!-- Frontend {{{-->
### Frontend

**INPUT VALIDATION**

Validate input fields

<!-- Example {{{-->
> [!example]-
>
> Validate e-mail input field with [[RegEx]]
>
> ```javascript
> function validateEmail(email) {
>     const re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
>     return re.test($("#login input[name=email]").val());
> }
> ```
<!-- }}} -->

**INPUT SANITIZATION**

Filter input with JavaScript code

<!-- Example {{{-->
> [!example]-
>
> [DOMPurify](https://github.com/cure53/DOMPurify) -
> Escape any special characters with a backslash (`\`)
>
> ```javascript
> <script type="text/javascript" src="dist/purify.min.js"></script>
> let clean = DOMPurify.sanitize( dirty );
> ```
<!-- }}} -->

**DIRECT INPUT**

Never use user input directly within certain HTML tags

<!-- Example {{{-->
> [!example]-
>
> - JavaScript code: `<script></script>`
> - CSS Style Code: `<style></style>`
> - Tag/Attribute Fields: `<div name='INPUT'></div>`
> - HTML Comments: `<!-- -->`
<!-- }}} -->

Avoid using JavaScript functions that allow changing raw text
of HTML fields

<!-- Example {{{-->
> [!example]-
>
> - `DOM.innerHTML`
> - `DOM.outerHTML`
> - `document.write()`
> - `document.writeln()`
> - `document.domain`
<!-- }}} -->

Avoid certain jQuery functions

<!-- Example {{{-->
> [!example]-
>
> - `html()`
> - `parseHTML()`
> - `add()`
> - `append()`
> - `prepend()`
> - `after()`
> - `insertAfter()`
> - `before()`
> - `insertBefore()`
> - `replaceAll()`
> - `replaceWith()`
>
<!-- }}} -->

<!-- }}} -->

___
<!-- }}} -->

