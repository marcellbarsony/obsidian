---
id: Database
aliases: []
tags:
  - Pentest/Tools/Metasploit/Database
---

# Database

___

<!-- Setup {{{-->
## Setup

1. Check the PostgreSQL service status

```sh
sudo service postgresql status
```

<!-- Example {{{ -->
> [!example]-
>
> ```sh
> sudo service postgresql status
> ```
> ```sh
> ● postgresql.service - PostgreSQL RDBMS
>      Loaded: loaded (/usr/lib/systemd/system/postgresql.service; disabled; preset: disabled)
>      Active: active (exited) since Mon 2026-01-05 19:36:53 EST; 4s ago
>  Invocation: e7a021d77b9448e7ab4cd6178e2bcc9c
>     Process: 5013 ExecStart=/bin/true (code=exited, status=0/SUCCESS)
>    Main PID: 5013 (code=exited, status=0/SUCCESS)
>    Mem peak: 1.7M
>         CPU: 9ms
>
> Jan 05 19:36:53 kali systemd[1]: Starting postgresql.service - PostgreSQL RDBMS...
> Jan 05 19:36:53 kali systemd[1]: Finished postgresql.service - PostgreSQL RDBMS.
> ```
<!-- }}} -->

2. Start the PoostgreSQL server (*optional*)

```sh
sudo systemctl start postgresql
```

3. Create and initialize MSF database

```sh
sudo msfdb init
```

<!-- Warning {{{-->
> [!warning]-
>
> `NoMethodError` may occur if Metasploit is not updated
>
> ```sh
> sudo msfdb init
> ```
>
> ```sh
> [i] Database already started
> [+] Creating database user 'msf'
> [+] Creating databases 'msf'
> [+] Creating databases 'msf_test'
> [+] Creating configuration file '/usr/share/metasploit-framework/config/database.yml'
> [+] Creating initial database schema
> rake aborted!
> NoMethodError: undefined method `without' for #<Bundler::Settings:0x000055dddcf8cba8>
> Did you mean? with_options
> ```
>
> [[Kali Linux#Update|Update]] Metasploit
>
> ```sh
> sudo apt install --only-upgrade metasploit
> ```
<!-- }}} -->

<!-- Example {{{-->
> [!example]-
>
> ```sh
> sudo msfdb init
> ```
> ```sh
> [i] Database already started
> [+] Creating database user 'msf'
> [+] Creating databases 'msf'
> [+] Creating databases 'msf_test'
> [+] Creating configuration file '/usr/share/metasploit-framework/config/database.yml'
> [+] Creating initial database schema
> ```
<!-- }}} -->

4. Check MSF database status

```sh
sudo msfdb status
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> sudo msfdb status
> ```
> ```sh
> ● postgresql.service - PostgreSQL RDBMS
>      Loaded: loaded (/usr/lib/systemd/system/postgresql.service; disabled; preset: disabled)
>      Active: active (exited) since Mon 2026-01-05 19:36:53 EST; 5min ago
>  Invocation: e7a021d77b9448e7ab4cd6178e2bcc9c
>     Process: 5013 ExecStart=/bin/true (code=exited, status=0/SUCCESS)
>    Main PID: 5013 (code=exited, status=0/SUCCESS)
>    Mem peak: 1.7M
>         CPU: 9ms
>
> Jan 05 19:36:53 kali systemd[1]: Starting postgresql.service - PostgreSQL RDBMS...
> Jan 05 19:36:53 kali systemd[1]: Finished postgresql.service - PostgreSQL RDBMS.
>
> COMMAND   PID     USER FD   TYPE DEVICE SIZE/OFF NODE NAME
> postgres 4976 postgres 6u  IPv6  19067      0t0  TCP localhost:5432 (LISTEN)
> postgres 4976 postgres 7u  IPv4  19068      0t0  TCP localhost:5432 (LISTEN)
>
> UID          PID    PPID  C STIME TTY      STAT   TIME CMD
> postgres    4976       1  0 19:36 ?        Ss     0:00 /usr/lib/postgresql/18/bin/postgres -D /var/lib/postgresql/18/main -c config_file=/etc/postgresql/18/main/postgresql.conf
>
> [+] Detected configuration file (/usr/share/metasploit-framework/config/database.yml)
> ```
<!-- }}} -->
___
<!-- }}} -->

<!-- Workspaces {{{-->
## Workspaces

Workspaces segregate the different scan results, hosts,
and extracted information by IP, subnet, network, or domain

List Workspaces

```sh
workspace
```

```sh
workspace -l
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> msf6 > workspace
> ```
>
> ```sh
> * default
> ```
<!-- }}} -->

Workspace Help

```sh
workspace -h
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> msf6 > workspace -h
> ```
>
> ```sh
> Usage:
>     workspace                  List workspaces
>     workspace -v               List workspaces verbosely
>     workspace [name]           Switch workspace
>     workspace -a [name] ...    Add workspace(s)
>     workspace -d [name] ...    Delete workspace(s)
>     workspace -D               Delete all workspaces
>     workspace -r     Rename workspace
>     workspace -h               Show this help information
> ```
<!-- }}} -->

Create Workspace

```sh
workspace -a <workspace>
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> msf6 > workspace -a Target_1
> ```
>
> ```sh
> [*] Added workspace: Target_1
> [*] Workspace: Target_1
> ```
<!-- }}} -->

Change Workspace

```sh
workspace <workspace>
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> msf6 > workspace Target_1
> ```
>
> ```
> [*] Workspace: Target_1
> ```
<!-- }}} -->

Delete Workspace

```sh
workspace -d <workspace>
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> msf > workspace -d test
> ```
>
> ```sh
> [*] Deleted workspace: test
> ```
<!-- }}} -->

___
<!-- }}} -->

<!-- Usage {{{-->
## Usage

<!-- General {{{-->
### General

Connect to the MSF database

```sh
sudo msfdb run
```

Database Help

```sh
help database
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> msf6 > help database
> ```
>
> ```sh
> Database Backend Commands
> =========================
>
>     Command           Description
>     -------           -----------
>     db_connect        Connect to an existing database
>     db_disconnect     Disconnect from the current database instance
>     db_export         Export a file containing the contents of the database
>     db_import         Import a scan result file (filetype will be auto-detected)
>     db_nmap           Executes nmap and records the output automatically
>     db_rebuild_cache  Rebuilds the database-stored module cache
>     db_status         Show the current database status
>     hosts             List all hosts in the database
>     loot              List all loot in the database
>     notes             List all notes in the database
>     services          List all services in the database
>     vulns             List all vulnerabilities in the database
>     workspace         Switch between database workspaces
> ```
<!-- }}} -->

Database Status

```sh
db_status
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> msf6 > db_status
> ```
>
> ```
> [*] Connected to msf. Connection type: postgresql.
> ```
<!-- }}} -->

<!-- }}} -->

<!-- Credentials {{{-->
### Credentials

Visualize the credentials gathered
during interactions with the target host

Credentials Help

```sh
creds -h
```

List Credentials

```sh
creds
```

<!-- }}} -->

<!-- Hosts {{{-->
### Hosts

Hosts Help

```sh
hosts -h
```

List Hosts

```sh
hosts
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> msf6 > hosts
> ```
>
> ```sh
> Hosts
> =====
>
> address      mac  name  os_name  os_flavor  os_sp  purpose  info  comments
> -------      ---  ----  -------  ---------  -----  -------  ----  --------
> 10.10.11.80             Linux               5.X    server
> ```
<!-- }}} -->

<!-- }}} -->

<!-- Loot {{{-->
### Loot

Loot refers to hash dumps from different system types
(*e.g., hashes, passwd, shadow, etc.*)

Loot Help

```sh
loot -h
```

List Loots

```sh
loot
```

<!-- }}} -->

<!-- Services {{{-->
### Services

Services Help

```sh
services -h
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> msf6 > services -h
> ```
>
> ```sh
> Usage: services [-h] [-u] [-a] [-r <proto>] [-p <port1,port2>] [-s <name1,name2>] [-o <filename>] [addr1 addr2 ...]
>
>   -a,--add          Add the services instead of searching
>   -d,--delete       Delete the services instead of searching
>   -c <col1,col2>    Only show the given columns
>   -h,--help         Show this help information
>   -s <name>         Name of the service to add
>   -p <port>         Search for a list of ports
>   -r <protocol>     Protocol type of the service being added [tcp|udp]
>   -u,--up           Only show services which are up
>   -o <file>         Send output to a file in csv format
>   -O <column>       Order rows by specified column number
>   -R,--rhosts       Set RHOSTS from the results of the search
>   -S,--search       Search string to filter by
>   -U,--update       Update data for existing service
>
> Available columns: created_at, info, name, port, proto, state, updated_at
> ```
<!-- }}} -->

List Services

```sh
services
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> msf6 > services
> ```
>
> ```sh
> Services
> ========
>
> host         port  proto  name  state  info
> ----         ----  -----  ----  -----  ----
> 10.10.11.80  22    tcp    ssh   open   OpenSSH 8.9p1 Ubuntu 3ubuntu0.13 Ubuntu Linux; protocol 2.0
> 10.10.11.80  80    tcp    http  open   nginx 1.18.0 Ubuntu
> 10.10.11.80  8080  tcp    http  open   Jetty 10.0.20
> ```
<!-- }}} -->

<!-- }}} -->

___
<!-- }}} -->

<!-- Data {{{-->
## Data

<!-- Import {{{-->
### Import

Import [[Nmap]] scan results

```sh
db_import <scan.xml>
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> msf6 > db_import Target.xml
> ```
>
> ```sh
> [*] Importing 'Nmap XML' data
> [*] Import: Parsing with 'Nokogiri v1.10.9'
> [*] Importing host 10.10.10.40
> [*] Successfully imported ~/Target.xml
> ```
<!-- }}} -->

<!-- }}} -->

<!-- Export {{{-->
### Export

DB Export help

```sh
db_export -h
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> msf6 > db_export -f xml backup.xml
> ```
>
> ```sh
> [*] Starting export of workspace default to backup.xml [ xml ]...
> [*] Finished export of workspace default to backup.xml [ xml ]...
> ```
<!-- }}} -->

DB Export to file

```sh
db_export -f xml <export.xml>
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> msf6 > db_export -f xml backup.xml
> ```
>
> ```sh
> [*] Starting export of workspace default to backup.xml [ xml ]...
> [*] Finished export of workspace default to backup.xml [ xml ]...
> ```
<!-- }}} -->

<!-- }}} -->

___
<!-- }}} -->
